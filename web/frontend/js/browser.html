<!DOCTYPE html>
<html class="no-js" lang="zh">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<meta content="NoughtQ的笔记本" name="description"/>
<meta content="NoughtQ" name="author"/>
<link href="https://notebook.noughtq.top/web/frontend/js/browser.html" rel="canonical"/>
<link href="basic.html" rel="prev"/>
<link href="../vue/index.html" rel="next"/>
<link href="../../../assets/favicon.png" rel="icon"/>
<meta content="mkdocs-1.6.1, mkdocs-material-9.5.42" name="generator"/>
<title>JavaScript 浏览器相关 - NoughtQ的笔记本</title>
<link href="../../../assets/stylesheets/main.0253249f.min.css" rel="stylesheet"/>
<link href="../../../assets/stylesheets/palette.06af60db.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=JetBrains+Mono,+LXGW+WenKai+Screen+GB+Screen:300,300i,400,400i,700,700i%7CJetBrains+Mono,+Consolas:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"JetBrains Mono, LXGW WenKai Screen GB Screen";--md-code-font:"JetBrains Mono, Consolas"}</style>
<link href="../../../css/heti.css" rel="stylesheet"/>
<link href="../../../css/toc_extra.css" rel="stylesheet"/>
<link href="../../../css/timeline.css" rel="stylesheet"/>
<link href="../../../stylesheet/custom.css" rel="stylesheet"/>
<link href="../../../stylesheet/extra_changelog.css" rel="stylesheet"/>
<link href="https://unpkg.com/katex@0/dist/katex.min.css" rel="stylesheet"/>
<link href="https://gcore.jsdelivr.net/npm/lxgw-wenkai-screen-webfont@1.1.0/style.css" rel="stylesheet"/>
<link href="https://gcore.jsdelivr.net/npm/lxgw-wenkai-webfont@1.1.0/style.css" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:ital,wght@0,100..800;1,100..800&amp;display=swap" rel="stylesheet"/>
<script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
<script id="__analytics">function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-43NH8CVRCJ"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-43NH8CVRCJ",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-43NH8CVRCJ",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script>
<script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
</head>
<body data-md-color-accent="indigo" data-md-color-primary="indigo" data-md-color-scheme="slate" dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#javascript-浏览器相关">
          跳转至
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header" data-md-component="header">
<nav aria-label="页眉" class="md-header__inner md-grid">
<a aria-label="NoughtQ的笔记本" class="md-header__button md-logo" data-md-component="logo" href="../../.." title="NoughtQ的笔记本">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.05 9H7.06V6h1.99V4.03H7.06v-1c0-1.11.89-1.99 1.99-1.99h5.98V8l2.47-1.5L20 8V1.04h1c1.05 0 2 .96 2 1.99V17c0 1.03-.95 2-2 2H9.05c-1.05 0-1.99-.95-1.99-2v-1h1.99v-2H7.06v-3h1.99zM1 18h2v-3H1v-2h2v-3H1V8h2V5h2v3H3v2h2v3H3v2h2v3H3v2h2v1h16v2H5a2 2 0 0 1-2-2v-1H1z"></path></svg>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            NoughtQ的笔记本
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              JavaScript 浏览器相关
            
          </span>
</div>
</div>
</div>
<form class="md-header__option" data-md-component="palette">
<input aria-label="Dark Mode" class="md-option" data-md-color-accent="indigo" data-md-color-media="(prefer-color-scheme: dark)" data-md-color-primary="indigo" data-md-color-scheme="slate" id="__palette_0" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_1" hidden="" title="Dark Mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"></path></svg>
</label>
<input aria-label="Light Mode" class="md-option" data-md-color-accent="indigo" data-md-color-media="(prefer-color-scheme: light)" data-md-color-primary="indigo" data-md-color-scheme="default" id="__palette_1" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_0" hidden="" title="Light Mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"></path></svg>
</label>
</form>
<script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="搜索" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="搜索" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
<svg viewbox="0 0 320 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256l137.3-137.4c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"></path></svg>
</label>
<nav aria-label="查找" class="md-search__options">
<a aria-label="分享" class="md-search__icon md-icon" data-clipboard="" data-clipboard-text="" data-md-component="search-share" href="javascript:void(0)" tabindex="-1" title="分享">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"></path></svg>
</a>
<button aria-label="清空当前内容" class="md-search__icon md-icon" tabindex="-1" title="清空当前内容" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>
</button>
</nav>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="" tabindex="0">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
<ol class="md-search-result__list" role="presentation"></ol>
</div>
</div>
</div>
</div>
</div>
<div class="md-header__source">
<a class="md-source" data-md-component="source" href="https://github.com/noughtq/notebook" title="前往仓库">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"></path></svg>
</div>
<div class="md-source__repository">
    NoughtQ/Notebook
  </div>
</a>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<nav aria-label="标签" class="md-tabs" data-md-component="tabs">
<div class="md-grid">
<ul class="md-tabs__list">
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../index.html">
          
  
    
  
  🏫主页

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../lang/index.html">
          
  
    
  
  🔡语言

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../math/index.html">
          
  
    
  
  📊数学相关

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../algorithms/index.html">
          
  
    
  
  🧮算法相关

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../software/index.html">
          
  
    
  
  💾软件相关

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../system/index.html">
          
  
    
  
  💻系统相关

        </a>
</li>
<li class="md-tabs__item md-tabs__item--active">
<a class="md-tabs__link" href="../../index.html">
          
  
    
  
  🌏Web相关

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../sec/ctf-101/index.html">
          
  
    
  
  🛡️信息安全

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../ai/cs188/index.html">
          
  
    
  
  🤖人工智能

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../misc/index.html">
          
  
    
  
  🗃️杂项

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../tools/index.html">
          
  
    
  
  🛠️工具

        </a>
</li>
</ul>
</div>
</nav>
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="导航栏" class="md-nav md-nav--primary md-nav--lifted" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="NoughtQ的笔记本" class="md-nav__button md-logo" data-md-component="logo" href="../../.." title="NoughtQ的笔记本">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.05 9H7.06V6h1.99V4.03H7.06v-1c0-1.11.89-1.99 1.99-1.99h5.98V8l2.47-1.5L20 8V1.04h1c1.05 0 2 .96 2 1.99V17c0 1.03-.95 2-2 2H9.05c-1.05 0-1.99-.95-1.99-2v-1h1.99v-2H7.06v-3h1.99zM1 18h2v-3H1v-2h2v-3H1V8h2V5h2v3H3v2h2v3H3v2h2v3H3v2h2v1h16v2H5a2 2 0 0 1-2-2v-1H1z"></path></svg>
</a>
    NoughtQ的笔记本
  </label>
<div class="md-nav__source">
<a class="md-source" data-md-component="source" href="https://github.com/noughtq/notebook" title="前往仓库">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"></path></svg>
</div>
<div class="md-source__repository">
    NoughtQ/Notebook
  </div>
</a>
</div>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
<a class="md-nav__link" href="../../../index.html">
<span class="md-ellipsis">
    🏫主页
  </span>
<span class="md-nav__icon md-icon"></span>
</a>
</li>
<li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
<a class="md-nav__link" href="../../../lang/index.html">
<span class="md-ellipsis">
    🔡语言
  </span>
<span class="md-nav__icon md-icon"></span>
</a>
</li>
<li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
<a class="md-nav__link" href="../../../math/index.html">
<span class="md-ellipsis">
    📊数学相关
  </span>
<span class="md-nav__icon md-icon"></span>
</a>
</li>
<li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
<a class="md-nav__link" href="../../../algorithms/index.html">
<span class="md-ellipsis">
    🧮算法相关
  </span>
<span class="md-nav__icon md-icon"></span>
</a>
</li>
<li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
<a class="md-nav__link" href="../../../software/index.html">
<span class="md-ellipsis">
    💾软件相关
  </span>
<span class="md-nav__icon md-icon"></span>
</a>
</li>
<li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
<a class="md-nav__link" href="../../../system/index.html">
<span class="md-ellipsis">
    💻系统相关
  </span>
<span class="md-nav__icon md-icon"></span>
</a>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_7" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../index.html">
<span class="md-ellipsis">
    🌏Web相关
  </span>
</a>
<label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="true" aria-labelledby="__nav_7_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_7">
<span class="md-nav__icon md-icon"></span>
            🌏Web相关
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../model.html">
<span class="md-ellipsis">
    网络模型
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../security.html">
<span class="md-ellipsis">
    HTTP 安全相关知识
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_7_4" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../index.html">
<span class="md-ellipsis">
    前端
  </span>
</a>
<label class="md-nav__link" for="__nav_7_4" id="__nav_7_4_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="true" aria-labelledby="__nav_7_4_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_7_4">
<span class="md-nav__icon md-icon"></span>
            前端
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../html.html">
<span class="md-ellipsis">
    HTML
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../css.html">
<span class="md-ellipsis">
    CSS
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_7_4_4" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="index.html">
<span class="md-ellipsis">
    JavaScript
  </span>
</a>
<label class="md-nav__link" for="__nav_7_4_4" id="__nav_7_4_4_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="true" aria-labelledby="__nav_7_4_4_label" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_7_4_4">
<span class="md-nav__icon md-icon"></span>
            JavaScript
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="basic.html">
<span class="md-ellipsis">
    JavaScript 基础部分
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
<span class="md-ellipsis">
    JavaScript 浏览器相关
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="browser.html">
<span class="md-ellipsis">
    JavaScript 浏览器相关
  </span>
</a>
<nav aria-label="目录" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
        目录
      </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#document">
<span class="md-ellipsis">
      Document
    </span>
</a>
<nav aria-label="Document" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#dom-导航属性">
<span class="md-ellipsis">
      DOM 导航属性
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#获取元素">
<span class="md-ellipsis">
      获取元素
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#属性">
<span class="md-ellipsis">
      属性
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#修改页面">
<span class="md-ellipsis">
      修改页面
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#事件">
<span class="md-ellipsis">
      事件
    </span>
</a>
<nav aria-label="事件" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#基础部分">
<span class="md-ellipsis">
      基础部分
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#捕获和冒泡">
<span class="md-ellipsis">
      捕获和冒泡
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#鼠标事件">
<span class="md-ellipsis">
      鼠标事件
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#表单">
<span class="md-ellipsis">
      表单
    </span>
</a>
<nav aria-label="表单" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#属性方法">
<span class="md-ellipsis">
      属性、方法
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#事件_1">
<span class="md-ellipsis">
      事件
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#异步">
<span class="md-ellipsis">
      异步
    </span>
</a>
<nav aria-label="异步" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#同步和异步">
<span class="md-ellipsis">
      同步和异步
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#promise">
<span class="md-ellipsis">
      Promise
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#asyncawait">
<span class="md-ellipsis">
      async/await
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#worker">
<span class="md-ellipsis">
      worker
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#web-api">
<span class="md-ellipsis">
      Web API
    </span>
</a>
<nav aria-label="Web API" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#fetch">
<span class="md-ellipsis">
      Fetch
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#url-对象">
<span class="md-ellipsis">
      URL 对象
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#xmlhttprequest">
<span class="md-ellipsis">
      XMLHttpRequest
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
<a class="md-nav__link" href="../vue/index.html">
<span class="md-ellipsis">
    Vue.js
  </span>
<span class="md-nav__icon md-icon"></span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
<a class="md-nav__link" href="../../backend/index.html">
<span class="md-ellipsis">
    后端
  </span>
<span class="md-nav__icon md-icon"></span>
</a>
</li>
<li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
<a class="md-nav__link" href="../../tools/index.html">
<span class="md-ellipsis">
    工具
  </span>
<span class="md-nav__icon md-icon"></span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
<a class="md-nav__link" href="../../../sec/ctf-101/index.html">
<span class="md-ellipsis">
    🛡️信息安全
  </span>
<span class="md-nav__icon md-icon"></span>
</a>
</li>
<li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
<a class="md-nav__link" href="../../../ai/cs188/index.html">
<span class="md-ellipsis">
    🤖人工智能
  </span>
<span class="md-nav__icon md-icon"></span>
</a>
</li>
<li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
<a class="md-nav__link" href="../../../misc/index.html">
<span class="md-ellipsis">
    🗃️杂项
  </span>
<span class="md-nav__icon md-icon"></span>
</a>
</li>
<li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
<a class="md-nav__link" href="../../../tools/index.html">
<span class="md-ellipsis">
    🛠️工具
  </span>
<span class="md-nav__icon md-icon"></span>
</a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="目录" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
        目录
      </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#document">
<span class="md-ellipsis">
      Document
    </span>
</a>
<nav aria-label="Document" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#dom-导航属性">
<span class="md-ellipsis">
      DOM 导航属性
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#获取元素">
<span class="md-ellipsis">
      获取元素
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#属性">
<span class="md-ellipsis">
      属性
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#修改页面">
<span class="md-ellipsis">
      修改页面
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#事件">
<span class="md-ellipsis">
      事件
    </span>
</a>
<nav aria-label="事件" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#基础部分">
<span class="md-ellipsis">
      基础部分
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#捕获和冒泡">
<span class="md-ellipsis">
      捕获和冒泡
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#鼠标事件">
<span class="md-ellipsis">
      鼠标事件
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#表单">
<span class="md-ellipsis">
      表单
    </span>
</a>
<nav aria-label="表单" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#属性方法">
<span class="md-ellipsis">
      属性、方法
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#事件_1">
<span class="md-ellipsis">
      事件
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#异步">
<span class="md-ellipsis">
      异步
    </span>
</a>
<nav aria-label="异步" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#同步和异步">
<span class="md-ellipsis">
      同步和异步
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#promise">
<span class="md-ellipsis">
      Promise
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#asyncawait">
<span class="md-ellipsis">
      async/await
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#worker">
<span class="md-ellipsis">
      worker
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#web-api">
<span class="md-ellipsis">
      Web API
    </span>
</a>
<nav aria-label="Web API" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#fetch">
<span class="md-ellipsis">
      Fetch
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#url-对象">
<span class="md-ellipsis">
      URL 对象
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#xmlhttprequest">
<span class="md-ellipsis">
      XMLHttpRequest
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<h1 id="javascript-浏览器相关"><span>JavaScript<span class="heti-spacing"> </span></span>浏览器相关<a class="headerlink" href="#javascript-浏览器相关" title="Permanent link">⚓︎</a></h1>
<div style="margin-top: -30px; font-size: 0.9em; opacity: 0.7;">
<p><span class="twemoji"><svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 2A10 10 0 0 0 2 12a10 10 0 0 0 10 10 10 10 0 0 0 10-10h-2a8 8 0 0 1-8 8 8 8 0 0 1-8-8 8 8 0 0 1 8-8zm6.78 1a.7.7 0 0 0-.48.2l-1.22 1.21 2.5 2.5L20.8 5.7c.26-.26.26-.7 0-.95L19.25 3.2c-.13-.13-.3-.2-.47-.2m-2.41 2.12L9 12.5V15h2.5l7.37-7.38z"></path></svg></span> 约<span class="heti-skip"><span class="heti-spacing"> </span>9142<span class="heti-spacing"> </span></span>个字 <span class="twemoji"><svg viewbox="0 0 640 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M392.8 1.2c-17-4.9-34.7 5-39.6 22l-128 448c-4.9 17 5 34.7 22 39.6s34.7-5 39.6-22l128-448c4.9-17-5-34.7-22-39.6m80.6 120.1c-12.5 12.5-12.5 32.8 0 45.3l89.3 89.4-89.4 89.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0l112-112c12.5-12.5 12.5-32.8 0-45.3l-112-112c-12.5-12.5-32.8-12.5-45.3 0zm-306.7 0c-12.5-12.5-32.8-12.5-45.3 0l-112 112c-12.5 12.5-12.5 32.8 0 45.3l112 112c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L77.3 256l89.4-89.4c12.5-12.5 12.5-32.8 0-45.3"></path></svg></span> <span>681<span class="heti-spacing"> </span></span>行代码 <span class="twemoji"><svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 20c4.42 0 8-3.58 8-8s-3.58-8-8-8-8 3.58-8 8 3.58 8 8 8m0-18c5.5 0 10 4.5 10 10s-4.5 10-10 10C6.47 22 2 17.5 2 12S6.5 2 12 2m.5 11H11V7h1.5v4.26l3.7-2.13.75 1.3z"></path></svg></span> 预计阅读时间<span class="heti-skip"><span class="heti-spacing"> </span>54<span class="heti-spacing"> </span></span>分钟</p>
</div>
<h2 id="document">Document<a class="headerlink" href="#document" title="Permanent link">⚓︎</a></h2>
<p><span>JS<span class="heti-spacing"> </span></span>在浏览器运行时的架构图</p>
<figure style=" width: 50%">
<img alt="" src="../images/js/7_dark.png#only-dark"/>
<img alt="" src="../images/js/7_light.png#only-light"/>
<figcaption></figcaption>
</figure>
<ul>
<li><code>window</code> 既作为<span class="heti-skip"><span class="heti-spacing"> </span>JS<span class="heti-spacing"> </span></span>代码的全局对象，也代表“浏览器窗口”，并提供了控制它的方法</li>
<li>
<p><span>DOM(<span class="heti-spacing"> </span></span>文档对象模型<span><span class="heti-spacing"> </span>)</span>：将每个<span class="heti-skip"><span class="heti-spacing"> </span>HTML<span class="heti-spacing"> </span></span>标签，以及标签内的文本视为对象，这些对象都可以被<span class="heti-skip"><span class="heti-spacing"> </span>JS<span class="heti-spacing"> </span></span>访问和控制</p>
<ul>
<li><span>DOM<span class="heti-spacing"> </span></span>树：将这些对象根据<span class="heti-skip"><span class="heti-spacing"> </span>HTML<span class="heti-spacing"> </span></span>内部结构画成一棵树，这棵树也可以看作是由各种节点构成，下面是常见的几种节点：<ul>
<li><code>document</code>：<span>DOM<span class="heti-spacing"> </span></span>的入口点</li>
<li>元素节点：<span>HTML<span class="heti-spacing"> </span></span>标签</li>
<li>文本节点：文本</li>
<li>注释：虽然不显示，但是<span class="heti-skip"><span class="heti-spacing"> </span>JS<span class="heti-spacing"> </span></span>可以从<span class="heti-skip"><span class="heti-spacing"> </span>DOM<span class="heti-spacing"> </span></span>树中读取</li>
</ul>
</li>
</ul>
</li>
<li>
<p><span>BOM(<span class="heti-spacing"> </span></span>浏览器对象模型<span><span class="heti-spacing"> </span>)</span>：<span>DOM<span class="heti-spacing"> </span></span>之外的其他对象，比如</p>
<ul>
<li><span>navigator<span class="heti-spacing"> </span></span>对象：提供有关浏览器和操作系统的背景信息</li>
<li><span>location<span class="heti-spacing"> </span></span>对象：允许读取当前<span><span class="heti-spacing"> </span>URL</span>，并可以将浏览器重定向到新的<span><span class="heti-spacing"> </span>URL</span></li>
<li><code>alert/confirm/prompt</code> 函数也是<span class="heti-skip"><span class="heti-spacing"> </span>BOM<span class="heti-spacing"> </span></span>的一部分</li>
</ul>
</li>
</ul>
<h3 id="dom-导航属性"><span>DOM<span class="heti-spacing"> </span></span>导航属性<a class="headerlink" href="#dom-导航属性" title="Permanent link">⚓︎</a></h3>
<p>下面列出的导航属性引用<strong>所有节点</strong>：</p>
<figure style=" width: 50%">
<img alt="" src="../images/js/8_dark.png#only-dark"/>
<img alt="" src="../images/js/8_light.png#only-light"/>
<figcaption></figcaption>
</figure>
<ul>
<li>顶层<ul>
<li><code>&lt;html&gt;</code> = <code>document.documentElement</code></li>
<li><code>&lt;body&gt;</code> = <code>document.body</code><ul>
<li>如果 <code>&lt;body&gt;</code> 内运行不在 <code>&lt;body&gt;</code> 内的脚本（比如 <code>&lt;header&gt;</code> 里有<span class="heti-skip"><span class="heti-spacing"> </span>JS<span class="heti-spacing"> </span></span>代码<heti-adjacent class="heti-adjacent-half">）</heti-adjacent>，那么 <code>document.body</code> 的值为 <code>null</code></li>
</ul>
</li>
<li><code>&lt;head&gt;</code> = <code>document.head</code></li>
</ul>
</li>
<li>子节点<ul>
<li><code>.childNodes</code>：列出所有子节点（可看做集合<heti-adjacent class="heti-adjacent-half">）</heti-adjacent>，包括文本节点<ul>
<li>可以使用 <code>for...of</code> 循环遍历子节点</li>
<li>可以使用方括号括起来的索引访问单个子节点</li>
<li><code>.childNodes.length</code>：子节点个数</li>
<li>无法使用数组方法</li>
</ul>
</li>
<li><code>.firstChild</code>：第一个子元素</li>
<li><code>.lastChild</code>：最后一个子元素</li>
<li><code>.hasChildNodes()</code>：检查是否有子节点</li>
</ul>
</li>
<li>兄弟节点<ul>
<li><code>nextSibling</code>：下一个兄弟节点</li>
<li><code>previousSibling</code>：上一个兄弟节点</li>
</ul>
</li>
<li>父节点：<code>parentNode</code></li>
</ul>
<hr/>
<p>下面列出的导航属性只考虑<strong>元素节点</strong>：</p>
<figure style=" width: 50%">
<img alt="" src="../images/js/9_dark.png#only-dark"/>
<img alt="" src="../images/js/9_light.png#only-light"/>
<figcaption></figcaption>
</figure>
<ul>
<li>子节点<ul>
<li><code>children</code>：列出所有子元素节点</li>
<li><code>firstElementChild</code>：第一个子元素节点</li>
<li><code>lastElementChild</code>：最后一个子元素节点</li>
</ul>
</li>
<li>兄弟节点<ul>
<li><code>previousElementSibling</code>：前一个兄弟元素节点</li>
<li><code>nextElementSibling</code>：后一个兄弟元素节点</li>
</ul>
</li>
<li>父元素节点：<code>parentElement</code></li>
</ul>
<hr/>
<p><strong>表格</strong></p>
<ul>
<li><code>&lt;table&gt;</code> <ul>
<li><code>table.rows</code>：<code>&lt;tr&gt;</code> 元素的集合</li>
<li><code>table.caption</code>：引用元素 <code>&lt;caption&gt;</code></li>
<li><code>table.tHead</code>：引用元素 <code>&lt;thead&gt;</code></li>
<li><code>table.tFoot</code>：引用元素 <code>&lt;tfoot&gt;</code></li>
<li><code>table.tBodies</code>：<code>&lt;tbody&gt;</code> 元素的集合</li>
</ul>
</li>
<li><code>&lt;thead&gt;</code>、<code>&lt;tfoot&gt;</code>、<code>&lt;tbody&gt;</code> 元素的 <code>rows</code> 属性<ul>
<li><code>thead.rows</code></li>
<li><code>tfoot.rows</code></li>
<li><code>tbody.rows</code> </li>
</ul>
</li>
<li><code>&lt;tr&gt;</code><ul>
<li><code>tr.cells</code>：在给定 <code>&lt;tr&gt;</code> 中 <code>&lt;td&gt;</code> 和 <code>&lt;th&gt;</code> 单元格的集合</li>
<li><code>tr.sectionRowIndex</code>：给定 <code>&lt;tr&gt;</code> 在封闭的 <code>&lt;thead&gt;/&lt;tbody&gt;/&lt;tfoot&gt;</code> 元素内的位置（索引）</li>
<li><code>tr.rowIndex</code> —— 在整个表格中 <code>&lt;tr&gt;</code> 的位置（索引）</li>
</ul>
</li>
<li><code>&lt;td&gt;</code> 和 <code>&lt;th&gt;</code><ul>
<li><code>td.cellIndex</code>：在封闭的 <code>&lt;tr&gt;</code> 中单元格的编号</li>
</ul>
</li>
</ul>
<div class="admonition waring">
<p class="admonition-title">注意</p>
<ul>
<li>在<span class="heti-skip"><span class="heti-spacing"> </span>DOM<span class="heti-spacing"> </span></span>中，值为 <code>null</code> 不代表节点不存在</li>
<li><span>DOM<span class="heti-spacing"> </span></span>集合（比如 <code>.childNodes</code>）是只读的（不可修改<heti-adjacent class="heti-adjacent-half">）</heti-adjacent>、实时的</li>
</ul>
</div>
<h3 id="获取元素">获取元素<a class="headerlink" href="#获取元素" title="Permanent link">⚓︎</a></h3>
<ul>
<li><code>document.getElementById(elem)</code>：获取 <code>id</code> 属性值为 <code>elem</code> 的元素</li>
<li><code>document.querySelectorAll(selector)</code>：获取与给定<span class="heti-skip"><span class="heti-spacing"> </span>CSS<span class="heti-spacing"> </span></span>选择器匹配的所有元素（一个静态的集合<heti-adjacent class="heti-adjacent-half">）</heti-adjacent>，选择器可以是伪类</li>
<li><code>document.querySelector(selector)</code>：获取与给定<span class="heti-skip"><span class="heti-spacing"> </span>CSS<span class="heti-spacing"> </span></span>选择器匹配的第一个元素</li>
<li><code>elem.matches(selector)</code>：检查元素 <code>elem</code> 是否与给定的<span class="heti-skip"><span class="heti-spacing"> </span>CSS<span class="heti-spacing"> </span></span>选择器匹配，返回布尔值</li>
<li><code>elem.closest(selector)</code>：查找与<span class="heti-skip"><span class="heti-spacing"> </span>CSS<span class="heti-spacing"> </span></span>选择器匹配的最近的祖先（包括元素 <code>elem</code>）</li>
</ul>
<details class="example">
<summary>例子</summary>
<div class="language-html highlight"><pre><span></span><code><span id="__span-0-1"><a href="#__codelineno-0-1" id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Contents<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
</span><span id="__span-0-2"><a href="#__codelineno-0-2" id="__codelineno-0-2" name="__codelineno-0-2"></a>
</span><span id="__span-0-3"><a href="#__codelineno-0-3" id="__codelineno-0-3" name="__codelineno-0-3"></a><span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">"contents"</span><span class="p">&gt;</span>
</span><span id="__span-0-4"><a href="#__codelineno-0-4" id="__codelineno-0-4" name="__codelineno-0-4"></a>    <span class="p">&lt;</span><span class="nt">ul</span> <span class="na">class</span><span class="o">=</span><span class="s">"book"</span><span class="p">&gt;</span>
</span><span id="__span-0-5"><a href="#__codelineno-0-5" id="__codelineno-0-5" name="__codelineno-0-5"></a>        <span class="p">&lt;</span><span class="nt">li</span> <span class="na">class</span><span class="o">=</span><span class="s">"chapter"</span><span class="p">&gt;</span>Chapter 1<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
</span><span id="__span-0-6"><a href="#__codelineno-0-6" id="__codelineno-0-6" name="__codelineno-0-6"></a>        <span class="p">&lt;</span><span class="nt">li</span> <span class="na">class</span><span class="o">=</span><span class="s">"chapter"</span><span class="p">&gt;</span>Chapter 2<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
</span><span id="__span-0-7"><a href="#__codelineno-0-7" id="__codelineno-0-7" name="__codelineno-0-7"></a>    <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
</span><span id="__span-0-8"><a href="#__codelineno-0-8" id="__codelineno-0-8" name="__codelineno-0-8"></a><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span><span id="__span-0-9"><a href="#__codelineno-0-9" id="__codelineno-0-9" name="__codelineno-0-9"></a>
</span><span id="__span-0-10"><a href="#__codelineno-0-10" id="__codelineno-0-10" name="__codelineno-0-10"></a><span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
</span><span id="__span-0-11"><a href="#__codelineno-0-11" id="__codelineno-0-11" name="__codelineno-0-11"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">chapter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">'.chapter'</span><span class="p">);</span><span class="w"> </span><span class="c1">// LI</span>
</span><span id="__span-0-12"><a href="#__codelineno-0-12" id="__codelineno-0-12" name="__codelineno-0-12"></a>
</span><span id="__span-0-13"><a href="#__codelineno-0-13" id="__codelineno-0-13" name="__codelineno-0-13"></a><span class="w">    </span><span class="nx">alert</span><span class="p">(</span><span class="nx">chapter</span><span class="p">.</span><span class="nx">closest</span><span class="p">(</span><span class="s1">'.book'</span><span class="p">));</span><span class="w"> </span><span class="c1">// UL</span>
</span><span id="__span-0-14"><a href="#__codelineno-0-14" id="__codelineno-0-14" name="__codelineno-0-14"></a><span class="w">    </span><span class="nx">alert</span><span class="p">(</span><span class="nx">chapter</span><span class="p">.</span><span class="nx">closest</span><span class="p">(</span><span class="s1">'.contents'</span><span class="p">));</span><span class="w"> </span><span class="c1">// DIV</span>
</span><span id="__span-0-15"><a href="#__codelineno-0-15" id="__codelineno-0-15" name="__codelineno-0-15"></a>
</span><span id="__span-0-16"><a href="#__codelineno-0-16" id="__codelineno-0-16" name="__codelineno-0-16"></a><span class="w">    </span><span class="nx">alert</span><span class="p">(</span><span class="nx">chapter</span><span class="p">.</span><span class="nx">closest</span><span class="p">(</span><span class="s1">'h1'</span><span class="p">));</span><span class="w"> </span><span class="c1">// null（因为 h1 不是祖先）</span>
</span><span id="__span-0-17"><a href="#__codelineno-0-17" id="__codelineno-0-17" name="__codelineno-0-17"></a><span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span></code></pre></div>
</details>
<ul>
<li><code>getElementsBy*</code> 方法系列（返回的是一个实时的集合<heti-adjacent class="heti-adjacent-half">）</heti-adjacent>：<ul>
<li><code>elem.getElementsByTagName(tag)</code> 查找具有给定标签的元素，并返回它们的集合。若 <code>tag</code> 值为 <code>*</code>，则查找所有标签</li>
<li><code>elem.getElementsByClassName(className)</code> 查找具有给定<span class="heti-skip"><span class="heti-spacing"> </span>CSS<span class="heti-spacing"> </span></span>类的元素</li>
<li><code>document.getElementsByName(name)</code> 查找在文档范围内具有给定<span class="heti-skip"><span class="heti-spacing"> </span>name<span class="heti-spacing"> </span></span>特性的元素（很少使用）</li>
</ul>
</li>
</ul>
<h3 id="属性">属性<a class="headerlink" href="#属性" title="Permanent link">⚓︎</a></h3>
<p>下面是一些常用的 <strong><span>DOM<span class="heti-spacing"> </span></span>属性</strong>（大小写敏感，有多种类型的值<heti-adjacent class="heti-adjacent-half">）</heti-adjacent>：</p>
<ul>
<li><code>.nodeType</code>：获取<span class="heti-skip"><span class="heti-spacing"> </span>DOM<span class="heti-spacing"> </span></span>节点的类型，有以下几种返回值（数字型）<ul>
<li><code>1</code>：元素节点</li>
<li><code>3</code>：文本节点</li>
<li><code>9</code>：<span>document<span class="heti-spacing"> </span></span>对象</li>
<li>其他，见<a href="https://dom.spec.whatwg.org/#node">规范</a></li>
</ul>
</li>
<li><code>.nodeName</code> 和 <code>tagName</code>：读取<span class="heti-skip"><span class="heti-spacing"> </span>DOM<span class="heti-spacing"> </span></span>节点的标签名（全部大写<heti-adjacent class="heti-adjacent-half">）</heti-adjacent>，它们的区别在于：<ul>
<li><code>.tagName</code> 仅适用于元素节点（若读取其他节点返回 <code>undefined</code>）</li>
<li><code>.nodeName</code> 适用于任意节点<ul>
<li>元素节点：同 <code>.tagName</code></li>
<li>其他节点：有一个对应节点类型的字符串</li>
</ul>
</li>
</ul>
</li>
<li><code>.innerHTML</code>：获取元素节点内的<span class="heti-skip"><span class="heti-spacing"> </span>HTML<span class="heti-spacing"> </span></span>内容，并以字符串的形式呈现<ul>
<li>对 <code>.innerHTML</code> 进行 <code>+=</code> 运算会完全覆写原来的内容，而不是在后面加上新内容，所以不要这么做</li>
<li>它会将获取的元素标签转化为有意义的内容，而不是把它当作字符串处理</li>
</ul>
</li>
<li><code>.outerHTML</code>：获取完整的<span class="heti-skip"><span class="heti-spacing"> </span>HTML<span class="heti-spacing"> </span></span>代码（包括标签<heti-adjacent class="heti-adjacent-half">）</heti-adjacent>，并以字符串的形式呈现<ul>
<li>与 <code>.innerHTML</code> 不同，写入 <code>.outerHTML</code> 不会修改<span class="heti-skip"><span class="heti-spacing"> </span>DOM<span class="heti-spacing"> </span></span>元素，而是将其从<span class="heti-skip"><span class="heti-spacing"> </span>DOM<span class="heti-spacing"> </span></span>中删除并在该位置插入新的<span><span class="heti-spacing"> </span>HTML</span>。</li>
</ul>
</li>
</ul>
<details class="example">
<summary>例子</summary>
<div class="language-html highlight"><pre><span></span><code><span id="__span-1-1"><a href="#__codelineno-1-1" id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>Hello, world!<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span><span id="__span-1-2"><a href="#__codelineno-1-2" id="__codelineno-1-2" name="__codelineno-1-2"></a>
</span><span id="__span-1-3"><a href="#__codelineno-1-3" id="__codelineno-1-3" name="__codelineno-1-3"></a><span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
</span><span id="__span-1-4"><a href="#__codelineno-1-4" id="__codelineno-1-4" name="__codelineno-1-4"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">div</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">'div'</span><span class="p">);</span>
</span><span id="__span-1-5"><a href="#__codelineno-1-5" id="__codelineno-1-5" name="__codelineno-1-5"></a>
</span><span id="__span-1-6"><a href="#__codelineno-1-6" id="__codelineno-1-6" name="__codelineno-1-6"></a><span class="w">    </span><span class="c1">// 使用 &lt;p&gt;...&lt;/p&gt; 替换 div.outerHTML</span>
</span><span id="__span-1-7"><a href="#__codelineno-1-7" id="__codelineno-1-7" name="__codelineno-1-7"></a><span class="w">    </span><span class="nx">div</span><span class="p">.</span><span class="nx">outerHTML</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'&lt;p&gt;A new element&lt;/p&gt;'</span><span class="p">;</span><span class="w"> </span><span class="c1">// (*)</span>
</span><span id="__span-1-8"><a href="#__codelineno-1-8" id="__codelineno-1-8" name="__codelineno-1-8"></a>
</span><span id="__span-1-9"><a href="#__codelineno-1-9" id="__codelineno-1-9" name="__codelineno-1-9"></a><span class="w">    </span><span class="c1">// 'div' 的值没有变化</span>
</span><span id="__span-1-10"><a href="#__codelineno-1-10" id="__codelineno-1-10" name="__codelineno-1-10"></a><span class="w">    </span><span class="nx">alert</span><span class="p">(</span><span class="nx">div</span><span class="p">.</span><span class="nx">outerHTML</span><span class="p">);</span><span class="w"> </span><span class="c1">// &lt;div&gt;Hello, world!&lt;/div&gt; (**)</span>
</span><span id="__span-1-11"><a href="#__codelineno-1-11" id="__codelineno-1-11" name="__codelineno-1-11"></a><span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span></code></pre></div>
<p><code>(*)</code> 行进行了以下过程：</p>
<ul>
<li><code>div</code> 被从文档（document）中移除</li>
<li>另一个<span class="heti-skip"><span class="heti-spacing"> </span>HTML<span class="heti-spacing"> </span></span>片段 <code>&lt;p&gt;A new element&lt;/p&gt;</code> 被插入到其位置上</li>
<li><code>div</code> 仍拥有其旧的值。新的<span class="heti-skip"><span class="heti-spacing"> </span>HTML<span class="heti-spacing"> </span></span>没有被赋值给任何变量</li>
</ul>
</details>
<ul>
<li><code>.nodeValue</code> 和 <code>.nodeData</code>：可获取除元素节点之外的节点（比如文本节点、注释等）内的<span class="heti-skip"><span class="heti-spacing"> </span>HTML<span class="heti-spacing"> </span></span>内容，并以字符串的形式呈现</li>
<li><code>.textContent</code>：对元素内的文本进行访问（不包括标签）<ul>
<li>它允许以安全方式写入文本，所有符号都被看作一般的字符</li>
</ul>
</li>
<li><code>.hidden</code>：指定元素是否可见，接受布尔值（类似<span class="heti-skip"><span class="heti-spacing"> </span>CSS<span class="heti-spacing"> </span></span><code>display: none</code>语句）</li>
<li><code>.value</code>：获取 <code>&lt;input&gt;</code>、<code>&lt;select&gt;</code>、<code>&lt;textarea&gt;</code> 等元素的值</li>
<li><code>.href</code>：获取 <code>&lt;a&gt;</code> 元素 <code>href</code> 属性的值</li>
<li><code>id</code>：获取所有元素 <code>id</code> 属性的值</li>
</ul>
<hr/>
<p>由于<span class="heti-skip"><span class="heti-spacing"> </span>DOM<span class="heti-spacing"> </span></span>节点本质上是一个<span class="heti-skip"><span class="heti-spacing"> </span>JS<span class="heti-spacing"> </span></span>对象，所以我们可以更改<span class="heti-skip"><span class="heti-spacing"> </span>DOM<span class="heti-spacing"> </span></span>节点的属性，比如：</p>
<div class="language-js highlight"><pre><span></span><code><span id="__span-2-1"><a href="#__codelineno-2-1" id="__codelineno-2-1" name="__codelineno-2-1"></a><span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">myData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-2-2"><a href="#__codelineno-2-2" id="__codelineno-2-2" name="__codelineno-2-2"></a><span class="w">  </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s1">'Caesar'</span><span class="p">,</span>
</span><span id="__span-2-3"><a href="#__codelineno-2-3" id="__codelineno-2-3" name="__codelineno-2-3"></a><span class="w">  </span><span class="nx">title</span><span class="o">:</span><span class="w"> </span><span class="s1">'Imperator'</span>
</span><span id="__span-2-4"><a href="#__codelineno-2-4" id="__codelineno-2-4" name="__codelineno-2-4"></a><span class="p">};</span>
</span><span id="__span-2-5"><a href="#__codelineno-2-5" id="__codelineno-2-5" name="__codelineno-2-5"></a>
</span><span id="__span-2-6"><a href="#__codelineno-2-6" id="__codelineno-2-6" name="__codelineno-2-6"></a><span class="c1">// 还可以添加方法</span>
</span><span id="__span-2-7"><a href="#__codelineno-2-7" id="__codelineno-2-7" name="__codelineno-2-7"></a><span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">sayTagName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-2-8"><a href="#__codelineno-2-8" id="__codelineno-2-8" name="__codelineno-2-8"></a><span class="w">  </span><span class="nx">alert</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">tagName</span><span class="p">);</span>
</span><span id="__span-2-9"><a href="#__codelineno-2-9" id="__codelineno-2-9" name="__codelineno-2-9"></a><span class="p">};</span>
</span></code></pre></div>
<p>可以通过 <code>Element.prototype</code> 为所有元素添加新属性：</p>
<div class="language-js highlight"><pre><span></span><code><span id="__span-3-1"><a href="#__codelineno-3-1" id="__codelineno-3-1" name="__codelineno-3-1"></a><span class="nx">Element</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">sayHi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-3-2"><a href="#__codelineno-3-2" id="__codelineno-3-2" name="__codelineno-3-2"></a><span class="w">  </span><span class="nx">alert</span><span class="p">(</span><span class="sb">`Hello, I'm </span><span class="si">${</span><span class="k">this</span><span class="p">.</span><span class="nx">tagName</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span><span id="__span-3-3"><a href="#__codelineno-3-3" id="__codelineno-3-3" name="__codelineno-3-3"></a><span class="p">};</span>
</span><span id="__span-3-4"><a href="#__codelineno-3-4" id="__codelineno-3-4" name="__codelineno-3-4"></a>
</span><span id="__span-3-5"><a href="#__codelineno-3-5" id="__codelineno-3-5" name="__codelineno-3-5"></a><span class="nb">document</span><span class="p">.</span><span class="nx">documentElement</span><span class="p">.</span><span class="nx">sayHi</span><span class="p">();</span><span class="w"> </span><span class="c1">// Hello, I'm HTML</span>
</span><span id="__span-3-6"><a href="#__codelineno-3-6" id="__codelineno-3-6" name="__codelineno-3-6"></a><span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">sayHi</span><span class="p">();</span><span class="w">            </span><span class="c1">// Hello, I'm BODY</span>
</span></code></pre></div>
<hr/>
<p>关于 <strong><span>HTML<span class="heti-spacing"> </span></span>属性</strong>（大小写不敏感，值为字符串型<heti-adjacent class="heti-adjacent-half">）</heti-adjacent>：</p>
<ul>
<li><code>elem.haAttribute(attr)</code>：检查该元素是否有 <code>attr</code> 属性</li>
<li><code>elem.getAttribute(attr)</code>：获取该元素 <code>attr</code> 属性的值</li>
<li><code>elem.setAttribute(attr, value)</code>：设置该元素 <code>attr</code> 属性的值为 <code>value</code></li>
<li><code>elem.removeAttribute(attr)</code>：移除该元素 <code>attr</code> 属性的值</li>
<li><code>elem.attributes</code>：读取该元素所有的属性，这会创建一个<span class="heti-skip"><span class="heti-spacing"> </span>Attr<span class="heti-spacing"> </span></span>类对象的集合，每个对象都有名为 <code>name</code> 和 <code>value</code> 的属性</li>
</ul>
<div class="admonition note">
<p class="admonition-title">注</p>
<p>所有以<span class="heti-skip"><span class="heti-spacing"> </span>"data-"<span class="heti-spacing"> </span></span>的<span class="heti-skip"><span class="heti-spacing"> </span>HTML<span class="heti-spacing"> </span></span>属性被保留供程序员使用（我们可以用这类名称设置自定义<span class="heti-skip"><span class="heti-spacing"> </span>HTML<span class="heti-spacing"> </span></span>属性<heti-adjacent class="heti-adjacent-half">）</heti-adjacent>，可以用<code>.dataset</code><span class="heti-skip"><span class="heti-spacing"> </span>DOM<span class="heti-spacing"> </span></span>属性使用</p>
<ul>
<li>比如 <code>&lt;body&gt;</code> 元素有一个名为 <code>data-about</code> 的<span class="heti-skip"><span class="heti-spacing"> </span>HTML<span class="heti-spacing"> </span></span>属性，那么可以通过 <code>document.body.dataset.about</code> 来获取它的值</li>
<li>如果属性名类似 <code>data-order-state</code> 由多词构成，那么它对应的<span class="heti-skip"><span class="heti-spacing"> </span>DOM<span class="heti-spacing"> </span></span>属性为 <code>dataset.orderState</code>（驼峰式）</li>
</ul>
</div>
<div class="admonition success">
<p class="admonition-title">建议</p>
<p>在大多数情况下，最好使用<span class="heti-skip"><span class="heti-spacing"> </span>DOM<span class="heti-spacing"> </span></span>属性，仅当<span class="heti-skip"><span class="heti-spacing"> </span>DOM<span class="heti-spacing"> </span></span>属性无法满足开发需求，并且真的需要特性时，才使用特性。</p>
</div>
<h3 id="修改页面">修改页面<a class="headerlink" href="#修改页面" title="Permanent link">⚓︎</a></h3>
<ul>
<li>创建<span class="heti-skip"><span class="heti-spacing"> </span>DOM<span class="heti-spacing"> </span></span>节点（不会直接出现在页面）<ul>
<li><code>document.createElement(tag)</code>：创建元素节点</li>
<li><code>document.createTextNode(text)</code>：创建文本节点</li>
</ul>
</li>
<li>插入（多个） <span>DOM<span class="heti-spacing"> </span></span>节点或字符串（自动转为文本节点）<ul>
<li><code>node.append(...nodes or strings)</code>：在节点末尾（内部）插入</li>
<li><code>node.prepend(...nodes or strings)</code>：在节点开头（内部）插入</li>
<li><code>node.before(...nodes or strings)</code>：在节点前面（外部）插入</li>
<li><code>node.after(...nodes or strings)</code>：在节点后面（外部）插入</li>
<li><code>node.replaceWith(...nodes or strings)</code>：将节点替换为给定的节点或字符串<blockquote>
<p>如果插入的字符串是一些特殊字符（比如 <code>&lt;</code>、<code>&gt;</code> 等<heti-adjacent class="heti-adjacent-half">）</heti-adjacent>，那么插入页面后会被转化为特殊编码（对应为 <code>&amp;lt;</code><heti-adjacent class="heti-adjacent-half">、</heti-adjacent><code>&amp;gt;</code>）</p>
</blockquote>
</li>
</ul>
</li>
<li>在相邻位置插入内容<ul>
<li><span>HTML<span class="heti-spacing"> </span></span>字符串（插入的<span class="heti-skip"><span class="heti-spacing"> </span>HTML<span class="heti-spacing"> </span></span>标签有意义<heti-adjacent class="heti-adjacent-half">）</heti-adjacent>：<code>elem.insertAdjacentHTML(where, html)</code></li>
<li>文本：<code>elem.insertAdjacentText(where, text)</code></li>
<li>元素：<code>elem.insertAdjacentElement(where, elem)</code></li>
<li>第一个参数 <code>where</code> 是代码字<span><span class="heti-spacing"> </span>(code word)</span>，指定相对于 <code>elem</code> 的插入位置，可用值有：<ul>
<li><code>"beforebegin"</code>：在 <code>elem</code> 前面（外部）插入</li>
<li><code>"afterbegin"</code>：在 <code>elem</code> 开头（内部）插入</li>
<li><code>"beforeend"</code>：在 <code>elem</code> 末尾（内部）插入</li>
<li><code>"afterend"</code>：在 <code>elem</code> 后面（外部）插入</li>
</ul>
</li>
</ul>
</li>
<li>节点移除：<code>node.remove()</code><ul>
<li>移动节点到另外的位置时，无需将其从原来的位置中删除</li>
</ul>
</li>
<li>克隆节点：<code>elem.cloneNode(bool)</code>，可接受的值有<ul>
<li><code>true</code>：克隆元素的所有<span class="heti-skip"><span class="heti-spacing"> </span>HTML<span class="heti-spacing"> </span></span>属性和子元素</li>
<li><code>false</code>：不会克隆子元素</li>
</ul>
</li>
<li>老式的<span class="heti-skip"><span class="heti-spacing"> </span>DOM<span class="heti-spacing"> </span></span>操作（平时不用，仅作了解<heti-adjacent class="heti-adjacent-half">）</heti-adjacent>：<ul>
<li><code>parentElem.appendChild(node)</code>：将 <code>node</code> 插入 <code>parentElem</code> 的末尾（内部）</li>
<li><code>parentElem.insertBefore(node, nextSibling)</code>：在 <code>parentElem</code> 的 <code>nextSibling</code> 前插入 <code>node</code></li>
<li><code>parentElem.replaceChild(node, oldChild)</code>：替换子节点 <code>oldChild</code> 为 <code>node</code></li>
<li><code>parentElem.removeChild(node)</code>：移除子节点 <code>node</code></li>
<li><code>document.write(html)</code>：在页面加载完成之前将<span class="heti-skip"><span class="heti-spacing"> </span>HTML<span class="heti-spacing"> </span></span>附加到页面。若在页面加载后调用该函数则会覆写原来页面的内容</li>
</ul>
</li>
<li>
<p>管理<span class="heti-skip"><span class="heti-spacing"> </span>CSS<span class="heti-spacing"> </span></span>样式（开头为元素 <code>elem</code><heti-adjacent class="heti-adjacent-half">）</heti-adjacent>：</p>
<ul>
<li><code>.className</code>：返回<span class="heti-skip"><span class="heti-spacing"> </span>HTML<span class="heti-spacing"> </span></span><code>class</code>属性的值</li>
<li><code>.classList</code>：用于控制单个类，可遍历。它有以下方法：<ul>
<li><code>.add(class)</code>、<code>.remove(class)</code>：添加<span class="heti-skip"><span class="heti-spacing"> </span>/<span class="heti-spacing"> </span></span>移除类</li>
<li><code>.toggle(class)</code>：若不存在类 <code>class</code> 就添加，若存在则删除该类</li>
<li><code>.contains(class)</code>：检查类是否存在，返回布尔值</li>
</ul>
</li>
<li>
<p><code>.style</code>：对应<span class="heti-skip"><span class="heti-spacing"> </span>HTML<span class="heti-spacing"> </span></span><code>style</code>属性</p>
<ul>
<li>后面可以接着它包含的<span class="heti-skip"><span class="heti-spacing"> </span>CSS<span class="heti-spacing"> </span></span>属性，比如 <code>elem.style.width</code> 对应 <code>style</code> 的 <code>width</code> 属性</li>
<li>对于多词属性（比如 <code>background-color</code><heti-adjacent class="heti-adjacent-half">）</heti-adjacent>，需要使用驼峰表示法（对应 <code>elem.style.backgroundColor</code>）</li>
<li>移除样式属性：<ul>
<li>将其赋值为空字符串（比如 <code>elem.style.display = ""</code>）</li>
<li><code>elem.style.removeProperty('style_property')</code></li>
</ul>
</li>
<li><code>.cssText</code>：对样式进行完全的覆写，比如：</li>
</ul>
<div class="language-html highlight"><pre><span></span><code><span id="__span-4-1"><a href="#__codelineno-4-1" id="__codelineno-4-1" name="__codelineno-4-1"></a><span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">"div"</span><span class="p">&gt;</span>Button<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span><span id="__span-4-2"><a href="#__codelineno-4-2" id="__codelineno-4-2" name="__codelineno-4-2"></a>
</span><span id="__span-4-3"><a href="#__codelineno-4-3" id="__codelineno-4-3" name="__codelineno-4-3"></a><span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
</span><span id="__span-4-4"><a href="#__codelineno-4-4" id="__codelineno-4-4" name="__codelineno-4-4"></a><span class="w">    </span><span class="nx">div</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">cssText</span><span class="o">=</span><span class="sb">`color: red !important;</span>
</span><span id="__span-4-5"><a href="#__codelineno-4-5" id="__codelineno-4-5" name="__codelineno-4-5"></a><span class="sb">        background-color: yellow;</span>
</span><span id="__span-4-6"><a href="#__codelineno-4-6" id="__codelineno-4-6" name="__codelineno-4-6"></a><span class="sb">        width: 100px;</span>
</span><span id="__span-4-7"><a href="#__codelineno-4-7" id="__codelineno-4-7" name="__codelineno-4-7"></a><span class="sb">        text-align: center;</span>
</span><span id="__span-4-8"><a href="#__codelineno-4-8" id="__codelineno-4-8" name="__codelineno-4-8"></a><span class="sb">    `</span><span class="p">;</span>
</span><span id="__span-4-9"><a href="#__codelineno-4-9" id="__codelineno-4-9" name="__codelineno-4-9"></a><span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span></code></pre></div>
<ul>
<li>读取样式：<code>getComputedStyle(elem[, pseudo])</code> 函数<ul>
<li>其中 <code>elem</code> 为要读取样式值的元素，<code>pseudo</code> 表示伪元素（）</li>
<li>返回值是一个类似 <code>elem.style</code> 的对象，只读，无法修改</li>
<li>调整元素大小：下面是<span class="heti-skip"><span class="heti-spacing"> </span>CSS<span class="heti-spacing"> </span></span>盒子模型与<span class="heti-skip"><span class="heti-spacing"> </span>JS<span class="heti-spacing"> </span></span>几何属性的对应图</li>
</ul>
</li>
</ul>
<p><figure markdown="span" style=" width: 50%">
<img alt="" src="../images/js/12_dark.png#only-dark"/>
<img alt="" src="../images/js/12_light.png#only-light"/>
<figcaption></figcaption>
</figure>
<figure markdown="span" style=" width: 50%">
<img alt="" src="../images/js/13_dark.png#only-dark"/>
<img alt="" src="../images/js/13_light.png#only-light"/>
<figcaption></figcaption>
</figure></p>
<ul>
<li><code>offsetParent</code> 是外面最接近的祖先，包括：<ul>
<li><span>CSS<span class="heti-spacing"> </span></span>定位（<code>position</code>，可选值有 <code>absolute</code>、<code>relative</code>、<code>fixed</code><heti-adjacent class="heti-adjacent-half">、</heti-adjacent><code>sticky</code>）</li>
<li><code>&lt;td&gt;</code>、<code>&lt;th&gt;</code>、<code>&lt;table&gt;</code></li>
<li><code>&lt;body&gt;</code></li>
</ul>
</li>
<li><code>.offsetLeft</code>、<code>offsetTop</code>：相对于 <code>offsetParent</code> 左上角的<span class="heti-skip"><span class="heti-spacing"> </span>x/y<span class="heti-spacing"> </span></span>坐标（类似外边距吧）</li>
</ul>
<p><figure markdown="span" style=" width: 40%">
<img alt="" src="../images/js/14_dark.png#only-dark"/>
<img alt="" src="../images/js/14_light.png#only-light"/>
<figcaption></figcaption>
</figure></p>
<ul>
<li><code>offsetWidth</code>、<code>offsetHeight</code>：包括元素外部的宽高（内容<span class="heti-skip"><span class="heti-spacing"> </span>+<span class="heti-spacing"> </span></span>内边距<span class="heti-skip"><span class="heti-spacing"> </span>+<span class="heti-spacing"> </span></span>边框厚度）</li>
</ul>
<p><figure markdown="span" style=" width: 40%">
<img alt="" src="../images/js/15_dark.png#only-dark"/>
<img alt="" src="../images/js/15_light.png#only-light"/>
<figcaption></figcaption>
</figure></p>
<ul>
<li><code>clientTop</code>、<code>clientLeft</code>：分别表示上边框宽度和左边框宽度</li>
</ul>
<p><figure markdown="span" style=" width: 40%">
<img alt="" src="../images/js/16_dark.png#only-dark"/>
<img alt="" src="../images/js/16_light.png#only-light"/>
<figcaption></figcaption>
</figure></p>
<ul>
<li><code>clientWidth</code>、<code>clientHeight</code>：分别表示边框内的宽和高，包括的区域是盒子内容<span class="heti-skip"><span class="heti-spacing"> </span>+<span class="heti-spacing"> </span></span>内边距，但不包括垂直<span class="heti-skip"><span class="heti-spacing"> </span>/<span class="heti-spacing"> </span></span>水平滚动条的宽度</li>
</ul>
<p><figure markdown="span" style=" width: 40%">
<img alt="" src="../images/js/17_dark.png#only-dark"/>
<img alt="" src="../images/js/17_light.png#only-light"/>
<figcaption></figcaption>
</figure></p>
<ul>
<li><code>scrollWidth</code>、<code>scrollHeight</code>：在 <code>clientWidth/clientHeight</code> 的基础上还算上了滚动条隐藏的内容的宽高</li>
</ul>
<p><figure markdown="span" style=" width: 40%">
<img alt="" src="../images/js/18_dark.png#only-dark"/>
<img alt="" src="../images/js/18_light.png#only-light"/>
<figcaption></figcaption>
</figure> </p>
<ul>
<li><code>scrollLeft</code>、<code>scrollTop</code>：分别表示左方和上方被隐藏内容的宽度<span class="heti-skip"><span class="heti-spacing"> </span>/<span class="heti-spacing"> </span></span>高度（即已经滚动了多少内容）<ul>
<li>这里列出的“调整元素大小”的属性中，只有该属性是可以修改的，可以决定浏览器滚动到何种程度</li>
</ul>
</li>
</ul>
<p><figure markdown="span" style=" width: 40%">
<img alt="" src="../images/js/19_dark.png#only-dark"/>
<img alt="" src="../images/js/19_light.png#only-light"/>
<figcaption></figcaption>
</figure> </p>
</li>
<li>
<p>坐标：有两套坐标系，分别是相对于窗口（用 <code>clientX</code> 和 <code>clientY</code> 表示）和相对于文档（用 <code>pageX</code> 和 <code>pageY</code> 表示）的坐标系，如图所示（上图为滚动前的页面，下图为滚动后的页面）
    <figure markdown="span" style=" width: 50%">
<img alt="" src="../images/js/20_dark.png#only-dark"/>
<img alt="" src="../images/js/20_light.png#only-light"/>
<figcaption></figcaption>
</figure> </p>
<ul>
<li><code>elem.getBoundingClientRect()</code>：返回该元素盒子的窗口坐标，包括以下<span class="heti-skip"><span class="heti-spacing"> </span>8<span class="heti-spacing"> </span></span>个属性：<ul>
<li><code>x/y</code>：盒子原点相对于窗口的<span class="heti-skip"><span class="heti-spacing"> </span>x/y<span class="heti-spacing"> </span></span>坐标</li>
<li><code>width/height</code>：盒子的宽高</li>
<li><code>top/bottom</code>：盒子顶部<span class="heti-skip"><span class="heti-spacing"> </span>/<span class="heti-spacing"> </span></span>底部的<span class="heti-skip"><span class="heti-spacing"> </span>y<span class="heti-spacing"> </span></span>坐标</li>
<li><code>left/right</code>：盒子左侧<span class="heti-skip"><span class="heti-spacing"> </span>/<span class="heti-spacing"> </span></span>右侧的<span class="heti-skip"><span class="heti-spacing"> </span>x<span class="heti-spacing"> </span></span>坐标</li>
</ul>
</li>
</ul>
<p><figure markdown="span" style=" width: 40%">
<img alt="" src="../images/js/21_dark.png#only-dark"/>
<img alt="" src="../images/js/21_light.png#only-light"/>
<figcaption></figcaption>
</figure> </p>
<ul>
<li><code>document.elementFromPoint(x, y)</code>：返回在窗口坐标 <code>(x, y)</code> 处嵌套最多的元素（随当前滚动位置的不同而发生变化）<ul>
<li>若要根据文档坐标计算，那么还需要加上当前页面滚动（<code>scrollLeft</code> 和 <code>scrollTop</code>）</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="事件">事件<a class="headerlink" href="#事件" title="Permanent link">⚓︎</a></h2>
<h3 id="基础部分">基础部分<a class="headerlink" href="#基础部分" title="Permanent link">⚓︎</a></h3>
<p>事件<strong>处理程序</strong>(handler)：在事件发生时运行的函数，有以下几种方法：</p>
<ul>
<li><span>HTML<span class="heti-spacing"> </span></span>属性 <code>on&lt;event&gt;</code>：它的值为一个<span class="heti-skip"><span class="heti-spacing"> </span>JS<span class="heti-spacing"> </span></span>函数代码的字符串<ul>
<li>这里的 <code>&lt;event&gt;</code> 包括 <code>click</code> 等</li>
<li>仅适用于代码量很少的情况</li>
<li>字符串内不要出现双引号，用单引号替代</li>
<li>属性值里面的 <code>this</code> 指的是处理程序所在的元素</li>
<li>不要使用<span class="heti-skip"><span class="heti-spacing"> </span>JS<span class="heti-spacing"> </span></span>的 <code>.setAttribute('on&lt;event&gt;', func)</code> 来设置，这样做是无效的</li>
</ul>
</li>
<li><span>DOM<span class="heti-spacing"> </span></span>属性 <code>elem.on&lt;event&gt;</code><ul>
<li>这里的 <code>&lt;event&gt;</code> 包括 <code>click</code> 等</li>
<li>从结果来看与上一种方法类似，从实现上看该方法采用的是<span class="heti-skip"><span class="heti-spacing"> </span>JS<span class="heti-spacing"> </span></span>脚本</li>
<li>移除处理程序：<code>elem.on&lt;event&gt; = null</code></li>
<li>虽然后面没带括号，但本质上是一个函数，所以用其他函数赋值时不要加括号，只要函数名就行（否则就是函数调用了）</li>
</ul>
</li>
<li>方法 <img alt="👍" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.0.3/assets/svg/1f44d.svg" title=":+1:"/><ul>
<li><code>elem.addEventListener(event, handler[, options])</code>：为元素添加一个处理程序（多次调用可为单个元素添加多个处理程序，执行顺序同创建顺序）<ul>
<li><code>event</code>：事件名，比如 <code>click</code></li>
<li><code>handler</code>：处理程序，一般是一个函数</li>
<li><code>options</code><heti-adjacent class="heti-adjacent-half">：</heti-adjacent>（可选）格式：<code>{val: boolean}</code>，可用值 <code>val</code> 如下：<ul>
<li><code>once</code>：若为 <code>true</code>，则在触发后自动删除监听器</li>
<li><code>capture</code>：见下面“<a href="#捕获和冒泡">捕获和冒泡</a>”一节</li>
<li><code>passive</code></li>
</ul>
</li>
</ul>
</li>
<li><code>elem.removeEventListener(event, handler[, options])</code>：为元素移除处理程序（语法同上）<ul>
<li>请确保删除的处理程序和添加的处理程序是同一个函数，否则删除操作无效（所以如果添加匿名函数就没法被删除）</li>
</ul>
</li>
</ul>
</li>
</ul>
<hr/>
<p><strong>事件对象</strong> <code>event</code>：当事件发生时，浏览器会创建一个 <code>event</code> 对象并放入信息，该对象可作为参数传递给处理程序。<code>event</code> 有以下属性：</p>
<ul>
<li><code>.type</code>：事件类型（比如 <code>click</code>）</li>
<li><code>.currentTarget</code>：处理事件的元素，等同于 <code>this</code></li>
<li><code>.clientX</code>、<code>.clientY</code>：指针事件<span class="heti-skip"><span class="heti-spacing"> </span>(pointer event)<span class="heti-spacing"> </span></span>的指针的窗口相对坐标</li>
<li>...</li>
</ul>
<p><code>addEventListener()</code> 的处理程序参数还可以是一个包含 <code>handleEvent</code> 方法的对象，此时 <code>addEventListener()</code> 会调用 <code>obj.handleEvent(event)</code> 来处理时间。</p>
<h3 id="捕获和冒泡">捕获和冒泡<a class="headerlink" href="#捕获和冒泡" title="Permanent link">⚓︎</a></h3>
<p><strong>冒泡</strong><span>(bubbling)<span class="heti-spacing"> </span></span>的原理：当一个事件发生在一个元素上，它会首先运行在该元素上的处理程序，然后运行其父元素上的处理程序，然后一直向上到其他祖先上的处理程序（一直上升到 <code>&lt;html&gt;</code>，再到<span class="heti-skip"><span class="heti-spacing"> </span>document<span class="heti-spacing"> </span></span>对象，有的甚至到<span><span class="heti-spacing"> </span>window</span><heti-adjacent class="heti-adjacent-half">）</heti-adjacent>。几乎所有的事件都会冒泡。</p>
<figure style=" width: 40%">
<img alt="" src="../images/js/22_dark.png#only-dark"/>
<img alt="" src="../images/js/22_light.png#only-light"/>
<figcaption></figcaption>
</figure>
<p>引发事件的且嵌套最深的元素被称为<strong>目标元素</strong>，可用 <code>event.target</code> 访问，它与 <code>this</code> 的区别在于：</p>
<ul>
<li><code>this</code> 等同于 <code>event.currentTarget</code>，它指的是处理程序所在的当前元素</li>
<li><code>event.target</code> 指的是引发事件的元素，它在冒泡过程中不会发生变化</li>
</ul>
<p>停止冒泡的方法：</p>
<ul>
<li><code>event.stopPropagation()</code>：用于停止单个处理程序的冒泡，但当前元素的其他程序不受影响</li>
<li><code>event.stopImmediatePropagation()</code>：用于停止当前元素所有处理程序的冒泡</li>
<li>注意：一般情况下我们没有必要停止冒泡。有些看似需要停止冒泡的任务可以用其他方法解决，比如自定义事件等</li>
</ul>
<hr/>
<p>事件传播的三个阶段：</p>
<ol>
<li>捕获阶段<span><span class="heti-spacing"> </span>(capture phase)</span>：事件（从<span><span class="heti-spacing"> </span>window</span>）向下走进元素</li>
<li>目标阶段<span><span class="heti-spacing"> </span>(target phase)</span>：事件到达目标元素</li>
<li>冒泡阶段<span><span class="heti-spacing"> </span>(bubbling phase)</span>：事件从目标元素开始向上冒泡</li>
</ol>
<figure style=" width: 40%">
<img alt="" src="../images/js/23_dark.png#only-dark"/>
<img alt="" src="../images/js/23_light.png#only-light"/>
<figcaption></figcaption>
</figure>
<p>其中捕获阶段很少被使用，之前提到的三种处理程序的方法都不会用到捕获。如果要在捕获阶段捕获事件，需要在 <code>elem.addEventListener()</code> 设置参数 <code>{capture: true}</code>（<code>false</code> 为默认值，表示在冒泡阶段捕获事件<heti-adjacent class="heti-adjacent-half">）</heti-adjacent>。</p>
<details class="example">
<summary>例子</summary>
<div class="language-html highlight"><pre><span></span><code><span id="__span-5-1"><a href="#__codelineno-5-1" id="__codelineno-5-1" name="__codelineno-5-1"></a><span class="p">&lt;</span><span class="nt">style</span><span class="p">&gt;</span>
</span><span id="__span-5-2"><a href="#__codelineno-5-2" id="__codelineno-5-2" name="__codelineno-5-2"></a><span class="w">    </span><span class="nt">body</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-5-3"><a href="#__codelineno-5-3" id="__codelineno-5-3" name="__codelineno-5-3"></a><span class="w">        </span><span class="k">margin</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="kt">px</span><span class="p">;</span>
</span><span id="__span-5-4"><a href="#__codelineno-5-4" id="__codelineno-5-4" name="__codelineno-5-4"></a><span class="w">        </span><span class="k">border</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="kt">px</span><span class="w"> </span><span class="kc">solid</span><span class="w"> </span><span class="kc">blue</span><span class="p">;</span>
</span><span id="__span-5-5"><a href="#__codelineno-5-5" id="__codelineno-5-5" name="__codelineno-5-5"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-5-6"><a href="#__codelineno-5-6" id="__codelineno-5-6" name="__codelineno-5-6"></a><span class="p">&lt;/</span><span class="nt">style</span><span class="p">&gt;</span>
</span><span id="__span-5-7"><a href="#__codelineno-5-7" id="__codelineno-5-7" name="__codelineno-5-7"></a>
</span><span id="__span-5-8"><a href="#__codelineno-5-8" id="__codelineno-5-8" name="__codelineno-5-8"></a><span class="p">&lt;</span><span class="nt">form</span><span class="p">&gt;</span>FORM
</span><span id="__span-5-9"><a href="#__codelineno-5-9" id="__codelineno-5-9" name="__codelineno-5-9"></a>    <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>DIV
</span><span id="__span-5-10"><a href="#__codelineno-5-10" id="__codelineno-5-10" name="__codelineno-5-10"></a>        <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>P<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
</span><span id="__span-5-11"><a href="#__codelineno-5-11" id="__codelineno-5-11" name="__codelineno-5-11"></a>    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span><span id="__span-5-12"><a href="#__codelineno-5-12" id="__codelineno-5-12" name="__codelineno-5-12"></a><span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
</span><span id="__span-5-13"><a href="#__codelineno-5-13" id="__codelineno-5-13" name="__codelineno-5-13"></a>
</span><span id="__span-5-14"><a href="#__codelineno-5-14" id="__codelineno-5-14" name="__codelineno-5-14"></a><span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
</span><span id="__span-5-15"><a href="#__codelineno-5-15" id="__codelineno-5-15" name="__codelineno-5-15"></a><span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="kd">let</span><span class="w"> </span><span class="nx">elem</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">querySelectorAll</span><span class="p">(</span><span class="s1">'*'</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-5-16"><a href="#__codelineno-5-16" id="__codelineno-5-16" name="__codelineno-5-16"></a><span class="w">        </span><span class="nx">elem</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">"click"</span><span class="p">,</span><span class="w"> </span><span class="nx">e</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">alert</span><span class="p">(</span><span class="sb">`Capturing: </span><span class="si">${</span><span class="nx">elem</span><span class="p">.</span><span class="nx">tagName</span><span class="si">}</span><span class="sb">`</span><span class="p">),</span><span class="w"> </span><span class="kc">true</span><span class="p">);</span>
</span><span id="__span-5-17"><a href="#__codelineno-5-17" id="__codelineno-5-17" name="__codelineno-5-17"></a><span class="w">        </span><span class="nx">elem</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">"click"</span><span class="p">,</span><span class="w"> </span><span class="nx">e</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">alert</span><span class="p">(</span><span class="sb">`Bubbling: </span><span class="si">${</span><span class="nx">elem</span><span class="p">.</span><span class="nx">tagName</span><span class="si">}</span><span class="sb">`</span><span class="p">));</span>
</span><span id="__span-5-18"><a href="#__codelineno-5-18" id="__codelineno-5-18" name="__codelineno-5-18"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-5-19"><a href="#__codelineno-5-19" id="__codelineno-5-19" name="__codelineno-5-19"></a><span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span></code></pre></div>
<p>将这段代码放入<span class="heti-skip"><span class="heti-spacing"> </span>HTML<span class="heti-spacing"> </span></span>文件并用浏览器打开，点击<span class="heti-skip"><span class="heti-spacing"> </span>P<span class="heti-spacing"> </span></span>所在的方块，可以发现执行顺序为：</p>
<ol>
<li>HTML → BODY → FORM → DIV（捕获阶段，第一个监听器）</li>
<li>P（目标阶段，触发两次，因为设置了两个监听器：捕获和冒泡）</li>
<li>DIV → FORM → BODY → HTML（冒泡阶段，第二个监听器）</li>
</ol>
</details>
<hr/>
<p><strong>事件委托</strong>：若有多个元素需要执行相同的处理程序，那么可以将单个处理程序它们的共同祖先上，无需为每一个元素放一个一模一样的处理程序。</p>
<details class="example">
<summary>例子</summary>
<div class="language-html highlight"><pre><span></span><code><span id="__span-6-1"><a href="#__codelineno-6-1" id="__codelineno-6-1" name="__codelineno-6-1"></a><span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">"menu"</span><span class="p">&gt;</span>
</span><span id="__span-6-2"><a href="#__codelineno-6-2" id="__codelineno-6-2" name="__codelineno-6-2"></a>    <span class="p">&lt;</span><span class="nt">button</span> <span class="na">data-action</span><span class="o">=</span><span class="s">"save"</span><span class="p">&gt;</span>Save<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
</span><span id="__span-6-3"><a href="#__codelineno-6-3" id="__codelineno-6-3" name="__codelineno-6-3"></a>    <span class="p">&lt;</span><span class="nt">button</span> <span class="na">data-action</span><span class="o">=</span><span class="s">"load"</span><span class="p">&gt;</span>Load<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
</span><span id="__span-6-4"><a href="#__codelineno-6-4" id="__codelineno-6-4" name="__codelineno-6-4"></a>    <span class="p">&lt;</span><span class="nt">button</span> <span class="na">data-action</span><span class="o">=</span><span class="s">"search"</span><span class="p">&gt;</span>Search<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
</span><span id="__span-6-5"><a href="#__codelineno-6-5" id="__codelineno-6-5" name="__codelineno-6-5"></a><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span><span id="__span-6-6"><a href="#__codelineno-6-6" id="__codelineno-6-6" name="__codelineno-6-6"></a>
</span><span id="__span-6-7"><a href="#__codelineno-6-7" id="__codelineno-6-7" name="__codelineno-6-7"></a><span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
</span><span id="__span-6-8"><a href="#__codelineno-6-8" id="__codelineno-6-8" name="__codelineno-6-8"></a><span class="w">    </span><span class="kd">class</span><span class="w"> </span><span class="nx">Menu</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-6-9"><a href="#__codelineno-6-9" id="__codelineno-6-9" name="__codelineno-6-9"></a><span class="w">        </span><span class="kr">constructor</span><span class="p">(</span><span class="nx">elem</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-6-10"><a href="#__codelineno-6-10" id="__codelineno-6-10" name="__codelineno-6-10"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">_elem</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">elem</span><span class="p">;</span>
</span><span id="__span-6-11"><a href="#__codelineno-6-11" id="__codelineno-6-11" name="__codelineno-6-11"></a><span class="w">        </span><span class="nx">elem</span><span class="p">.</span><span class="nx">onclick</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">onClick</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">);</span><span class="w"> </span><span class="c1">// (*)</span>
</span><span id="__span-6-12"><a href="#__codelineno-6-12" id="__codelineno-6-12" name="__codelineno-6-12"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-6-13"><a href="#__codelineno-6-13" id="__codelineno-6-13" name="__codelineno-6-13"></a>
</span><span id="__span-6-14"><a href="#__codelineno-6-14" id="__codelineno-6-14" name="__codelineno-6-14"></a><span class="w">        </span><span class="nx">save</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-6-15"><a href="#__codelineno-6-15" id="__codelineno-6-15" name="__codelineno-6-15"></a><span class="w">        </span><span class="nx">alert</span><span class="p">(</span><span class="s1">'saving'</span><span class="p">);</span>
</span><span id="__span-6-16"><a href="#__codelineno-6-16" id="__codelineno-6-16" name="__codelineno-6-16"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-6-17"><a href="#__codelineno-6-17" id="__codelineno-6-17" name="__codelineno-6-17"></a>
</span><span id="__span-6-18"><a href="#__codelineno-6-18" id="__codelineno-6-18" name="__codelineno-6-18"></a><span class="w">        </span><span class="nx">load</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-6-19"><a href="#__codelineno-6-19" id="__codelineno-6-19" name="__codelineno-6-19"></a><span class="w">        </span><span class="nx">alert</span><span class="p">(</span><span class="s1">'loading'</span><span class="p">);</span>
</span><span id="__span-6-20"><a href="#__codelineno-6-20" id="__codelineno-6-20" name="__codelineno-6-20"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-6-21"><a href="#__codelineno-6-21" id="__codelineno-6-21" name="__codelineno-6-21"></a>
</span><span id="__span-6-22"><a href="#__codelineno-6-22" id="__codelineno-6-22" name="__codelineno-6-22"></a><span class="w">        </span><span class="nx">search</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-6-23"><a href="#__codelineno-6-23" id="__codelineno-6-23" name="__codelineno-6-23"></a><span class="w">        </span><span class="nx">alert</span><span class="p">(</span><span class="s1">'searching'</span><span class="p">);</span>
</span><span id="__span-6-24"><a href="#__codelineno-6-24" id="__codelineno-6-24" name="__codelineno-6-24"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-6-25"><a href="#__codelineno-6-25" id="__codelineno-6-25" name="__codelineno-6-25"></a>
</span><span id="__span-6-26"><a href="#__codelineno-6-26" id="__codelineno-6-26" name="__codelineno-6-26"></a><span class="w">        </span><span class="nx">onClick</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-6-27"><a href="#__codelineno-6-27" id="__codelineno-6-27" name="__codelineno-6-27"></a><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="nx">action</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">dataset</span><span class="p">.</span><span class="nx">action</span><span class="p">;</span>
</span><span id="__span-6-28"><a href="#__codelineno-6-28" id="__codelineno-6-28" name="__codelineno-6-28"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">action</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-6-29"><a href="#__codelineno-6-29" id="__codelineno-6-29" name="__codelineno-6-29"></a><span class="w">            </span><span class="k">this</span><span class="p">[</span><span class="nx">action</span><span class="p">]();</span>
</span><span id="__span-6-30"><a href="#__codelineno-6-30" id="__codelineno-6-30" name="__codelineno-6-30"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-6-31"><a href="#__codelineno-6-31" id="__codelineno-6-31" name="__codelineno-6-31"></a><span class="w">        </span><span class="p">};</span>
</span><span id="__span-6-32"><a href="#__codelineno-6-32" id="__codelineno-6-32" name="__codelineno-6-32"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-6-33"><a href="#__codelineno-6-33" id="__codelineno-6-33" name="__codelineno-6-33"></a>
</span><span id="__span-6-34"><a href="#__codelineno-6-34" id="__codelineno-6-34" name="__codelineno-6-34"></a><span class="w">    </span><span class="ow">new</span><span class="w"> </span><span class="nx">Menu</span><span class="p">(</span><span class="nx">menu</span><span class="p">);</span>
</span><span id="__span-6-35"><a href="#__codelineno-6-35" id="__codelineno-6-35" name="__codelineno-6-35"></a><span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span></code></pre></div>
<p>这个例子采用了事件委托的方法，没有为每个按钮写一个处理程序，而是让它们共用一个类，由类根据情况调用特定的程序，这样修改代码较为方便。</p>
</details>
<hr/>
<p>阻止浏览器行为：</p>
<ul>
<li><code>event.preventDefault()</code> 方法<ul>
<li>当 <code>addEventListener()</code> 函数的 <code>options</code> 参数值为 <code>{passive: ture}</code> 时，处理程序不会调用 <code>event.preventDefault()</code> 方法，因为某些事件需要浏览器的默认行为才能正常进行</li>
</ul>
</li>
<li>如果处理程序是用 <code>on&lt;event&gt;</code> 分配而非 <code>addEventListener()</code>，那么 <code>return false;</code> 也能阻止（其他情况下处理程序的 <code>return</code> 语句没有任何意义）</li>
<li><code>event.defaultPrevented</code> 属性：若默认行为被阻止返回 <code>true</code>，否则返回 <code>false</code></li>
<li>某些事件会相互转化：若阻止了第一个事件，也就没有第二个事件了</li>
</ul>
<h3 id="鼠标事件">鼠标事件<a class="headerlink" href="#鼠标事件" title="Permanent link">⚓︎</a></h3>
<ul>
<li><code>mousedown/mouseup</code>：在元素上点击<span class="heti-skip"><span class="heti-spacing"> </span>/<span class="heti-spacing"> </span></span>释放鼠标按钮</li>
<li><code>mouseover/mouseout</code>：鼠标指针在一个元素上移入<span class="heti-skip"><span class="heti-spacing"> </span>/<span class="heti-spacing"> </span></span>移出<ul>
<li>对于前者，<code>event.target</code> 是鼠标移入的元素，<code>event.relatedTarget</code> 是鼠标出发的元素（<code>relatedTarget</code> -&gt; <code>target</code>）</li>
<li>对于后者，<code>event.target</code> 是鼠标出发的元素，<code>event.relatedTarget</code> 是鼠标到达的元素（<code>target</code> -&gt; <code>relatedTarget</code>）</li>
<li>将鼠标从父元素移动到子元素会经历两个事件：<ul>
<li><code>mouseout</code>：<code>[target: parent]</code></li>
<li><code>mouseover</code>：<code>[target: child]</code></li>
</ul>
</li>
</ul>
</li>
<li><code>mouseenter/mouseleave</code>：与上一种属性的重要区别：<ul>
<li>元素内部和后代之间的转换不会产生影响</li>
<li>不会冒泡（所以不能使用事件委托）</li>
</ul>
</li>
<li><code>mousemove</code>：鼠标在元素上移动</li>
<li><code>click</code>：鼠标左键点击元素，<code>mousedown</code> 和 <code>mouseup</code> 相继触发</li>
<li><code>dbclick</code>：短时间内双击同一元素（很少使用）<ul>
<li>事件顺序：<code>mousedown</code> -&gt; <code>mouseup</code> -&gt; <code>click</code> -&gt; <code>dbclick</code></li>
</ul>
</li>
<li><code>contextmenu</code>：鼠标右键被按下时触发（用于打开菜单）</li>
<li>鼠标按钮：与点击相关（<code>click</code>、<code>contextmenu</code> 等）具有 <code>button</code> 属性，所有可能值有：<ul>
<li>0：鼠标左键</li>
<li>1：鼠标中键（即滚轮）</li>
<li>2：鼠标右键</li>
<li>3：<span>X1<span class="heti-spacing"> </span></span>键</li>
<li>4：<span>X2<span class="heti-spacing"> </span></span>键</li>
</ul>
</li>
<li>组合键：一些键盘上的特殊按键也对应鼠标事件的属性，如果在事件发生期间按下特殊键，对应的属性值为 <code>true</code>，否则为 <code>false</code>。有以下几种属性：<ul>
<li><code>shiftKey</code>：<code>Shift</code></li>
<li><code>altKey</code>：<code>Alt</code></li>
<li><code>ctrlKey</code>：<code>Ctrl</code></li>
</ul>
</li>
<li>坐标：<ul>
<li>相对于窗口：<code>clientX</code>、<code>clientY</code></li>
<li>相对于文档：<code>pageX</code>、<code>pageY</code></li>
</ul>
</li>
</ul>
<h2 id="表单">表单<a class="headerlink" href="#表单" title="Permanent link">⚓︎</a></h2>
<h3 id="属性方法">属性、方法<a class="headerlink" href="#属性方法" title="Permanent link">⚓︎</a></h3>
<ul>
<li>网页所有的表单都在 <code>document.forms</code> 的集合内</li>
<li>访问特定表单：<ul>
<li>使用名字（<code>name</code> 属性值<heti-adjacent class="heti-adjacent-half">）</heti-adjacent>：<code>document.forms.name</code></li>
<li>使用索引：<code>document.forms[i]</code></li>
</ul>
</li>
<li>表单内的元素（比如 <code>&lt;input&gt;</code> 等）都放在 <code>form.elements</code> 的集合内（这里的 <code>form</code> 是存储表单的变量）<ul>
<li>使用名字（<code>name</code> 属性值）访问特定元素：<code>form.elements.name</code></li>
<li>如果有多个名字相同的元素，那么上述访问方法得到的是一个集合，可以用索引获取单个元素</li>
</ul>
</li>
<li><code>elem.form</code>：访问元素对应的表单</li>
</ul>
<details class="info" open="open">
<summary>表单和元素的引用关系</summary>
<p><figure markdown="span" style=" width: 50%">
<img alt="" src="../images/js/25_dark.png#only-dark"/>
<img alt="" src="../images/js/25_light.png#only-light"/>
<figcaption></figcaption>
</figure></p>
</details>
<ul>
<li>
<p>关于表单组件 </p>
<ul>
<li><code>input</code> 和 <code>textarea</code><ul>
<li><code>.value</code>（字符串<heti-adjacent class="heti-adjacent-half">）</heti-adjacent>：输入值</li>
<li><code>input.checked</code>（布尔值<heti-adjacent class="heti-adjacent-half">）</heti-adjacent>：表示是否选中复选框或单选按钮的选项</li>
<li><code>input.blur()</code>：移除元素焦点</li>
<li><code>input.focus</code>：设置元素焦点</li>
</ul>
</li>
</ul>
<details class="waring">
<summary><span>JS<span class="heti-spacing"> </span></span>造成焦点丢失的情况</summary>
<ul>
<li><code>alert()</code> 等交互函数会将焦点移至自身，导致元素失去焦点。但是当取消模态窗后，焦点又会回到原来的元素上</li>
<li>如果一个元素从<span class="heti-skip"><span class="heti-spacing"> </span>DOM<span class="heti-spacing"> </span></span>中移除，焦点自然消失；即使之后又重新插入<span class="heti-skip"><span class="heti-spacing"> </span>DOM<span class="heti-spacing"> </span></span>中，焦点也不会回来</li>
</ul>
</details>
<ul>
<li><code>select</code>：包括以下属性<ul>
<li><code>.options</code>：<code>&lt;option&gt;</code> 子元素的集合，可用索引访问单个选项。单个选项具有以下属性：<ul>
<li><code>selected</code>（布尔值<heti-adjacent class="heti-adjacent-half">）</heti-adjacent>：表示该选项是否被选中</li>
<li><code>index</code>：表示该选项的索引号</li>
<li><code>text</code>：选项文本内容</li>
</ul>
</li>
<li><code>.value</code>：当前选中的 <code>&lt;option&gt;</code> 的 <code>value</code> 值</li>
<li><code>.selectedIndex</code>：当前选中的 <code>&lt;option&gt;</code> 的索引号</li>
<li><code>new Option(text, value, defaultSelected, selected)</code> 函数：用于创建 <code>&lt;option&gt;</code> 元素<ul>
<li><code>text</code>：<code>&lt;option&gt;</code> 的文本</li>
<li><code>value</code>：<code>&lt;option&gt;</code> 的 <code>value</code></li>
<li><code>defaultSelected</code>：若值为 <code>true</code> 则创建<code>selected</code><span class="heti-skip"><span class="heti-spacing"> </span>HTML<span class="heti-spacing"> </span></span>属性</li>
<li><code>selected</code>：若值为 <code>true</code>，则选中该 <code>&lt;option&gt;</code>。它的值应和前一个参数一致（要么都是 <code>true</code>，要么都是 <code>false</code>，要么都没有）</li>
</ul>
</li>
</ul>
</li>
<li>创建和发送表单</li>
</ul>
</li>
</ul>
<div class="language-js highlight"><pre><span></span><code><span id="__span-7-1"><a href="#__codelineno-7-1" id="__codelineno-7-1" name="__codelineno-7-1"></a><span class="kd">let</span><span class="w"> </span><span class="nx">form</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">'form'</span><span class="p">);</span>
</span><span id="__span-7-2"><a href="#__codelineno-7-2" id="__codelineno-7-2" name="__codelineno-7-2"></a><span class="nx">form</span><span class="p">.</span><span class="nx">action</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'https://google.com/search'</span><span class="p">;</span>
</span><span id="__span-7-3"><a href="#__codelineno-7-3" id="__codelineno-7-3" name="__codelineno-7-3"></a><span class="nx">form</span><span class="p">.</span><span class="nx">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'GET'</span><span class="p">;</span>
</span><span id="__span-7-4"><a href="#__codelineno-7-4" id="__codelineno-7-4" name="__codelineno-7-4"></a>
</span><span id="__span-7-5"><a href="#__codelineno-7-5" id="__codelineno-7-5" name="__codelineno-7-5"></a><span class="nx">form</span><span class="p">.</span><span class="nx">innerHTML</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'&lt;input name="q" value="test"&gt;'</span><span class="p">;</span>
</span><span id="__span-7-6"><a href="#__codelineno-7-6" id="__codelineno-7-6" name="__codelineno-7-6"></a>
</span><span id="__span-7-7"><a href="#__codelineno-7-7" id="__codelineno-7-7" name="__codelineno-7-7"></a><span class="c1">// 该表单必须在文档中才能提交</span>
</span><span id="__span-7-8"><a href="#__codelineno-7-8" id="__codelineno-7-8" name="__codelineno-7-8"></a><span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">form</span><span class="p">);</span>
</span><span id="__span-7-9"><a href="#__codelineno-7-9" id="__codelineno-7-9" name="__codelineno-7-9"></a>
</span><span id="__span-7-10"><a href="#__codelineno-7-10" id="__codelineno-7-10" name="__codelineno-7-10"></a><span class="nx">form</span><span class="p">.</span><span class="nx">submit</span><span class="p">();</span>
</span></code></pre></div>
<h3 id="事件_1">事件<a class="headerlink" href="#事件_1" title="Permanent link">⚓︎</a></h3>
<ul>
<li><code>onblur</code>：元素失去焦点</li>
<li>
<p><code>onfocus</code>：元素聚焦</p>
<blockquote>
<p>注：这两个事件不会冒泡</p>
</blockquote>
</li>
<li>
<p><code>onchange</code>：元素完成更改，包括：</p>
<ul>
<li><code>&lt;input type=text&gt;</code>：文本输入框失去焦点，但是往文本框输入内容不会触发该事件</li>
<li><code>&lt;select&gt;</code>、<code>&lt;input type=checkbox/radio&gt;</code>：选项更改</li>
<li>...</li>
</ul>
</li>
<li><code>oninput</code>：用户对输入值的修改</li>
<li><code>oncut/oncopy/onpaste</code>：剪切<span class="heti-skip"><span class="heti-spacing"> </span>/<span class="heti-spacing"> </span></span>复制<span class="heti-skip"><span class="heti-spacing"> </span>/<span class="heti-spacing"> </span></span>粘贴<ul>
<li><code>event.clipboardData.getData('text/plain')</code>：获取剪贴板的文本字符串（这段文本已被成功复制或剪切的情况下使用）</li>
<li><code>document.getSelection()</code>：获取被选中的文本，可以是被复制或剪切但未能成功放入剪切板的内容</li>
</ul>
</li>
<li><code>onsubmit</code>：提交表单，可以通过点击按钮或按下回车键触发事件</li>
</ul>
<h2 id="异步">异步<a class="headerlink" href="#异步" title="Permanent link">⚓︎</a></h2>
<h3 id="同步和异步">同步和异步<a class="headerlink" href="#同步和异步" title="Permanent link">⚓︎</a></h3>
<ul>
<li>同步编程：浏览器按照书写代码的顺序一行行地执行程序<ul>
<li>调用函数时也是这样同步执行的，这样的函数被称为<strong>同步函数</strong></li>
<li>有些同步函数的效率低下，产生耗时问题：在函数运行的时候，程序无法做任何事情（无法处理其他的事件等）</li>
</ul>
</li>
<li>异步编程<ul>
<li>异步函数的特点：<ul>
<li>调用该函数可启动一个长期运行的操作</li>
<li>函数开始运行并立刻返回，这样程序可以对其他事件做出反应</li>
<li>操作完成后，返回操作结果</li>
</ul>
</li>
<li><strong>事件处理程序</strong>便是异步函数的一种形式：提供的函数在事件发生时被调用，而不是立即被调用</li>
<li>回调函数<span><span class="heti-spacing"> </span>(callbacks)</span>：一种被传递到另一个函数中，会在适当的时候被调用的函数<ul>
<li>事件处理程序也是回调函数的一种</li>
<li>回调函数本身也可以调用其他同样接受回调函数的函数，但这样会使代码难以理解</li>
</ul>
<details class="example">
<summary>例子</summary>
<div class="language-js highlight"><pre><span></span><code><span id="__span-8-1"><a href="#__codelineno-8-1" id="__codelineno-8-1" name="__codelineno-8-1"></a><span class="kd">function</span><span class="w"> </span><span class="nx">doStep1</span><span class="p">(</span><span class="nx">init</span><span class="p">,</span><span class="w"> </span><span class="nx">callback</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-2"><a href="#__codelineno-8-2" id="__codelineno-8-2" name="__codelineno-8-2"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">init</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span><span class="p">;</span>
</span><span id="__span-8-3"><a href="#__codelineno-8-3" id="__codelineno-8-3" name="__codelineno-8-3"></a><span class="w">    </span><span class="nx">callback</span><span class="p">(</span><span class="nx">result</span><span class="p">);</span>
</span><span id="__span-8-4"><a href="#__codelineno-8-4" id="__codelineno-8-4" name="__codelineno-8-4"></a><span class="p">}</span>
</span><span id="__span-8-5"><a href="#__codelineno-8-5" id="__codelineno-8-5" name="__codelineno-8-5"></a><span class="kd">function</span><span class="w"> </span><span class="nx">doStep2</span><span class="p">(</span><span class="nx">init</span><span class="p">,</span><span class="w"> </span><span class="nx">callback</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-6"><a href="#__codelineno-8-6" id="__codelineno-8-6" name="__codelineno-8-6"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">init</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">2</span><span class="p">;</span>
</span><span id="__span-8-7"><a href="#__codelineno-8-7" id="__codelineno-8-7" name="__codelineno-8-7"></a><span class="w">    </span><span class="nx">callback</span><span class="p">(</span><span class="nx">result</span><span class="p">);</span>
</span><span id="__span-8-8"><a href="#__codelineno-8-8" id="__codelineno-8-8" name="__codelineno-8-8"></a><span class="p">}</span>
</span><span id="__span-8-9"><a href="#__codelineno-8-9" id="__codelineno-8-9" name="__codelineno-8-9"></a><span class="kd">function</span><span class="w"> </span><span class="nx">doStep3</span><span class="p">(</span><span class="nx">init</span><span class="p">,</span><span class="w"> </span><span class="nx">callback</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-10"><a href="#__codelineno-8-10" id="__codelineno-8-10" name="__codelineno-8-10"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">init</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">3</span><span class="p">;</span>
</span><span id="__span-8-11"><a href="#__codelineno-8-11" id="__codelineno-8-11" name="__codelineno-8-11"></a><span class="w">    </span><span class="nx">callback</span><span class="p">(</span><span class="nx">result</span><span class="p">);</span>
</span><span id="__span-8-12"><a href="#__codelineno-8-12" id="__codelineno-8-12" name="__codelineno-8-12"></a><span class="p">}</span>
</span><span id="__span-8-13"><a href="#__codelineno-8-13" id="__codelineno-8-13" name="__codelineno-8-13"></a><span class="kd">function</span><span class="w"> </span><span class="nx">doOperation</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-14"><a href="#__codelineno-8-14" id="__codelineno-8-14" name="__codelineno-8-14"></a><span class="w">    </span><span class="nx">doStep1</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nx">result1</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-15"><a href="#__codelineno-8-15" id="__codelineno-8-15" name="__codelineno-8-15"></a><span class="w">        </span><span class="nx">doStep2</span><span class="p">(</span><span class="nx">result1</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nx">result2</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-16"><a href="#__codelineno-8-16" id="__codelineno-8-16" name="__codelineno-8-16"></a><span class="w">            </span><span class="nx">doStep3</span><span class="p">(</span><span class="nx">result2</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nx">result3</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-17"><a href="#__codelineno-8-17" id="__codelineno-8-17" name="__codelineno-8-17"></a><span class="w">                </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`结果：</span><span class="si">${</span><span class="nx">result3</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span><span id="__span-8-18"><a href="#__codelineno-8-18" id="__codelineno-8-18" name="__codelineno-8-18"></a><span class="w">            </span><span class="p">});</span>
</span><span id="__span-8-19"><a href="#__codelineno-8-19" id="__codelineno-8-19" name="__codelineno-8-19"></a><span class="w">        </span><span class="p">});</span>
</span><span id="__span-8-20"><a href="#__codelineno-8-20" id="__codelineno-8-20" name="__codelineno-8-20"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-8-21"><a href="#__codelineno-8-21" id="__codelineno-8-21" name="__codelineno-8-21"></a><span class="p">}</span>
</span><span id="__span-8-22"><a href="#__codelineno-8-22" id="__codelineno-8-22" name="__codelineno-8-22"></a><span class="nx">doOperation</span><span class="p">();</span>
</span></code></pre></div>
<p>像这样，如果回调函数中嵌套调用多层回调函数，会使代码难以阅读和调试，这样的函数被称为“<strong>厄运金字塔</strong>”（这样的嵌套回调函数看起来像一个倒下的金字塔<heti-adjacent class="heti-adjacent-half">）</heti-adjacent>。处理嵌套回调函数的错误比较困难，因为要对每一层被调用的回调函数都要做一次错误处理，所以现在的异步<span class="heti-skip"><span class="heti-spacing"> </span>API<span class="heti-spacing"> </span></span>都不使用毁回调函数了，而是使用下面讲到的 <code>Promise</code>。</p>
</details>
</li>
</ul>
</li>
</ul>
<h3 id="promise">Promise<a class="headerlink" href="#promise" title="Permanent link">⚓︎</a></h3>
<p>相关术语：</p>
<ul>
<li>生产者代码<span><span class="heti-spacing"> </span>(producing code)</span>：需要一定时间来做一些事情</li>
<li>消费者代码<span><span class="heti-spacing"> </span>(consuming code)</span>：立即获取生产者代码的执行结果</li>
<li>
<p>Promise：一种将生产者代码和消费者代码连在一起的一个特殊的<span class="heti-skip"><span class="heti-spacing"> </span>JS<span class="heti-spacing"> </span></span>对象</p>
</li>
<li>
<p>构造函数：创建<span class="heti-skip"><span class="heti-spacing"> </span>Promise<span class="heti-spacing"> </span></span>对象
    </p><div class="language-js highlight"><pre><span></span><code><span id="__span-9-1"><a href="#__codelineno-9-1" id="__codelineno-9-1" name="__codelineno-9-1"></a><span class="kd">let</span><span class="w"> </span><span class="nx">promise</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Promise</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">resolve</span><span class="p">,</span><span class="w"> </span><span class="nx">reject</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-9-2"><a href="#__codelineno-9-2" id="__codelineno-9-2" name="__codelineno-9-2"></a><span class="w">    </span><span class="c1">// executor (producing code, name)</span>
</span><span id="__span-9-3"><a href="#__codelineno-9-3" id="__codelineno-9-3" name="__codelineno-9-3"></a><span class="p">})</span>
</span></code></pre></div>
<ul>
<li>
<p><strong>执行函数<span><span class="heti-spacing"> </span>(executor)</span></strong>：传递给 <code>new Promise</code> 的函数，包含应产出结果的生产者代码。当 <code>new Promise</code> 创建后，该函数会自动执行</p>
<ul>
<li>执行函数获得结果后，会调用以下两种回调函数之一：<ul>
<li><code>resolve(value)</code>：如果执行成功并返回结果 <code>value</code></li>
<li><code>reject(error)</code>：如果出现错误，<code>error</code> 即为<span class="heti-skip"><span class="heti-spacing"> </span>error<span class="heti-spacing"> </span></span>对象</li>
</ul>
</li>
<li>一个执行函数内只能调用一次 <code>resolve</code> 或一次 <code>reject</code>，其他的调用都会被忽略</li>
<li><code>resolve</code> 和 <code>reject</code> 只需要一个参数，额外的参数会被忽略</li>
<li><code>resolve</code> 和 <code>reject</code> 可以立即执行而无需放在执行函数内</li>
</ul>
</li>
<li>
<p><span>Promise<span class="heti-spacing"> </span></span>对象有以下内部属性：</p>
<ul>
<li><code>state</code>：初始为 <code>pending</code>；若调用 <code>resolve</code> 则变为 <code>fulfilled</code>，若调用 <code>reject</code> 则变为 <code>rejected</code></li>
<li><code>result</code>：初始为 <code>undefined</code>；若调用 <code>resolve</code> 则变为 <code>value</code>，若调用 <code>reject</code> 则变为 <code>error</code></li>
<li>但这些属性无法被直接访问，需要用其他的方法来访问</li>
</ul>
<p><figure markdown="span" style=" width: 60%">
<img alt="" src="../images/js/26_dark.png#only-dark"/>
<img alt="" src="../images/js/26_light.png#only-light"/>
<figcaption></figcaption>
</figure></p>
</li>
</ul>
<details class="example">
<summary>例子</summary>
<div class="tabbed-set tabbed-alternate" data-tabs="1:2"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio"/><input id="__tabbed_1_2" name="__tabbed_1" type="radio"/><div class="tabbed-labels"><label for="__tabbed_1_1">成功</label><label for="__tabbed_1_2">失败</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-js highlight"><pre><span></span><code><span id="__span-10-1"><a href="#__codelineno-10-1" id="__codelineno-10-1" name="__codelineno-10-1"></a><span class="kd">let</span><span class="w"> </span><span class="nx">promise</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Promise</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">resolve</span><span class="p">,</span><span class="w"> </span><span class="nx">reject</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-2"><a href="#__codelineno-10-2" id="__codelineno-10-2" name="__codelineno-10-2"></a><span class="w">    </span><span class="nx">setTimeout</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">resolve</span><span class="p">(</span><span class="s2">"done"</span><span class="p">),</span><span class="w"> </span><span class="mf">1000</span><span class="p">);</span>
</span><span id="__span-10-3"><a href="#__codelineno-10-3" id="__codelineno-10-3" name="__codelineno-10-3"></a><span class="p">});</span>
</span></code></pre></div>
<p><figure markdown="span" style=" width: 60%">
<img alt="" src="../images/js/27_dark.png#only-dark"/>
<img alt="" src="../images/js/27_light.png#only-light"/>
<figcaption></figcaption>
</figure></p>
</div>
<div class="tabbed-block">
<div class="language-js highlight"><pre><span></span><code><span id="__span-11-1"><a href="#__codelineno-11-1" id="__codelineno-11-1" name="__codelineno-11-1"></a><span class="kd">let</span><span class="w"> </span><span class="nx">promise</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Promise</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">resolve</span><span class="p">,</span><span class="w"> </span><span class="nx">reject</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-2"><a href="#__codelineno-11-2" id="__codelineno-11-2" name="__codelineno-11-2"></a><span class="w">    </span><span class="nx">setTimeout</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">reject</span><span class="p">(</span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s2">"Whoops!"</span><span class="p">)),</span><span class="w"> </span><span class="mf">1000</span><span class="p">);</span>
</span><span id="__span-11-3"><a href="#__codelineno-11-3" id="__codelineno-11-3" name="__codelineno-11-3"></a><span class="p">});</span>
</span></code></pre></div>
<p><figure markdown="span" style=" width: 70%">
<img alt="" src="../images/js/28_dark.png#only-dark"/>
<img alt="" src="../images/js/28_light.png#only-light"/>
<figcaption></figcaption>
</figure></p>
</div>
</div>
</div>
</details>
</li>
<li>
<p>消费函数</p>
<ul>
<li><code>.then</code></li>
</ul>
<div class="language-js highlight"><pre><span></span><code><span id="__span-12-1"><a href="#__codelineno-12-1" id="__codelineno-12-1" name="__codelineno-12-1"></a><span class="c1">// 两个参数都是函数</span>
</span><span id="__span-12-2"><a href="#__codelineno-12-2" id="__codelineno-12-2" name="__codelineno-12-2"></a><span class="c1">// 可以只有一个参数，仅处理一种情况</span>
</span><span id="__span-12-3"><a href="#__codelineno-12-3" id="__codelineno-12-3" name="__codelineno-12-3"></a><span class="nx">promise</span><span class="p">.</span><span class="nx">then</span><span class="p">(</span>
</span><span id="__span-12-4"><a href="#__codelineno-12-4" id="__codelineno-12-4" name="__codelineno-12-4"></a><span class="w">    </span><span class="kd">function</span><span class="p">(</span><span class="nx">result</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="cm">/* handle a successful result */</span><span class="w"> </span><span class="p">},</span>
</span><span id="__span-12-5"><a href="#__codelineno-12-5" id="__codelineno-12-5" name="__codelineno-12-5"></a><span class="w">    </span><span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="cm">/* handle an erro */</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-12-6"><a href="#__codelineno-12-6" id="__codelineno-12-6" name="__codelineno-12-6"></a><span class="p">);</span>
</span></code></pre></div>
<details class="example">
<summary>例子</summary>
<div class="language-js highlight"><pre><span></span><code><span id="__span-13-1"><a href="#__codelineno-13-1" id="__codelineno-13-1" name="__codelineno-13-1"></a><span class="kd">let</span><span class="w"> </span><span class="nx">promise</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Promise</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">resolve</span><span class="p">,</span><span class="w"> </span><span class="nx">reject</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-13-2"><a href="#__codelineno-13-2" id="__codelineno-13-2" name="__codelineno-13-2"></a><span class="w">    </span><span class="nx">setTimeout</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">resolve</span><span class="p">(</span><span class="s2">"done!"</span><span class="p">),</span><span class="w"> </span><span class="mf">1000</span><span class="p">);</span>
</span><span id="__span-13-3"><a href="#__codelineno-13-3" id="__codelineno-13-3" name="__codelineno-13-3"></a><span class="p">});</span>
</span><span id="__span-13-4"><a href="#__codelineno-13-4" id="__codelineno-13-4" name="__codelineno-13-4"></a>
</span><span id="__span-13-5"><a href="#__codelineno-13-5" id="__codelineno-13-5" name="__codelineno-13-5"></a><span class="nx">promise</span><span class="p">.</span><span class="nx">then</span><span class="p">(</span>
</span><span id="__span-13-6"><a href="#__codelineno-13-6" id="__codelineno-13-6" name="__codelineno-13-6"></a><span class="w">    </span><span class="nx">result</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">alert</span><span class="p">(</span><span class="nx">result</span><span class="p">),</span><span class="w"> </span><span class="c1">// 1 秒后显示 "done!"</span>
</span><span id="__span-13-7"><a href="#__codelineno-13-7" id="__codelineno-13-7" name="__codelineno-13-7"></a><span class="w">    </span><span class="nx">error</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">alert</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="c1">// 不运行</span>
</span><span id="__span-13-8"><a href="#__codelineno-13-8" id="__codelineno-13-8" name="__codelineno-13-8"></a><span class="p">);</span>
</span></code></pre></div>
</details>
<ul>
<li><code>.catch</code>：只处理错误情况，即 <code>.catch(f)</code> 等价于 <code>.then(null, f)</code></li>
</ul>
</li>
<li>
<p><code>finally</code>：用于执行清理<span class="heti-skip"><span class="heti-spacing"> </span>/<span class="heti-spacing"> </span></span>终结操作，比如停止加载指示器，关闭不再需要的连接等</p>
<ul>
<li><code>finally(f)</code> 类似 <code>then(f, f)</code>，但是有以下区别：<ul>
<li><code>finally</code> 处理程序 <code>f</code> 没有参数，且我们不知道<span class="heti-skip"><span class="heti-spacing"> </span>promise<span class="heti-spacing"> </span></span>是否成功</li>
<li><code>finally</code> 处理程序将结果或<span class="heti-skip"><span class="heti-spacing"> </span>error<span class="heti-spacing"> </span></span>传递给下一个合适的处理程序</li>
<li><code>finally</code> 处理程序不返回任何内容（如果有返回值则会被忽略）</li>
</ul>
</li>
</ul>
<details class="example">
<summary>例子</summary>
<div class="language-js highlight"><pre><span></span><code><span id="__span-14-1"><a href="#__codelineno-14-1" id="__codelineno-14-1" name="__codelineno-14-1"></a><span class="ow">new</span><span class="w"> </span><span class="nb">Promise</span><span class="p">((</span><span class="nx">resolve</span><span class="p">,</span><span class="w"> </span><span class="nx">reject</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-14-2"><a href="#__codelineno-14-2" id="__codelineno-14-2" name="__codelineno-14-2"></a><span class="w">    </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s2">"error"</span><span class="p">);</span>
</span><span id="__span-14-3"><a href="#__codelineno-14-3" id="__codelineno-14-3" name="__codelineno-14-3"></a><span class="p">})</span>
</span><span id="__span-14-4"><a href="#__codelineno-14-4" id="__codelineno-14-4" name="__codelineno-14-4"></a><span class="w">    </span><span class="p">.</span><span class="k">finally</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">alert</span><span class="p">(</span><span class="s2">"Promise ready"</span><span class="p">))</span><span class="w"> </span><span class="c1">// 先触发</span>
</span><span id="__span-14-5"><a href="#__codelineno-14-5" id="__codelineno-14-5" name="__codelineno-14-5"></a><span class="w">    </span><span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="nx">err</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">alert</span><span class="p">(</span><span class="nx">err</span><span class="p">));</span><span class="w">  </span><span class="c1">// &lt;-- .catch 显示这个 error</span>
</span></code></pre></div>
</details>
</li>
<li>
<p><span>Promise<span class="heti-spacing"> </span></span>链</p>
<ul>
<li>格式类似下面的代码：
<div class="language-js highlight"><pre><span></span><code><span id="__span-15-1"><a href="#__codelineno-15-1" id="__codelineno-15-1" name="__codelineno-15-1"></a><span class="ow">new</span><span class="w"> </span><span class="nb">Promise</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">resolve</span><span class="p">,</span><span class="w"> </span><span class="nx">reject</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-2"><a href="#__codelineno-15-2" id="__codelineno-15-2" name="__codelineno-15-2"></a><span class="w">    </span><span class="nx">setTimeout</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">resolve</span><span class="p">(</span><span class="mf">1</span><span class="p">),</span><span class="w"> </span><span class="mf">1000</span><span class="p">);</span><span class="w"> </span>
</span><span id="__span-15-3"><a href="#__codelineno-15-3" id="__codelineno-15-3" name="__codelineno-15-3"></a><span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">result</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
</span><span id="__span-15-4"><a href="#__codelineno-15-4" id="__codelineno-15-4" name="__codelineno-15-4"></a><span class="w">    </span><span class="nx">alert</span><span class="p">(</span><span class="nx">result</span><span class="p">);</span><span class="w">                </span><span class="c1">// 1</span>
</span><span id="__span-15-5"><a href="#__codelineno-15-5" id="__codelineno-15-5" name="__codelineno-15-5"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">2</span><span class="p">;</span>
</span><span id="__span-15-6"><a href="#__codelineno-15-6" id="__codelineno-15-6" name="__codelineno-15-6"></a><span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">result</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
</span><span id="__span-15-7"><a href="#__codelineno-15-7" id="__codelineno-15-7" name="__codelineno-15-7"></a><span class="w">    </span><span class="nx">alert</span><span class="p">(</span><span class="nx">result</span><span class="p">);</span><span class="w">                </span><span class="c1">// 2</span>
</span><span id="__span-15-8"><a href="#__codelineno-15-8" id="__codelineno-15-8" name="__codelineno-15-8"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">2</span><span class="p">;</span>
</span><span id="__span-15-9"><a href="#__codelineno-15-9" id="__codelineno-15-9" name="__codelineno-15-9"></a><span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">result</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-10"><a href="#__codelineno-15-10" id="__codelineno-15-10" name="__codelineno-15-10"></a><span class="w">    </span><span class="nx">alert</span><span class="p">(</span><span class="nx">result</span><span class="p">);</span><span class="w">                </span><span class="c1">// 4</span>
</span><span id="__span-15-11"><a href="#__codelineno-15-11" id="__codelineno-15-11" name="__codelineno-15-11"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">2</span><span class="p">;</span>
</span><span id="__span-15-12"><a href="#__codelineno-15-12" id="__codelineno-15-12" name="__codelineno-15-12"></a><span class="p">});</span>
</span></code></pre></div></li>
</ul>
<p>执行过程如下图所示，可以发现 <code>result</code> 在一系列 <code>.then</code> 处理程序中出传递下去（事实上 <code>.catch</code> 和 <code>.finally</code> 也可以，且它们可以混搭）</p>
<p><figure markdown="span" style=" width: 30%">
<img alt="" src="../images/js/29_dark.png#only-dark"/>
<img alt="" src="../images/js/29_light.png#only-light"/>
<figcaption></figcaption>
</figure></p>
<p>下面是<span class="heti-skip"><span class="heti-spacing"> </span>promise<span class="heti-spacing"> </span></span>链的通用流程图：</p>
<p><figure markdown="span" style=" width: 60%">
<img alt="" src="../images/js/31_dark.png#only-dark"/>
<img alt="" src="../images/js/31_light.png#only-light"/>
<figcaption></figcaption>
</figure></p>
<ul>
<li>误区：一个有多个处理函数的<span class="heti-skip"><span class="heti-spacing"> </span>promise<span class="heti-spacing"> </span></span>可以实现上面的<span class="heti-skip"><span class="heti-spacing"> </span>promise<span class="heti-spacing"> </span></span>链。实际上，这些处理函数是独立的执行的，并不是链式传递的，所以平时也不会用到这种形式。</li>
</ul>
<details class="example">
<summary>例子</summary>
<div class="language-js highlight"><pre><span></span><code><span id="__span-16-1"><a href="#__codelineno-16-1" id="__codelineno-16-1" name="__codelineno-16-1"></a><span class="kd">let</span><span class="w"> </span><span class="nx">promise</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Promise</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">resolve</span><span class="p">,</span><span class="w"> </span><span class="nx">reject</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-16-2"><a href="#__codelineno-16-2" id="__codelineno-16-2" name="__codelineno-16-2"></a><span class="w">    </span><span class="nx">setTimeout</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">resolve</span><span class="p">(</span><span class="mf">1</span><span class="p">),</span><span class="w"> </span><span class="mf">1000</span><span class="p">);</span>
</span><span id="__span-16-3"><a href="#__codelineno-16-3" id="__codelineno-16-3" name="__codelineno-16-3"></a><span class="p">});</span>
</span><span id="__span-16-4"><a href="#__codelineno-16-4" id="__codelineno-16-4" name="__codelineno-16-4"></a>
</span><span id="__span-16-5"><a href="#__codelineno-16-5" id="__codelineno-16-5" name="__codelineno-16-5"></a><span class="nx">promise</span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">result</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-16-6"><a href="#__codelineno-16-6" id="__codelineno-16-6" name="__codelineno-16-6"></a><span class="w">    </span><span class="nx">alert</span><span class="p">(</span><span class="nx">result</span><span class="p">);</span><span class="w">                  </span><span class="c1">// 1</span>
</span><span id="__span-16-7"><a href="#__codelineno-16-7" id="__codelineno-16-7" name="__codelineno-16-7"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">2</span><span class="p">;</span>
</span><span id="__span-16-8"><a href="#__codelineno-16-8" id="__codelineno-16-8" name="__codelineno-16-8"></a><span class="p">});</span>
</span><span id="__span-16-9"><a href="#__codelineno-16-9" id="__codelineno-16-9" name="__codelineno-16-9"></a>
</span><span id="__span-16-10"><a href="#__codelineno-16-10" id="__codelineno-16-10" name="__codelineno-16-10"></a><span class="nx">promise</span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">result</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-16-11"><a href="#__codelineno-16-11" id="__codelineno-16-11" name="__codelineno-16-11"></a><span class="w">    </span><span class="nx">alert</span><span class="p">(</span><span class="nx">result</span><span class="p">);</span><span class="w">                  </span><span class="c1">// 1</span>
</span><span id="__span-16-12"><a href="#__codelineno-16-12" id="__codelineno-16-12" name="__codelineno-16-12"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">2</span><span class="p">;</span>
</span><span id="__span-16-13"><a href="#__codelineno-16-13" id="__codelineno-16-13" name="__codelineno-16-13"></a><span class="p">});</span>
</span><span id="__span-16-14"><a href="#__codelineno-16-14" id="__codelineno-16-14" name="__codelineno-16-14"></a>
</span><span id="__span-16-15"><a href="#__codelineno-16-15" id="__codelineno-16-15" name="__codelineno-16-15"></a><span class="nx">promise</span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">result</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-16-16"><a href="#__codelineno-16-16" id="__codelineno-16-16" name="__codelineno-16-16"></a><span class="w">    </span><span class="nx">alert</span><span class="p">(</span><span class="nx">result</span><span class="p">);</span><span class="w">                  </span><span class="c1">// 1</span>
</span><span id="__span-16-17"><a href="#__codelineno-16-17" id="__codelineno-16-17" name="__codelineno-16-17"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">2</span><span class="p">;</span>
</span><span id="__span-16-18"><a href="#__codelineno-16-18" id="__codelineno-16-18" name="__codelineno-16-18"></a><span class="p">});</span>
</span></code></pre></div>
<p><figure markdown="span" style=" width: 60%">
<img alt="" src="../images/js/30_dark.png#only-dark"/>
<img alt="" src="../images/js/30_light.png#only-light"/>
<figcaption></figcaption>
</figure></p>
</details>
<ul>
<li><span>promise<span class="heti-spacing"> </span></span>的处理程序（<code>.then</code>、<code>.catch</code> 和 <code>.finally</code>）可以创建并返回一个<span><span class="heti-spacing"> </span>promise</span>。如果<span class="heti-skip"><span class="heti-spacing"> </span>promise<span class="heti-spacing"> </span></span>链中有这样的处理程序，那么它后面的处理程序需要等待它<span><span class="heti-spacing"> </span>settled</span>（非<span class="heti-skip"><span class="heti-spacing"> </span>pending<span class="heti-spacing"> </span></span>状态）后再获取结果</li>
</ul>
<details class="example">
<summary>例子</summary>
<div class="language-js highlight"><pre><span></span><code><span id="__span-17-1"><a href="#__codelineno-17-1" id="__codelineno-17-1" name="__codelineno-17-1"></a><span class="ow">new</span><span class="w"> </span><span class="nb">Promise</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">resolve</span><span class="p">,</span><span class="w"> </span><span class="nx">reject</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-17-2"><a href="#__codelineno-17-2" id="__codelineno-17-2" name="__codelineno-17-2"></a><span class="w">    </span><span class="nx">setTimeout</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">resolve</span><span class="p">(</span><span class="mf">1</span><span class="p">),</span><span class="w"> </span><span class="mf">1000</span><span class="p">);</span>
</span><span id="__span-17-3"><a href="#__codelineno-17-3" id="__codelineno-17-3" name="__codelineno-17-3"></a><span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">result</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-17-4"><a href="#__codelineno-17-4" id="__codelineno-17-4" name="__codelineno-17-4"></a><span class="w">    </span><span class="nx">alert</span><span class="p">(</span><span class="nx">result</span><span class="p">);</span><span class="w">              </span><span class="c1">// 1</span>
</span><span id="__span-17-5"><a href="#__codelineno-17-5" id="__codelineno-17-5" name="__codelineno-17-5"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Promise</span><span class="p">((</span><span class="nx">resolve</span><span class="p">,</span><span class="w"> </span><span class="nx">reject</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
</span><span id="__span-17-6"><a href="#__codelineno-17-6" id="__codelineno-17-6" name="__codelineno-17-6"></a><span class="w">        </span><span class="nx">setTimeout</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">resolve</span><span class="p">(</span><span class="nx">result</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">2</span><span class="p">),</span><span class="w"> </span><span class="mf">1000</span><span class="p">);</span>
</span><span id="__span-17-7"><a href="#__codelineno-17-7" id="__codelineno-17-7" name="__codelineno-17-7"></a><span class="p">});</span>
</span><span id="__span-17-8"><a href="#__codelineno-17-8" id="__codelineno-17-8" name="__codelineno-17-8"></a>
</span><span id="__span-17-9"><a href="#__codelineno-17-9" id="__codelineno-17-9" name="__codelineno-17-9"></a><span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">result</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
</span><span id="__span-17-10"><a href="#__codelineno-17-10" id="__codelineno-17-10" name="__codelineno-17-10"></a><span class="w">    </span><span class="nx">alert</span><span class="p">(</span><span class="nx">result</span><span class="p">);</span><span class="w">              </span><span class="c1">// 2</span>
</span><span id="__span-17-11"><a href="#__codelineno-17-11" id="__codelineno-17-11" name="__codelineno-17-11"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Promise</span><span class="p">((</span><span class="nx">resolve</span><span class="p">,</span><span class="w"> </span><span class="nx">reject</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-17-12"><a href="#__codelineno-17-12" id="__codelineno-17-12" name="__codelineno-17-12"></a><span class="w">        </span><span class="nx">setTimeout</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">resolve</span><span class="p">(</span><span class="nx">result</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">2</span><span class="p">),</span><span class="w"> </span><span class="mf">1000</span><span class="p">);</span>
</span><span id="__span-17-13"><a href="#__codelineno-17-13" id="__codelineno-17-13" name="__codelineno-17-13"></a><span class="p">});</span>
</span><span id="__span-17-14"><a href="#__codelineno-17-14" id="__codelineno-17-14" name="__codelineno-17-14"></a>
</span><span id="__span-17-15"><a href="#__codelineno-17-15" id="__codelineno-17-15" name="__codelineno-17-15"></a><span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">result</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-17-16"><a href="#__codelineno-17-16" id="__codelineno-17-16" name="__codelineno-17-16"></a><span class="w">    </span><span class="nx">alert</span><span class="p">(</span><span class="nx">result</span><span class="p">);</span><span class="w">              </span><span class="c1">// 4</span>
</span><span id="__span-17-17"><a href="#__codelineno-17-17" id="__codelineno-17-17" name="__codelineno-17-17"></a><span class="p">});</span>
</span></code></pre></div>
<p>这段代码与第一次给出的<span class="heti-skip"><span class="heti-spacing"> </span>promise<span class="heti-spacing"> </span></span>链代码相比，在每次调用 <code>alert</code> 时都会有<span class="heti-skip"><span class="heti-spacing"> </span>1s<span class="heti-spacing"> </span></span>的延迟</p>
</details>
<details class="note" open="open">
<summary>Thenable</summary>
<p>实际上，处理程序返回的所谓<span class="heti-skip"><span class="heti-spacing"> </span>promise<span class="heti-spacing"> </span></span>其实是一个被称为<span class="heti-skip"><span class="heti-spacing"> </span>Thenable<span class="heti-spacing"> </span></span>的对象，它是一个具有方法 <code>.then</code> 的任意对象，且被当作一个<span class="heti-skip"><span class="heti-spacing"> </span>promise<span class="heti-spacing"> </span></span>来对待。这允许我们将自定义的对象和<span class="heti-skip"><span class="heti-spacing"> </span>promise<span class="heti-spacing"> </span></span>链集成在一起，而不必继承自<span><span class="heti-spacing"> </span>promise</span></p>
</details>
<ul>
<li>与<span class="heti-skip"><span class="heti-spacing"> </span>fetch API<span class="heti-spacing"> </span></span>相关</li>
<li>错误处理相关</li>
<li>将 <code>.catch</code> 方法放在整条<span class="heti-skip"><span class="heti-spacing"> </span>promise<span class="heti-spacing"> </span></span>链的末尾，这样无论前面哪一个方法有问题，<code>.catch</code> 就会捕获到它</li>
<li>隐式<span><span class="heti-spacing"> </span>try...catch</span>：执行函数和处理程序发生的异常（比如手动抛出错误，或者有编程上的错误等）会被自动捕获，并将<span class="heti-skip"><span class="heti-spacing"> </span>promise<span class="heti-spacing"> </span></span>视为 <code>rejected</code>；当然也可以用 <code>.catch</code> 手动捕获</li>
<li>再次抛出：如果<span class="heti-skip"><span class="heti-spacing"> </span>promise<span class="heti-spacing"> </span></span>链中的 <code>.catch</code> 如果无法处理错误，将会将该错误抛给下一个 <code>.catch</code>（如果成功处理错误就会继续到最近成功的处理程序）</li>
</ul>
<details class="example">
<summary>例子</summary>
<div class="language-js highlight"><pre><span></span><code><span id="__span-18-1"><a href="#__codelineno-18-1" id="__codelineno-18-1" name="__codelineno-18-1"></a><span class="c1">// 执行流：catch -&gt; catch</span>
</span><span id="__span-18-2"><a href="#__codelineno-18-2" id="__codelineno-18-2" name="__codelineno-18-2"></a><span class="ow">new</span><span class="w"> </span><span class="nb">Promise</span><span class="p">((</span><span class="nx">resolve</span><span class="p">,</span><span class="w"> </span><span class="nx">reject</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-18-3"><a href="#__codelineno-18-3" id="__codelineno-18-3" name="__codelineno-18-3"></a><span class="w">    </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s2">"Whoops!"</span><span class="p">);</span>
</span><span id="__span-18-4"><a href="#__codelineno-18-4" id="__codelineno-18-4" name="__codelineno-18-4"></a><span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// (*)</span>
</span><span id="__span-18-5"><a href="#__codelineno-18-5" id="__codelineno-18-5" name="__codelineno-18-5"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="w"> </span><span class="ow">instanceof</span><span class="w"> </span><span class="ne">URIError</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-18-6"><a href="#__codelineno-18-6" id="__codelineno-18-6" name="__codelineno-18-6"></a><span class="w">        </span><span class="c1">// 处理它</span>
</span><span id="__span-18-7"><a href="#__codelineno-18-7" id="__codelineno-18-7" name="__codelineno-18-7"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-18-8"><a href="#__codelineno-18-8" id="__codelineno-18-8" name="__codelineno-18-8"></a><span class="w">        </span><span class="nx">alert</span><span class="p">(</span><span class="s2">"Can't handle such error"</span><span class="p">);</span>
</span><span id="__span-18-9"><a href="#__codelineno-18-9" id="__codelineno-18-9" name="__codelineno-18-9"></a><span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="nx">error</span><span class="p">;</span><span class="w"> </span><span class="c1">// 再次抛出此 error 或另外一个 error，执行将跳转至下一个 catch</span>
</span><span id="__span-18-10"><a href="#__codelineno-18-10" id="__codelineno-18-10" name="__codelineno-18-10"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-18-11"><a href="#__codelineno-18-11" id="__codelineno-18-11" name="__codelineno-18-11"></a><span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-18-12"><a href="#__codelineno-18-12" id="__codelineno-18-12" name="__codelineno-18-12"></a><span class="cm">/* 不在这里运行 */</span>
</span><span id="__span-18-13"><a href="#__codelineno-18-13" id="__codelineno-18-13" name="__codelineno-18-13"></a><span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="nx">error</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// (**)</span>
</span><span id="__span-18-14"><a href="#__codelineno-18-14" id="__codelineno-18-14" name="__codelineno-18-14"></a><span class="w">    </span><span class="nx">alert</span><span class="p">(</span><span class="sb">`The unknown error has occurred: </span><span class="si">${</span><span class="nx">error</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span><span id="__span-18-15"><a href="#__codelineno-18-15" id="__codelineno-18-15" name="__codelineno-18-15"></a><span class="w">    </span><span class="c1">// 不会返回任何内容 =&gt; 执行正常进行</span>
</span><span id="__span-18-16"><a href="#__codelineno-18-16" id="__codelineno-18-16" name="__codelineno-18-16"></a><span class="p">});</span>
</span></code></pre></div>
</details>
<ul>
<li>如果抛出的<span class="heti-skip"><span class="heti-spacing"> </span>error<span class="heti-spacing"> </span></span>没有 <code>.catch</code> 方法接住的话，该<span class="heti-skip"><span class="heti-spacing"> </span>promise<span class="heti-spacing"> </span></span>就会「卡死<heti-adjacent class="heti-adjacent-half">」</heti-adjacent>，并在控制台给出相关信息。这类错误是无法恢复的，需要告知用户和服务器</li>
<li>此外还会触发 <code>unhandledrejection</code> 事件
<div class="language-js highlight"><pre><span></span><code><span id="__span-19-1"><a href="#__codelineno-19-1" id="__codelineno-19-1" name="__codelineno-19-1"></a><span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">'unhandledrejection'</span><span class="p">,</span><span class="w"> </span><span class="nx">event</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">alert</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">reason</span><span class="p">));</span>
</span></code></pre></div></li>
</ul>
</li>
<li>
<p>Promise API</p>
<ul>
<li>
<p><code>Promise.all</code></p>
<ul>
<li>语法：
<div class="language-js highlight"><pre><span></span><code><span id="__span-20-1"><a href="#__codelineno-20-1" id="__codelineno-20-1" name="__codelineno-20-1"></a><span class="kd">let</span><span class="w"> </span><span class="nx">promise</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Promise</span><span class="p">.</span><span class="nx">all</span><span class="p">(</span><span class="nx">iterable</span><span class="p">);</span>
</span></code></pre></div></li>
</ul>
<p>其中 <code>iterable</code> 通常是一个<span class="heti-skip"><span class="heti-spacing"> </span>promise<span class="heti-spacing"> </span></span>可迭代对象（比如数组、映射等<heti-adjacent class="heti-adjacent-half">）</heti-adjacent>，该方法返回一个新的<span><span class="heti-spacing"> </span>promise</span></p>
<ul>
<li>如果 <code>iterable</code> 中有非<span class="heti-skip"><span class="heti-spacing"> </span>promise<span class="heti-spacing"> </span></span>对象，那么它将被“按原样”传递给结果数组</li>
<li>只有当所有给定的<span class="heti-skip"><span class="heti-spacing"> </span>promise<span class="heti-spacing"> </span></span>都<span class="heti-skip"><span class="heti-spacing"> </span>resolve<span class="heti-spacing"> </span></span>时，新的<span class="heti-skip"><span class="heti-spacing"> </span>promise<span class="heti-spacing"> </span></span>才会<span><span class="heti-spacing"> </span>resolve</span>，且返回结果为包含所有<span class="heti-skip"><span class="heti-spacing"> </span>promise<span class="heti-spacing"> </span></span>返回结果的一个数组，其元素顺序同<span class="heti-skip"><span class="heti-spacing"> </span>promise<span class="heti-spacing"> </span></span>数组元素顺序</li>
<li>只要有一个<span class="heti-skip"><span class="heti-spacing"> </span>promise<span class="heti-spacing"> </span></span>被<span><span class="heti-spacing"> </span>reject</span>，那么<span class="heti-skip"><span class="heti-spacing"> </span>promise<span class="heti-spacing"> </span></span>也立即被<span><span class="heti-spacing"> </span>reject</span>，且它的<span class="heti-skip"><span class="heti-spacing"> </span>error<span class="heti-spacing"> </span></span>就是那个<span class="heti-skip"><span class="heti-spacing"> </span>promise<span class="heti-spacing"> </span></span>的<span><span class="heti-spacing"> </span>error</span>；剩下的<span class="heti-skip"><span class="heti-spacing"> </span>promise<span class="heti-spacing"> </span></span>将会被忽略，不再执行（但可能会<span><span class="heti-spacing"> </span>settle</span>）</li>
</ul>
</li>
</ul>
<details class="example">
<summary>例子</summary>
<div class="language-js highlight"><pre><span></span><code><span id="__span-21-1"><a href="#__codelineno-21-1" id="__codelineno-21-1" name="__codelineno-21-1"></a><span class="kd">let</span><span class="w"> </span><span class="nx">names</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s1">'iliakan'</span><span class="p">,</span><span class="w"> </span><span class="s1">'remy'</span><span class="p">,</span><span class="w"> </span><span class="s1">'jeresig'</span><span class="p">];</span>
</span><span id="__span-21-2"><a href="#__codelineno-21-2" id="__codelineno-21-2" name="__codelineno-21-2"></a>
</span><span id="__span-21-3"><a href="#__codelineno-21-3" id="__codelineno-21-3" name="__codelineno-21-3"></a><span class="kd">let</span><span class="w"> </span><span class="nx">requests</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">names</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">name</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">fetch</span><span class="p">(</span><span class="sb">`https://api.github.com/users/</span><span class="si">${</span><span class="nx">name</span><span class="si">}</span><span class="sb">`</span><span class="p">));</span>
</span><span id="__span-21-4"><a href="#__codelineno-21-4" id="__codelineno-21-4" name="__codelineno-21-4"></a>
</span><span id="__span-21-5"><a href="#__codelineno-21-5" id="__codelineno-21-5" name="__codelineno-21-5"></a><span class="nb">Promise</span><span class="p">.</span><span class="nx">all</span><span class="p">(</span><span class="nx">requests</span><span class="p">)</span>
</span><span id="__span-21-6"><a href="#__codelineno-21-6" id="__codelineno-21-6" name="__codelineno-21-6"></a><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">responses</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-21-7"><a href="#__codelineno-21-7" id="__codelineno-21-7" name="__codelineno-21-7"></a><span class="w">    </span><span class="c1">// 所有响应都被成功 resolved</span>
</span><span id="__span-21-8"><a href="#__codelineno-21-8" id="__codelineno-21-8" name="__codelineno-21-8"></a><span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="kd">let</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nx">responses</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-21-9"><a href="#__codelineno-21-9" id="__codelineno-21-9" name="__codelineno-21-9"></a><span class="w">    </span><span class="nx">alert</span><span class="p">(</span><span class="sb">`</span><span class="si">${</span><span class="nx">response</span><span class="p">.</span><span class="nx">url</span><span class="si">}</span><span class="sb">: </span><span class="si">${</span><span class="nx">response</span><span class="p">.</span><span class="nx">status</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span><span class="w"> </span><span class="c1">// 对应每个 url 都显示 200</span>
</span><span id="__span-21-10"><a href="#__codelineno-21-10" id="__codelineno-21-10" name="__codelineno-21-10"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-21-11"><a href="#__codelineno-21-11" id="__codelineno-21-11" name="__codelineno-21-11"></a>
</span><span id="__span-21-12"><a href="#__codelineno-21-12" id="__codelineno-21-12" name="__codelineno-21-12"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">responses</span><span class="p">;</span>
</span><span id="__span-21-13"><a href="#__codelineno-21-13" id="__codelineno-21-13" name="__codelineno-21-13"></a><span class="p">})</span>
</span><span id="__span-21-14"><a href="#__codelineno-21-14" id="__codelineno-21-14" name="__codelineno-21-14"></a><span class="c1">// 将响应数组映射（map）到 response.json() 数组中以读取它们的内容</span>
</span><span id="__span-21-15"><a href="#__codelineno-21-15" id="__codelineno-21-15" name="__codelineno-21-15"></a><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">responses</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nb">Promise</span><span class="p">.</span><span class="nx">all</span><span class="p">(</span><span class="nx">responses</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">r</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">json</span><span class="p">())))</span>
</span><span id="__span-21-16"><a href="#__codelineno-21-16" id="__codelineno-21-16" name="__codelineno-21-16"></a><span class="c1">// 所有 JSON 结果都被解析："users" 是它们的数组</span>
</span><span id="__span-21-17"><a href="#__codelineno-21-17" id="__codelineno-21-17" name="__codelineno-21-17"></a><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">users</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">users</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">user</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">alert</span><span class="p">(</span><span class="nx">user</span><span class="p">.</span><span class="nx">name</span><span class="p">)));</span>
</span></code></pre></div>
</details>
<ul>
<li><code>Promise.allSettled</code><ul>
<li>语法同 <code>Promise.all</code></li>
<li>与 <code>Promise.all</code> 不同的是，它会等待所有的<span class="heti-skip"><span class="heti-spacing"> </span>promise<span class="heti-spacing"> </span></span>都<span><span class="heti-spacing"> </span>settle</span>，其结果数组为：<ul>
<li>成功执行的<span class="heti-skip"><span class="heti-spacing"> </span>promise<span class="heti-spacing"> </span></span>对应的数组元素为 <code>{status: "fulfilled", value: result}</code></li>
<li>出现<span class="heti-skip"><span class="heti-spacing"> </span>error<span class="heti-spacing"> </span></span>的<span class="heti-skip"><span class="heti-spacing"> </span>promise<span class="heti-spacing"> </span></span>对应的数组元素为 <code>{status: "rejected", value: error}</code></li>
</ul>
</li>
</ul>
</li>
<li><code>Promise.race</code>：语法同 <code>Promise.all</code>，但它只等待第一个<span class="heti-skip"><span class="heti-spacing"> </span>settled<span class="heti-spacing"> </span></span>的<span class="heti-skip"><span class="heti-spacing"> </span>promise<span class="heti-spacing"> </span></span>并获取其结果（或<span><span class="heti-spacing"> </span>error</span>）</li>
<li><code>Promise.any</code>：类似 <code>Promise.any</code>，但只等待第一个成功执行的<span class="heti-skip"><span class="heti-spacing"> </span>promise<span class="heti-spacing"> </span></span>并返回它的结果。如果没有<span class="heti-skip"><span class="heti-spacing"> </span>promise<span class="heti-spacing"> </span></span>成功执行，则返回的<span class="heti-skip"><span class="heti-spacing"> </span>promise<span class="heti-spacing"> </span></span>带有特殊<span class="heti-skip"><span class="heti-spacing"> </span>error<span class="heti-spacing"> </span></span>对象 <code>AggregateError</code>，在它的 <code>errors</code> 属性中存储所有的<span><span class="heti-spacing"> </span>promise error</span></li>
</ul>
<details class="example">
<summary>例子</summary>
<div class="language-js highlight"><pre><span></span><code><span id="__span-22-1"><a href="#__codelineno-22-1" id="__codelineno-22-1" name="__codelineno-22-1"></a><span class="nb">Promise</span><span class="p">.</span><span class="nx">any</span><span class="p">([</span>
</span><span id="__span-22-2"><a href="#__codelineno-22-2" id="__codelineno-22-2" name="__codelineno-22-2"></a><span class="w">    </span><span class="ow">new</span><span class="w"> </span><span class="nb">Promise</span><span class="p">((</span><span class="nx">resolve</span><span class="p">,</span><span class="w"> </span><span class="nx">reject</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">setTimeout</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">reject</span><span class="p">(</span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s2">"Ouch!"</span><span class="p">)),</span><span class="w"> </span><span class="mf">1000</span><span class="p">)),</span>
</span><span id="__span-22-3"><a href="#__codelineno-22-3" id="__codelineno-22-3" name="__codelineno-22-3"></a><span class="w">    </span><span class="ow">new</span><span class="w"> </span><span class="nb">Promise</span><span class="p">((</span><span class="nx">resolve</span><span class="p">,</span><span class="w"> </span><span class="nx">reject</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">setTimeout</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">reject</span><span class="p">(</span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s2">"Error!"</span><span class="p">)),</span><span class="w"> </span><span class="mf">2000</span><span class="p">))</span>
</span><span id="__span-22-4"><a href="#__codelineno-22-4" id="__codelineno-22-4" name="__codelineno-22-4"></a><span class="p">]).</span><span class="k">catch</span><span class="p">(</span><span class="nx">error</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-22-5"><a href="#__codelineno-22-5" id="__codelineno-22-5" name="__codelineno-22-5"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">error</span><span class="p">.</span><span class="kr">constructor</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span><span class="w"> </span><span class="c1">// AggregateError</span>
</span><span id="__span-22-6"><a href="#__codelineno-22-6" id="__codelineno-22-6" name="__codelineno-22-6"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">error</span><span class="p">.</span><span class="nx">errors</span><span class="p">[</span><span class="mf">0</span><span class="p">]);</span><span class="w"> </span><span class="c1">// Error: Ouch!</span>
</span><span id="__span-22-7"><a href="#__codelineno-22-7" id="__codelineno-22-7" name="__codelineno-22-7"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">error</span><span class="p">.</span><span class="nx">errors</span><span class="p">[</span><span class="mf">1</span><span class="p">]);</span><span class="w"> </span><span class="c1">// Error: Error!</span>
</span><span id="__span-22-8"><a href="#__codelineno-22-8" id="__codelineno-22-8" name="__codelineno-22-8"></a><span class="p">});</span>
</span></code></pre></div>
</details>
<ul>
<li><code>Promise.resolve</code><ul>
<li>语法：<code>Promise.resolve(value)</code>，同：<code>let promise = new Promise(resolve =&gt; resolve(value))</code>，即用结果 <code>value</code> 创建一个<span class="heti-skip"><span class="heti-spacing"> </span>resolved<span class="heti-spacing"> </span></span>的<span><span class="heti-spacing"> </span>promise</span></li>
</ul>
</li>
<li><code>Promise.reject</code><ul>
<li>语法：<code>Promise.reject(error)</code>，同：<code>let promise = new Promise((resolve, reject) =&gt; reject(error))</code>，即用 <code>error</code> 创建一个<span class="heti-skip"><span class="heti-spacing"> </span>rejected<span class="heti-spacing"> </span></span>的<span><span class="heti-spacing"> </span>promise</span><blockquote>
<p>注：后两种方法很少被用到，一般用 <code>async</code> 或 <code>await</code> 替代</p>
</blockquote>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Promisification：一个接受回调的函数<span class="heti-skip"><span class="heti-spacing"> </span>-&gt;<span class="heti-spacing"> </span></span>一个返回<span class="heti-skip"><span class="heti-spacing"> </span>promise<span class="heti-spacing"> </span></span>的函数</p>
<ul>
<li>转换模板（或者辅助函数<span><span class="heti-spacing"> </span>(helper)</span>）
<div class="language-js highlight"><pre><span></span><code><span id="__span-23-1"><a href="#__codelineno-23-1" id="__codelineno-23-1" name="__codelineno-23-1"></a><span class="c1">// promisify(f, true) 来获取结果数组</span>
</span><span id="__span-23-2"><a href="#__codelineno-23-2" id="__codelineno-23-2" name="__codelineno-23-2"></a><span class="kd">function</span><span class="w"> </span><span class="nx">promisify</span><span class="p">(</span><span class="nx">f</span><span class="p">,</span><span class="w"> </span><span class="nx">manyArgs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-23-3"><a href="#__codelineno-23-3" id="__codelineno-23-3" name="__codelineno-23-3"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(...</span><span class="nx">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-23-4"><a href="#__codelineno-23-4" id="__codelineno-23-4" name="__codelineno-23-4"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Promise</span><span class="p">((</span><span class="nx">resolve</span><span class="p">,</span><span class="w"> </span><span class="nx">reject</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-23-5"><a href="#__codelineno-23-5" id="__codelineno-23-5" name="__codelineno-23-5"></a><span class="w">            </span><span class="kd">function</span><span class="w"> </span><span class="nx">callback</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="p">...</span><span class="nx">results</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// 我们自定义的 f 的回调</span>
</span><span id="__span-23-6"><a href="#__codelineno-23-6" id="__codelineno-23-6" name="__codelineno-23-6"></a><span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">err</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-23-7"><a href="#__codelineno-23-7" id="__codelineno-23-7" name="__codelineno-23-7"></a><span class="w">                    </span><span class="nx">reject</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
</span><span id="__span-23-8"><a href="#__codelineno-23-8" id="__codelineno-23-8" name="__codelineno-23-8"></a><span class="w">                </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-23-9"><a href="#__codelineno-23-9" id="__codelineno-23-9" name="__codelineno-23-9"></a><span class="w">                </span><span class="c1">// 如果 manyArgs 被指定，则使用所有回调的结果 resolve</span>
</span><span id="__span-23-10"><a href="#__codelineno-23-10" id="__codelineno-23-10" name="__codelineno-23-10"></a><span class="w">                    </span><span class="nx">resolve</span><span class="p">(</span><span class="nx">manyArgs</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">results</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">results</span><span class="p">[</span><span class="mf">0</span><span class="p">]);</span>
</span><span id="__span-23-11"><a href="#__codelineno-23-11" id="__codelineno-23-11" name="__codelineno-23-11"></a><span class="w">                </span><span class="p">}</span>
</span><span id="__span-23-12"><a href="#__codelineno-23-12" id="__codelineno-23-12" name="__codelineno-23-12"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-23-13"><a href="#__codelineno-23-13" id="__codelineno-23-13" name="__codelineno-23-13"></a>
</span><span id="__span-23-14"><a href="#__codelineno-23-14" id="__codelineno-23-14" name="__codelineno-23-14"></a><span class="w">            </span><span class="nx">args</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">callback</span><span class="p">);</span>
</span><span id="__span-23-15"><a href="#__codelineno-23-15" id="__codelineno-23-15" name="__codelineno-23-15"></a>
</span><span id="__span-23-16"><a href="#__codelineno-23-16" id="__codelineno-23-16" name="__codelineno-23-16"></a><span class="w">            </span><span class="nx">f</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="p">...</span><span class="nx">args</span><span class="p">);</span>
</span><span id="__span-23-17"><a href="#__codelineno-23-17" id="__codelineno-23-17" name="__codelineno-23-17"></a><span class="w">        </span><span class="p">});</span>
</span><span id="__span-23-18"><a href="#__codelineno-23-18" id="__codelineno-23-18" name="__codelineno-23-18"></a><span class="w">    </span><span class="p">};</span>
</span><span id="__span-23-19"><a href="#__codelineno-23-19" id="__codelineno-23-19" name="__codelineno-23-19"></a><span class="p">}</span>
</span><span id="__span-23-20"><a href="#__codelineno-23-20" id="__codelineno-23-20" name="__codelineno-23-20"></a>
</span><span id="__span-23-21"><a href="#__codelineno-23-21" id="__codelineno-23-21" name="__codelineno-23-21"></a><span class="c1">// 用法：</span>
</span><span id="__span-23-22"><a href="#__codelineno-23-22" id="__codelineno-23-22" name="__codelineno-23-22"></a><span class="nx">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">promisify</span><span class="p">(</span><span class="nx">f</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">);</span><span class="w"> </span><span class="c1">// 或者 promisify(f)</span>
</span><span id="__span-23-23"><a href="#__codelineno-23-23" id="__codelineno-23-23" name="__codelineno-23-23"></a><span class="nx">f</span><span class="p">(...).</span><span class="nx">then</span><span class="p">(</span><span class="nx">arrayOfResults</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">...,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">...);</span>
</span></code></pre></div></li>
</ul>
</li>
<li>
<p>微任务<span><span class="heti-spacing"> </span>(microtask)</span>：所有的<span class="heti-skip"><span class="heti-spacing"> </span>promise<span class="heti-spacing"> </span></span>行为（<code>.then</code>、<code>.catch</code><heti-adjacent class="heti-adjacent-half">、</heti-adjacent><code>.finally</code>）都会经过一个名为<span class="heti-skip"><span class="heti-spacing"> </span>"promise jobs"<span class="heti-spacing"> </span></span>的队列（也被称为“微任务队列”<heti-adjacent class="heti-adjacent-half">）</heti-adjacent>，因此程序在当前代码完成之后才会调用队列里的处理程序</p>
</li>
</ul>
<details class="example">
<summary>例子</summary>
<div class="language-js highlight"><pre><span></span><code><span id="__span-24-1"><a href="#__codelineno-24-1" id="__codelineno-24-1" name="__codelineno-24-1"></a><span class="kd">let</span><span class="w"> </span><span class="nx">promise</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Promise</span><span class="p">.</span><span class="nx">resolve</span><span class="p">();</span>
</span><span id="__span-24-2"><a href="#__codelineno-24-2" id="__codelineno-24-2" name="__codelineno-24-2"></a><span class="nx">promise</span><span class="p">.</span><span class="nx">then</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">alert</span><span class="p">(</span><span class="s2">"promise done!"</span><span class="p">));</span>
</span><span id="__span-24-3"><a href="#__codelineno-24-3" id="__codelineno-24-3" name="__codelineno-24-3"></a><span class="nx">alert</span><span class="p">(</span><span class="s2">"code finished"</span><span class="p">);</span><span class="w"> </span>
</span></code></pre></div>
<p>这段代码对应的程序先执行第<span class="heti-skip"><span class="heti-spacing"> </span>3<span class="heti-spacing"> </span></span>行，后执行第<span class="heti-skip"><span class="heti-spacing"> </span>2<span class="heti-spacing"> </span></span>行。因为<span class="heti-skip"><span class="heti-spacing"> </span>promise<span class="heti-spacing"> </span></span>的处理程序暂时放在队列里，并不会立即执行；先执行最后一行，之后从队列中获取任务并执行。</p>
<p><figure markdown="span" style=" width: 60%">
<img alt="" src="../images/js/32_dark.png#only-dark"/>
<img alt="" src="../images/js/32_light.png#only-light"/>
<figcaption></figcaption>
</figure></p>
</details>
<h3 id="asyncawait">async/await<a class="headerlink" href="#asyncawait" title="Permanent link">⚓︎</a></h3>
<ul>
<li><code>async</code>：在函数前加该关键词，返回值被包装在一个<span class="heti-skip"><span class="heti-spacing"> </span>promise<span class="heti-spacing"> </span></span>里</li>
<li>
<p><code>await</code>：让<span class="heti-skip"><span class="heti-spacing"> </span>JS<span class="heti-spacing"> </span></span>等待某个<span><span class="heti-spacing"> </span>promise</span>，直到<span class="heti-skip"><span class="heti-spacing"> </span>promise<span class="heti-spacing"> </span></span>被<span class="heti-skip"><span class="heti-spacing"> </span>settle<span class="heti-spacing"> </span></span>并返回结果</p>
<div class="language-js highlight"><pre><span></span><code><span id="__span-25-1"><a href="#__codelineno-25-1" id="__codelineno-25-1" name="__codelineno-25-1"></a><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">f</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-25-2"><a href="#__codelineno-25-2" id="__codelineno-25-2" name="__codelineno-25-2"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">promise</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Promise</span><span class="p">((</span><span class="nx">resolve</span><span class="p">,</span><span class="w"> </span><span class="nx">reject</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-25-3"><a href="#__codelineno-25-3" id="__codelineno-25-3" name="__codelineno-25-3"></a><span class="w">        </span><span class="nx">setTimeout</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">resolve</span><span class="p">(</span><span class="s2">"done!"</span><span class="p">),</span><span class="w"> </span><span class="mf">1000</span><span class="p">)</span>
</span><span id="__span-25-4"><a href="#__codelineno-25-4" id="__codelineno-25-4" name="__codelineno-25-4"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-25-5"><a href="#__codelineno-25-5" id="__codelineno-25-5" name="__codelineno-25-5"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">promise</span><span class="p">;</span><span class="w"> </span><span class="c1">// 等待，直到 promise resolve </span>
</span><span id="__span-25-6"><a href="#__codelineno-25-6" id="__codelineno-25-6" name="__codelineno-25-6"></a><span class="w">    </span><span class="nx">alert</span><span class="p">(</span><span class="nx">result</span><span class="p">);</span><span class="w"> </span><span class="c1">// "done!"</span>
</span><span id="__span-25-7"><a href="#__codelineno-25-7" id="__codelineno-25-7" name="__codelineno-25-7"></a><span class="p">}</span>
</span><span id="__span-25-8"><a href="#__codelineno-25-8" id="__codelineno-25-8" name="__codelineno-25-8"></a><span class="nx">f</span><span class="p">();</span>
</span></code></pre></div>
<ul>
<li>仅用在 <code>async</code> 函数内的<span class="heti-skip"><span class="heti-spacing"> </span>promise<span class="heti-spacing"> </span></span>上，否则会报错</li>
<li><span>JS<span class="heti-spacing"> </span></span>还可以处理其他的任务，仅仅暂停执行带 <code>await</code> 的<span><span class="heti-spacing"> </span>promise</span></li>
<li>也可以用在<span class="heti-skip"><span class="heti-spacing"> </span>thenable<span class="heti-spacing"> </span></span>对象</li>
<li>如果<span class="heti-skip"><span class="heti-spacing"> </span>promise<span class="heti-spacing"> </span></span>被<span><span class="heti-spacing"> </span>reject</span>，那么它会抛出错误，类似 <code>throw error</code> 语句<ul>
<li>可以用 <code>try...catch</code> 来捕获错误</li>
<li>如果没有 <code>try...catch</code>，那么异步函数 <code>f()</code> 生成的<span class="heti-skip"><span class="heti-spacing"> </span>promise<span class="heti-spacing"> </span></span>将变为<span><span class="heti-spacing"> </span>rejected</span>，可以在后面添加 <code>.catch</code> 来处理这个<span><span class="heti-spacing"> </span>error</span></li>
<li>如果忘记添加 <code>.catch</code>，就会出现一个未处理的<span><span class="heti-spacing"> </span>promise error</span></li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="admonition note">
<p class="admonition-title">注</p>
<ul>
<li>若使用 <code>async/await</code>，几乎就不会用到 <code>.then</code></li>
<li><code>async/await</code> 可以和 <code>Promise.all</code> 一起使用</li>
</ul>
</div>
<h3 id="worker">worker<a class="headerlink" href="#worker" title="Permanent link">⚓︎</a></h3>
<p>前面提到过<a href="#同步和异步">耗时的同步函数的问题</a>，导致整个窗口完全没有响应，这是因为这种程序是单线程的。所谓「<strong>线程</strong><heti-adjacent class="heti-adjacent-half">」</heti-adjacent>，指的是程序遵循的一系列指令，而单线程的程序在同一时间只能做一件事。</p>
<p>而<span class="heti-skip"><span class="heti-spacing"> </span>worker<span class="heti-spacing"> </span></span>可以使程序拥有多线程，这样的好处是可以同时处理多个任务，而无需等待某个耗时长的任务。但要有一定限制：主代码的变量和<span class="heti-skip"><span class="heti-spacing"> </span>worker<span class="heti-spacing"> </span></span>的变量必须隔离，只能通过相互发送消息来进行交互（这也意味着<span class="heti-skip"><span class="heti-spacing"> </span>worker<span class="heti-spacing"> </span></span>不能访问<span><span class="heti-spacing"> </span>DOM</span>）</p>
<p><span>worker<span class="heti-spacing"> </span></span>种类：</p>
<ul>
<li>专用<span><span class="heti-spacing"> </span>(dedicated) worker</span>：仅用于一个脚本</li>
<li>共用<span><span class="heti-spacing"> </span>(shared) worker</span>：可以由运行在不同窗口的多个不同脚本共享</li>
<li>服务<span><span class="heti-spacing"> </span>(service) worker</span>：类似代理服务器，缓存资源以便<span class="heti-skip"><span class="heti-spacing"> </span>web app<span class="heti-spacing"> </span></span>在离线时工作</li>
</ul>
<p>下面以专用<span class="heti-skip"><span class="heti-spacing"> </span>worker<span class="heti-spacing"> </span></span>为例介绍<span class="heti-skip"><span class="heti-spacing"> </span>worker<span class="heti-spacing"> </span></span>的工作流程：</p>
<ul>
<li>将主代码和<span class="heti-skip"><span class="heti-spacing"> </span>worker<span class="heti-spacing"> </span></span>代码放在不同的文件内</li>
<li>
<p>主代码：
    </p><div class="language-js highlight"><pre><span></span><code><span id="__span-26-1"><a href="#__codelineno-26-1" id="__codelineno-26-1" name="__codelineno-26-1"></a><span class="c1">// 在 "generate.js" 中创建一个新的 worker</span>
</span><span id="__span-26-2"><a href="#__codelineno-26-2" id="__codelineno-26-2" name="__codelineno-26-2"></a><span class="kd">const</span><span class="w"> </span><span class="nx">worker</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Worker</span><span class="p">(</span><span class="s2">"./generate.js"</span><span class="p">);</span>
</span><span id="__span-26-3"><a href="#__codelineno-26-3" id="__codelineno-26-3" name="__codelineno-26-3"></a>
</span><span id="__span-26-4"><a href="#__codelineno-26-4" id="__codelineno-26-4" name="__codelineno-26-4"></a><span class="c1">// 当用户点击 "Generate primes" 时，给 worker 发送一条消息。</span>
</span><span id="__span-26-5"><a href="#__codelineno-26-5" id="__codelineno-26-5" name="__codelineno-26-5"></a><span class="c1">// 消息中的 command 属性是 "generate", 还包含另外一个属性 "quota"，即要生成的质数。</span>
</span><span id="__span-26-6"><a href="#__codelineno-26-6" id="__codelineno-26-6" name="__codelineno-26-6"></a><span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s2">"#generate"</span><span class="p">).</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">"click"</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-26-7"><a href="#__codelineno-26-7" id="__codelineno-26-7" name="__codelineno-26-7"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">quota</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s2">"#quota"</span><span class="p">).</span><span class="nx">value</span><span class="p">;</span>
</span><span id="__span-26-8"><a href="#__codelineno-26-8" id="__codelineno-26-8" name="__codelineno-26-8"></a><span class="w">    </span><span class="nx">worker</span><span class="p">.</span><span class="nx">postMessage</span><span class="p">({</span>
</span><span id="__span-26-9"><a href="#__codelineno-26-9" id="__codelineno-26-9" name="__codelineno-26-9"></a><span class="w">        </span><span class="nx">command</span><span class="o">:</span><span class="w"> </span><span class="s2">"generate"</span><span class="p">,</span>
</span><span id="__span-26-10"><a href="#__codelineno-26-10" id="__codelineno-26-10" name="__codelineno-26-10"></a><span class="w">        </span><span class="nx">quota</span><span class="o">:</span><span class="w"> </span><span class="nx">quota</span><span class="p">,</span>
</span><span id="__span-26-11"><a href="#__codelineno-26-11" id="__codelineno-26-11" name="__codelineno-26-11"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-26-12"><a href="#__codelineno-26-12" id="__codelineno-26-12" name="__codelineno-26-12"></a><span class="p">});</span>
</span><span id="__span-26-13"><a href="#__codelineno-26-13" id="__codelineno-26-13" name="__codelineno-26-13"></a>
</span><span id="__span-26-14"><a href="#__codelineno-26-14" id="__codelineno-26-14" name="__codelineno-26-14"></a><span class="c1">// 当 worker 给主线程回发一条消息时，为用户更新 output 框，包含生成的质数（从 message 中获取）。</span>
</span><span id="__span-26-15"><a href="#__codelineno-26-15" id="__codelineno-26-15" name="__codelineno-26-15"></a><span class="nx">worker</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">"message"</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nx">message</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-26-16"><a href="#__codelineno-26-16" id="__codelineno-26-16" name="__codelineno-26-16"></a><span class="w">    </span><span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s2">"#output"</span><span class="p">).</span><span class="nx">textContent</span><span class="w"> </span><span class="o">=</span>
</span><span id="__span-26-17"><a href="#__codelineno-26-17" id="__codelineno-26-17" name="__codelineno-26-17"></a><span class="w">        </span><span class="sb">`Finished generating </span><span class="si">${</span><span class="nx">message</span><span class="p">.</span><span class="nx">data</span><span class="si">}</span><span class="sb"> primes!`</span><span class="p">;</span>
</span><span id="__span-26-18"><a href="#__codelineno-26-18" id="__codelineno-26-18" name="__codelineno-26-18"></a><span class="p">});</span>
</span><span id="__span-26-19"><a href="#__codelineno-26-19" id="__codelineno-26-19" name="__codelineno-26-19"></a>
</span><span id="__span-26-20"><a href="#__codelineno-26-20" id="__codelineno-26-20" name="__codelineno-26-20"></a><span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s2">"#reload"</span><span class="p">).</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">"click"</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-26-21"><a href="#__codelineno-26-21" id="__codelineno-26-21" name="__codelineno-26-21"></a><span class="w">    </span><span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s2">"#user-input"</span><span class="p">).</span><span class="nx">value</span><span class="w"> </span><span class="o">=</span>
</span><span id="__span-26-22"><a href="#__codelineno-26-22" id="__codelineno-26-22" name="__codelineno-26-22"></a><span class="w">        </span><span class="s1">'Try typing in here immediately after pressing "Generate primes"'</span><span class="p">;</span>
</span><span id="__span-26-23"><a href="#__codelineno-26-23" id="__codelineno-26-23" name="__codelineno-26-23"></a><span class="w">    </span><span class="nb">document</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">reload</span><span class="p">();</span>
</span><span id="__span-26-24"><a href="#__codelineno-26-24" id="__codelineno-26-24" name="__codelineno-26-24"></a><span class="p">});</span>
</span></code></pre></div>
<ul>
<li>构造函数 <code>Worker()</code> 用于创建<span><span class="heti-spacing"> </span>worker</span>，参数为<span class="heti-skip"><span class="heti-spacing"> </span>worker<span class="heti-spacing"> </span></span>代码的地址</li>
<li>使用 <code>work.postMessage()</code> 向<span class="heti-skip"><span class="heti-spacing"> </span>worker<span class="heti-spacing"> </span></span>发送消息，它的参数</li>
<li>有一个 <code>message</code> 消息处理器，用于告知<span class="heti-skip"><span class="heti-spacing"> </span>worker<span class="heti-spacing"> </span></span>的完成时间和结果数据（通过 <code>message.data</code> 获取） </li>
<li>
<p><span>worker<span class="heti-spacing"> </span></span>代码：
</p><div class="language-js highlight"><pre><span></span><code><span id="__span-27-1"><a href="#__codelineno-27-1" id="__codelineno-27-1" name="__codelineno-27-1"></a><span class="c1">// 监听主线程中的消息。</span>
</span><span id="__span-27-2"><a href="#__codelineno-27-2" id="__codelineno-27-2" name="__codelineno-27-2"></a><span class="c1">// 如果消息中的 command 是 "generate"，则调用 `generatePrimse()`</span>
</span><span id="__span-27-3"><a href="#__codelineno-27-3" id="__codelineno-27-3" name="__codelineno-27-3"></a><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">"message"</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nx">message</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-27-4"><a href="#__codelineno-27-4" id="__codelineno-27-4" name="__codelineno-27-4"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">message</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">command</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s2">"generate"</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-27-5"><a href="#__codelineno-27-5" id="__codelineno-27-5" name="__codelineno-27-5"></a><span class="w">        </span><span class="nx">generatePrimes</span><span class="p">(</span><span class="nx">message</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">quota</span><span class="p">);</span>
</span><span id="__span-27-6"><a href="#__codelineno-27-6" id="__codelineno-27-6" name="__codelineno-27-6"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-27-7"><a href="#__codelineno-27-7" id="__codelineno-27-7" name="__codelineno-27-7"></a><span class="p">});</span>
</span><span id="__span-27-8"><a href="#__codelineno-27-8" id="__codelineno-27-8" name="__codelineno-27-8"></a>
</span><span id="__span-27-9"><a href="#__codelineno-27-9" id="__codelineno-27-9" name="__codelineno-27-9"></a><span class="c1">// 生成质数 (非常低效)</span>
</span><span id="__span-27-10"><a href="#__codelineno-27-10" id="__codelineno-27-10" name="__codelineno-27-10"></a><span class="kd">function</span><span class="w"> </span><span class="nx">generatePrimes</span><span class="p">(</span><span class="nx">quota</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-27-11"><a href="#__codelineno-27-11" id="__codelineno-27-11" name="__codelineno-27-11"></a><span class="w">    </span><span class="kd">function</span><span class="w"> </span><span class="nx">isPrime</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-27-12"><a href="#__codelineno-27-12" id="__codelineno-27-12" name="__codelineno-27-12"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">let</span><span class="w"> </span><span class="nx">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">2</span><span class="p">;</span><span class="w"> </span><span class="nx">c</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">sqrt</span><span class="p">(</span><span class="nx">n</span><span class="p">);</span><span class="w"> </span><span class="o">++</span><span class="nx">c</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-27-13"><a href="#__codelineno-27-13" id="__codelineno-27-13" name="__codelineno-27-13"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">n</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="nx">c</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-27-14"><a href="#__codelineno-27-14" id="__codelineno-27-14" name="__codelineno-27-14"></a><span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
</span><span id="__span-27-15"><a href="#__codelineno-27-15" id="__codelineno-27-15" name="__codelineno-27-15"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-27-16"><a href="#__codelineno-27-16" id="__codelineno-27-16" name="__codelineno-27-16"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-27-17"><a href="#__codelineno-27-17" id="__codelineno-27-17" name="__codelineno-27-17"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
</span><span id="__span-27-18"><a href="#__codelineno-27-18" id="__codelineno-27-18" name="__codelineno-27-18"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-27-19"><a href="#__codelineno-27-19" id="__codelineno-27-19" name="__codelineno-27-19"></a>
</span><span id="__span-27-20"><a href="#__codelineno-27-20" id="__codelineno-27-20" name="__codelineno-27-20"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">primes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[];</span>
</span><span id="__span-27-21"><a href="#__codelineno-27-21" id="__codelineno-27-21" name="__codelineno-27-21"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">maximum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1000000</span><span class="p">;</span>
</span><span id="__span-27-22"><a href="#__codelineno-27-22" id="__codelineno-27-22" name="__codelineno-27-22"></a>
</span><span id="__span-27-23"><a href="#__codelineno-27-23" id="__codelineno-27-23" name="__codelineno-27-23"></a><span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="nx">primes</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">quota</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-27-24"><a href="#__codelineno-27-24" id="__codelineno-27-24" name="__codelineno-27-24"></a><span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">candidate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">maximum</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span><span class="p">));</span>
</span><span id="__span-27-25"><a href="#__codelineno-27-25" id="__codelineno-27-25" name="__codelineno-27-25"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">isPrime</span><span class="p">(</span><span class="nx">candidate</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-27-26"><a href="#__codelineno-27-26" id="__codelineno-27-26" name="__codelineno-27-26"></a><span class="w">            </span><span class="nx">primes</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">candidate</span><span class="p">);</span>
</span><span id="__span-27-27"><a href="#__codelineno-27-27" id="__codelineno-27-27" name="__codelineno-27-27"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-27-28"><a href="#__codelineno-27-28" id="__codelineno-27-28" name="__codelineno-27-28"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-27-29"><a href="#__codelineno-27-29" id="__codelineno-27-29" name="__codelineno-27-29"></a>
</span><span id="__span-27-30"><a href="#__codelineno-27-30" id="__codelineno-27-30" name="__codelineno-27-30"></a><span class="w">    </span><span class="c1">// 完成后给主线程发送一条包含我们生成的质数数量的消息消息。</span>
</span><span id="__span-27-31"><a href="#__codelineno-27-31" id="__codelineno-27-31" name="__codelineno-27-31"></a><span class="w">    </span><span class="nx">postMessage</span><span class="p">(</span><span class="nx">primes</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span>
</span><span id="__span-27-32"><a href="#__codelineno-27-32" id="__codelineno-27-32" name="__codelineno-27-32"></a><span class="p">}</span>
</span></code></pre></div>
</li>
<li>
<p><span>worker<span class="heti-spacing"> </span></span>首先要通过 <code>addEventListener()</code> 来监听来自主代码的消息</p>
</li>
<li>使用 <code>postMessage</code> 向主代码发送消息，替代原来用 <code>return</code> 语句返回值</li>
</ul>
</li>
</ul>
<h2 id="web-api">Web API<a class="headerlink" href="#web-api" title="Permanent link">⚓︎</a></h2>
<p><a href="https://en.wikipedia.org/wiki/Ajax_(programming)">AJAX</a>(Asynchronous JavaScript And XML)</p>
<h3 id="fetch">Fetch<a class="headerlink" href="#fetch" title="Permanent link">⚓︎</a></h3>
<ul>
<li>
<p>基本语法：
    </p><div class="language-js highlight"><pre><span></span><code><span id="__span-28-1"><a href="#__codelineno-28-1" id="__codelineno-28-1" name="__codelineno-28-1"></a><span class="c1">// url：（字面意思），options：可选参数，有 method, headers 等</span>
</span><span id="__span-28-2"><a href="#__codelineno-28-2" id="__codelineno-28-2" name="__codelineno-28-2"></a><span class="c1">// 没有 options 的话就是一个简单的 GET 请求，下载 url 的内容</span>
</span><span id="__span-28-3"><a href="#__codelineno-28-3" id="__codelineno-28-3" name="__codelineno-28-3"></a><span class="kd">let</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fetch</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span><span class="w"> </span><span class="nx">options</span><span class="p">);</span>
</span><span id="__span-28-4"><a href="#__codelineno-28-4" id="__codelineno-28-4" name="__codelineno-28-4"></a><span class="kd">let</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span>
</span><span id="__span-28-5"><a href="#__codelineno-28-5" id="__codelineno-28-5" name="__codelineno-28-5"></a>
</span><span id="__span-28-6"><a href="#__codelineno-28-6" id="__codelineno-28-6" name="__codelineno-28-6"></a><span class="c1">// 或者 promise 链的形式</span>
</span><span id="__span-28-7"><a href="#__codelineno-28-7" id="__codelineno-28-7" name="__codelineno-28-7"></a><span class="nx">fetch</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span><span class="w"> </span><span class="nx">options</span><span class="p">)</span>
</span><span id="__span-28-8"><a href="#__codelineno-28-8" id="__codelineno-28-8" name="__codelineno-28-8"></a><span class="w">    </span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">response</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">())</span>
</span><span id="__span-28-9"><a href="#__codelineno-28-9" id="__codelineno-28-9" name="__codelineno-28-9"></a><span class="w">    </span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">result</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="cm">/* process result */</span><span class="p">)</span>
</span></code></pre></div>
<p>其他参数有：</p>
<ul>
<li>
<p><code>headers</code>：设置请求头<span class="heti-skip"><span class="heti-spacing"> </span>(request header)<span class="heti-spacing"> </span></span>一个带有输出头的对象，但有<a href="https://fetch.spec.whatwg.org/#forbidden-header-name">一些头</a>无法被设置
</p><div class="language-js highlight"><pre><span></span><code><span id="__span-29-1"><a href="#__codelineno-29-1" id="__codelineno-29-1" name="__codelineno-29-1"></a><span class="kd">let</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fetch</span><span class="p">(</span><span class="nx">protectedUrl</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-29-2"><a href="#__codelineno-29-2" id="__codelineno-29-2" name="__codelineno-29-2"></a><span class="w">    </span><span class="nx">headers</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-29-3"><a href="#__codelineno-29-3" id="__codelineno-29-3" name="__codelineno-29-3"></a><span class="w">        </span><span class="nx">Authentication</span><span class="o">:</span><span class="w"> </span><span class="s1">'secret'</span>
</span><span id="__span-29-4"><a href="#__codelineno-29-4" id="__codelineno-29-4" name="__codelineno-29-4"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-29-5"><a href="#__codelineno-29-5" id="__codelineno-29-5" name="__codelineno-29-5"></a><span class="p">});</span><span class="w">  </span>
</span></code></pre></div>
</li>
<li>
<p><code>method</code>：<span>HTTP<span class="heti-spacing"> </span></span>方法，可用值有 <code>'POST'</code> 等</p>
</li>
<li><code>body</code>：设置请求体，可用值有<ul>
<li>（<span>JSON<span class="heti-spacing"> </span></span>编码的）字符串</li>
<li><code>FormData</code> 对象，以 <code>multipart/form-data</code> 形式发送数据（可用于发送<span class="heti-skip"><span class="heti-spacing"> </span>HTML<span class="heti-spacing"> </span></span>表单）</li>
<li><code>Blob/BufferSource</code> 发送二进制数据（可用于发送图片）</li>
<li>URLSearchParams，以 <code>x-www-form-unlencoded</code> 编码发送数据（很少使用）</li>
</ul>
</li>
<li><code>signal</code>：在“中止”一节中会提到</li>
<li><a href="https://zh.javascript.info/fetch-api">其他参数</a>（由于很少使用就不在这里介绍了）</li>
</ul>
<details class="example">
<summary>例子</summary>
<div class="language-js highlight"><pre><span></span><code><span id="__span-30-1"><a href="#__codelineno-30-1" id="__codelineno-30-1" name="__codelineno-30-1"></a><span class="kd">let</span><span class="w"> </span><span class="nx">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-2"><a href="#__codelineno-30-2" id="__codelineno-30-2" name="__codelineno-30-2"></a><span class="w">    </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s1">'John'</span><span class="p">,</span>
</span><span id="__span-30-3"><a href="#__codelineno-30-3" id="__codelineno-30-3" name="__codelineno-30-3"></a><span class="w">    </span><span class="nx">surname</span><span class="o">:</span><span class="w"> </span><span class="s1">'Smith'</span>
</span><span id="__span-30-4"><a href="#__codelineno-30-4" id="__codelineno-30-4" name="__codelineno-30-4"></a><span class="p">};</span>
</span><span id="__span-30-5"><a href="#__codelineno-30-5" id="__codelineno-30-5" name="__codelineno-30-5"></a>
</span><span id="__span-30-6"><a href="#__codelineno-30-6" id="__codelineno-30-6" name="__codelineno-30-6"></a><span class="kd">let</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fetch</span><span class="p">(</span><span class="s1">'/article/fetch/post/user'</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-7"><a href="#__codelineno-30-7" id="__codelineno-30-7" name="__codelineno-30-7"></a><span class="w">    </span><span class="nx">method</span><span class="o">:</span><span class="w"> </span><span class="s1">'POST'</span><span class="p">,</span>
</span><span id="__span-30-8"><a href="#__codelineno-30-8" id="__codelineno-30-8" name="__codelineno-30-8"></a><span class="w">    </span><span class="nx">headers</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-9"><a href="#__codelineno-30-9" id="__codelineno-30-9" name="__codelineno-30-9"></a><span class="w">        </span><span class="s1">'Content-Type'</span><span class="o">:</span><span class="w"> </span><span class="s1">'application/json;charset=utf-8'</span>
</span><span id="__span-30-10"><a href="#__codelineno-30-10" id="__codelineno-30-10" name="__codelineno-30-10"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-30-11"><a href="#__codelineno-30-11" id="__codelineno-30-11" name="__codelineno-30-11"></a><span class="w">    </span><span class="nx">body</span><span class="o">:</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">user</span><span class="p">)</span>
</span><span id="__span-30-12"><a href="#__codelineno-30-12" id="__codelineno-30-12" name="__codelineno-30-12"></a><span class="p">});</span>
</span><span id="__span-30-13"><a href="#__codelineno-30-13" id="__codelineno-30-13" name="__codelineno-30-13"></a>
</span><span id="__span-30-14"><a href="#__codelineno-30-14" id="__codelineno-30-14" name="__codelineno-30-14"></a><span class="kd">let</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span>
</span><span id="__span-30-15"><a href="#__codelineno-30-15" id="__codelineno-30-15" name="__codelineno-30-15"></a><span class="nx">alert</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
</span></code></pre></div>
</details>
</li>
<li>
<p>获取响应的流程</p>
<ul>
<li>
<p>当服务器发送响应头<span class="heti-skip"><span class="heti-spacing"> </span>(response header)<span class="heti-spacing"> </span></span>时，<code>fetch</code> 返回的<span class="heti-skip"><span class="heti-spacing"> </span>promise<span class="heti-spacing"> </span></span>使用内建的<span class="heti-skip"><span class="heti-spacing"> </span>Response class<span class="heti-spacing"> </span></span>对象来解析响应头</p>
<ul>
<li>在该阶段，可以通过检查响应头来查看<span class="heti-skip"><span class="heti-spacing"> </span>HTTP<span class="heti-spacing"> </span></span>状态已确定请求是否成功、有没有响应体</li>
<li>通过以下<span class="heti-skip"><span class="heti-spacing"> </span>response<span class="heti-spacing"> </span></span>的属性查看<span class="heti-skip"><span class="heti-spacing"> </span>HTTP<span class="heti-spacing"> </span></span>状态<ul>
<li><code>status</code>：<span>HTTP<span class="heti-spacing"> </span></span>状态码</li>
<li><code>ok</code>：布尔值，若状态码在<span class="heti-skip"><span class="heti-spacing"> </span>200-299<span class="heti-spacing"> </span></span>之间，则为 <code>true</code></li>
</ul>
</li>
</ul>
<details class="example">
<summary>例子</summary>
<div class="language-js highlight"><pre><span></span><code><span id="__span-31-1"><a href="#__codelineno-31-1" id="__codelineno-31-1" name="__codelineno-31-1"></a><span class="kd">let</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fetch</span><span class="p">(</span><span class="nx">url</span><span class="p">);</span>
</span><span id="__span-31-2"><a href="#__codelineno-31-2" id="__codelineno-31-2" name="__codelineno-31-2"></a>
</span><span id="__span-31-3"><a href="#__codelineno-31-3" id="__codelineno-31-3" name="__codelineno-31-3"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">ok</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// 如果 HTTP 状态码为 200-299</span>
</span><span id="__span-31-4"><a href="#__codelineno-31-4" id="__codelineno-31-4" name="__codelineno-31-4"></a><span class="w">    </span><span class="c1">// 获取 response body（此方法会在下面解释）</span>
</span><span id="__span-31-5"><a href="#__codelineno-31-5" id="__codelineno-31-5" name="__codelineno-31-5"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">json</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span>
</span><span id="__span-31-6"><a href="#__codelineno-31-6" id="__codelineno-31-6" name="__codelineno-31-6"></a><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-31-7"><a href="#__codelineno-31-7" id="__codelineno-31-7" name="__codelineno-31-7"></a><span class="w">    </span><span class="nx">alert</span><span class="p">(</span><span class="s2">"HTTP-Error: "</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">status</span><span class="p">);</span>
</span><span id="__span-31-8"><a href="#__codelineno-31-8" id="__codelineno-31-8" name="__codelineno-31-8"></a><span class="p">}</span>
</span></code></pre></div>
</details>
</li>
<li>
<p>使用其他方法获取响应体<span><span class="heti-spacing"> </span>(response body)</span>，包括：</p>
<ul>
<li><code>response.text()</code>：以文本形式返回<span><span class="heti-spacing"> </span>response</span></li>
<li><code>response.json()</code>：以<span class="heti-skip"><span class="heti-spacing"> </span>JSON<span class="heti-spacing"> </span></span>格式返回<span><span class="heti-spacing"> </span>response</span></li>
<li><code>response.formData()</code>：以 <code>FormData</code> 对象的形式返回<span><span class="heti-spacing"> </span>response</span></li>
<li><code>response.blob()</code>：以<span><span class="heti-spacing"> </span>Blob</span>（带有类型的二进制数据）的形式返回<span><span class="heti-spacing"> </span>response</span></li>
<li><code>response.arrayBuffer()</code>：以<span><span class="heti-spacing"> </span>ArrayBuffer</span>（低级别的二进制数据）形式返回<span><span class="heti-spacing"> </span>response</span></li>
<li><code>response.body</code>：<span>ReadableStream<span class="heti-spacing"> </span></span>对象，允许逐块读取响应体（后面会介绍）<blockquote>
<p>注意：对同一个<span class="heti-skip"><span class="heti-spacing"> </span>response<span class="heti-spacing"> </span></span>只能使用上述方法中的一种</p>
</blockquote>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>响应头：位于 <code>response.headers</code> 中，是一个类似映射的<span class="heti-skip"><span class="heti-spacing"> </span>header<span class="heti-spacing"> </span></span>对象
</p><div class="language-js highlight"><pre><span></span><code><span id="__span-32-1"><a href="#__codelineno-32-1" id="__codelineno-32-1" name="__codelineno-32-1"></a><span class="kd">let</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fetch</span><span class="p">(</span><span class="s1">'https://www.example.com/haha'</span><span class="p">);</span>
</span><span id="__span-32-2"><a href="#__codelineno-32-2" id="__codelineno-32-2" name="__codelineno-32-2"></a>
</span><span id="__span-32-3"><a href="#__codelineno-32-3" id="__codelineno-32-3" name="__codelineno-32-3"></a><span class="c1">// 获取一个 header</span>
</span><span id="__span-32-4"><a href="#__codelineno-32-4" id="__codelineno-32-4" name="__codelineno-32-4"></a><span class="nx">alert</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">headers</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'Content-Type'</span><span class="p">));</span><span class="w"> </span>
</span><span id="__span-32-5"><a href="#__codelineno-32-5" id="__codelineno-32-5" name="__codelineno-32-5"></a><span class="c1">// application/json; charset=utf-8</span>
</span><span id="__span-32-6"><a href="#__codelineno-32-6" id="__codelineno-32-6" name="__codelineno-32-6"></a>
</span><span id="__span-32-7"><a href="#__codelineno-32-7" id="__codelineno-32-7" name="__codelineno-32-7"></a><span class="c1">// 迭代所有 header</span>
</span><span id="__span-32-8"><a href="#__codelineno-32-8" id="__codelineno-32-8" name="__codelineno-32-8"></a><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">let</span><span class="w"> </span><span class="p">[</span><span class="nx">key</span><span class="p">,</span><span class="w"> </span><span class="nx">value</span><span class="p">]</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">headers</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-32-9"><a href="#__codelineno-32-9" id="__codelineno-32-9" name="__codelineno-32-9"></a><span class="w">  </span><span class="nx">alert</span><span class="p">(</span><span class="sb">`</span><span class="si">${</span><span class="nx">key</span><span class="si">}</span><span class="sb"> = </span><span class="si">${</span><span class="nx">value</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span><span id="__span-32-10"><a href="#__codelineno-32-10" id="__codelineno-32-10" name="__codelineno-32-10"></a><span class="p">}</span>
</span></code></pre></div>
</li>
<li>
<p>FormData：用于发送<span class="heti-skip"><span class="heti-spacing"> </span>HTML<span class="heti-spacing"> </span></span>表单</p>
<ul>
<li>
<p>构造函数：
</p><div class="language-js highlight"><pre><span></span><code><span id="__span-33-1"><a href="#__codelineno-33-1" id="__codelineno-33-1" name="__codelineno-33-1"></a><span class="kd">let</span><span class="w"> </span><span class="nx">formData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">FormData</span><span class="p">([</span><span class="nx">form</span><span class="p">]);</span>
</span><span id="__span-33-2"><a href="#__codelineno-33-2" id="__codelineno-33-2" name="__codelineno-33-2"></a><span class="c1">// formData 是一个 FormData 对象</span>
</span><span id="__span-33-3"><a href="#__codelineno-33-3" id="__codelineno-33-3" name="__codelineno-33-3"></a><span class="c1">// 如果提供了 HTML form 元素，它会自动捕获 form 元素字段</span>
</span></code></pre></div>
</li>
<li>
<p>相关方法</p>
<ul>
<li><code>formData.append(name, value[, filename])</code>：添加具有给定 <code>name</code> 和 <code>value</code> 的表单字段；可选参数 <code>filename</code> 用于设置文件名，此时该表单类似 <code>&lt;input type="file"&gt;</code></li>
<li><code>formData.set(name, value)</code> / <code>formData.set(name, blob, filename)</code>：与上一种方法类似，但它确保只有一个 <code>name</code> 字段。所以如果原来有 <code>name</code> 字段就会被移除，并附加一个新的 <code>name</code> 字段</li>
<li><code>formData.delete(name)</code>：移除 <code>name</code> 字段</li>
<li><code>formData.get(name)</code>：获取 <code>name</code> 字段</li>
<li><code>formData.has(name)</code>：若存在 <code>name</code> 字段，则返回 <code>true</code>，否则返回 <code>false</code> </li>
<li>使用 <code>for...of</code> 循环迭代<span class="heti-skip"><span class="heti-spacing"> </span>formData<span class="heti-spacing"> </span></span>字段
<div class="language-js highlight"><pre><span></span><code><span id="__span-34-1"><a href="#__codelineno-34-1" id="__codelineno-34-1" name="__codelineno-34-1"></a><span class="kd">let</span><span class="w"> </span><span class="nx">formData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">FormData</span><span class="p">();</span>
</span><span id="__span-34-2"><a href="#__codelineno-34-2" id="__codelineno-34-2" name="__codelineno-34-2"></a><span class="nx">formData</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s1">'key1'</span><span class="p">,</span><span class="w"> </span><span class="s1">'value1'</span><span class="p">);</span>
</span><span id="__span-34-3"><a href="#__codelineno-34-3" id="__codelineno-34-3" name="__codelineno-34-3"></a><span class="nx">formData</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s1">'key2'</span><span class="p">,</span><span class="w"> </span><span class="s1">'value2'</span><span class="p">);</span>
</span><span id="__span-34-4"><a href="#__codelineno-34-4" id="__codelineno-34-4" name="__codelineno-34-4"></a>
</span><span id="__span-34-5"><a href="#__codelineno-34-5" id="__codelineno-34-5" name="__codelineno-34-5"></a><span class="c1">// 列出 key/value 对</span>
</span><span id="__span-34-6"><a href="#__codelineno-34-6" id="__codelineno-34-6" name="__codelineno-34-6"></a><span class="k">for</span><span class="p">(</span><span class="kd">let</span><span class="w"> </span><span class="p">[</span><span class="nx">name</span><span class="p">,</span><span class="w"> </span><span class="nx">value</span><span class="p">]</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nx">formData</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-7"><a href="#__codelineno-34-7" id="__codelineno-34-7" name="__codelineno-34-7"></a><span class="w">    </span><span class="nx">alert</span><span class="p">(</span><span class="sb">`</span><span class="si">${</span><span class="nx">name</span><span class="si">}</span><span class="sb"> = </span><span class="si">${</span><span class="nx">value</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span><span class="w"> </span><span class="c1">// key1 = value1，然后是 key2 = value2</span>
</span><span id="__span-34-8"><a href="#__codelineno-34-8" id="__codelineno-34-8" name="__codelineno-34-8"></a><span class="p">}</span>
</span></code></pre></div></li>
</ul>
</li>
<li>
<p>发送文件
</p><div class="language-html highlight"><pre><span></span><code><span id="__span-35-1"><a href="#__codelineno-35-1" id="__codelineno-35-1" name="__codelineno-35-1"></a><span class="p">&lt;</span><span class="nt">form</span> <span class="na">id</span><span class="o">=</span><span class="s">"formElem"</span><span class="p">&gt;</span>
</span><span id="__span-35-2"><a href="#__codelineno-35-2" id="__codelineno-35-2" name="__codelineno-35-2"></a>    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">"text"</span> <span class="na">name</span><span class="o">=</span><span class="s">"firstName"</span> <span class="na">value</span><span class="o">=</span><span class="s">"John"</span><span class="p">&gt;</span>
</span><span id="__span-35-3"><a href="#__codelineno-35-3" id="__codelineno-35-3" name="__codelineno-35-3"></a>    Picture: <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">"file"</span> <span class="na">name</span><span class="o">=</span><span class="s">"picture"</span> <span class="na">accept</span><span class="o">=</span><span class="s">"image/*"</span><span class="p">&gt;</span>
</span><span id="__span-35-4"><a href="#__codelineno-35-4" id="__codelineno-35-4" name="__codelineno-35-4"></a>    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">"submit"</span><span class="p">&gt;</span>
</span><span id="__span-35-5"><a href="#__codelineno-35-5" id="__codelineno-35-5" name="__codelineno-35-5"></a><span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
</span><span id="__span-35-6"><a href="#__codelineno-35-6" id="__codelineno-35-6" name="__codelineno-35-6"></a>
</span><span id="__span-35-7"><a href="#__codelineno-35-7" id="__codelineno-35-7" name="__codelineno-35-7"></a><span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
</span><span id="__span-35-8"><a href="#__codelineno-35-8" id="__codelineno-35-8" name="__codelineno-35-8"></a><span class="w">    </span><span class="nx">formElem</span><span class="p">.</span><span class="nx">onsubmit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">e</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-35-9"><a href="#__codelineno-35-9" id="__codelineno-35-9" name="__codelineno-35-9"></a><span class="w">        </span><span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
</span><span id="__span-35-10"><a href="#__codelineno-35-10" id="__codelineno-35-10" name="__codelineno-35-10"></a>
</span><span id="__span-35-11"><a href="#__codelineno-35-11" id="__codelineno-35-11" name="__codelineno-35-11"></a><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fetch</span><span class="p">(</span><span class="s1">'/article/formdata/post/user-avatar'</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-35-12"><a href="#__codelineno-35-12" id="__codelineno-35-12" name="__codelineno-35-12"></a><span class="w">            </span><span class="nx">method</span><span class="o">:</span><span class="w"> </span><span class="s1">'POST'</span><span class="p">,</span>
</span><span id="__span-35-13"><a href="#__codelineno-35-13" id="__codelineno-35-13" name="__codelineno-35-13"></a><span class="w">            </span><span class="nx">body</span><span class="o">:</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">FormData</span><span class="p">(</span><span class="nx">formElem</span><span class="p">)</span>
</span><span id="__span-35-14"><a href="#__codelineno-35-14" id="__codelineno-35-14" name="__codelineno-35-14"></a><span class="w">        </span><span class="p">});</span>
</span><span id="__span-35-15"><a href="#__codelineno-35-15" id="__codelineno-35-15" name="__codelineno-35-15"></a>
</span><span id="__span-35-16"><a href="#__codelineno-35-16" id="__codelineno-35-16" name="__codelineno-35-16"></a><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span>
</span><span id="__span-35-17"><a href="#__codelineno-35-17" id="__codelineno-35-17" name="__codelineno-35-17"></a>
</span><span id="__span-35-18"><a href="#__codelineno-35-18" id="__codelineno-35-18" name="__codelineno-35-18"></a><span class="w">        </span><span class="nx">alert</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
</span><span id="__span-35-19"><a href="#__codelineno-35-19" id="__codelineno-35-19" name="__codelineno-35-19"></a><span class="w">    </span><span class="p">};</span>
</span><span id="__span-35-20"><a href="#__codelineno-35-20" id="__codelineno-35-20" name="__codelineno-35-20"></a><span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span></code></pre></div>
</li>
<li>
<p>可以将二进制数据作为表单的一部分发送</p>
</li>
</ul>
<details class="example">
<summary>例子</summary>
<div class="language-html highlight"><pre><span></span><code><span id="__span-36-1"><a href="#__codelineno-36-1" id="__codelineno-36-1" name="__codelineno-36-1"></a><span class="p">&lt;</span><span class="nt">body</span> <span class="na">style</span><span class="o">=</span><span class="s">"margin:0"</span><span class="p">&gt;</span>
</span><span id="__span-36-2"><a href="#__codelineno-36-2" id="__codelineno-36-2" name="__codelineno-36-2"></a>    <span class="p">&lt;</span><span class="nt">canvas</span> <span class="na">id</span><span class="o">=</span><span class="s">"canvasElem"</span> <span class="na">width</span><span class="o">=</span><span class="s">"100"</span> <span class="na">height</span><span class="o">=</span><span class="s">"80"</span> <span class="na">style</span><span class="o">=</span><span class="s">"border:1px solid"</span><span class="p">&gt;&lt;/</span><span class="nt">canvas</span><span class="p">&gt;</span>
</span><span id="__span-36-3"><a href="#__codelineno-36-3" id="__codelineno-36-3" name="__codelineno-36-3"></a>
</span><span id="__span-36-4"><a href="#__codelineno-36-4" id="__codelineno-36-4" name="__codelineno-36-4"></a>    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">"button"</span> <span class="na">value</span><span class="o">=</span><span class="s">"Submit"</span> <span class="na">onclick</span><span class="o">=</span><span class="s">"submit()"</span><span class="p">&gt;</span>
</span><span id="__span-36-5"><a href="#__codelineno-36-5" id="__codelineno-36-5" name="__codelineno-36-5"></a>
</span><span id="__span-36-6"><a href="#__codelineno-36-6" id="__codelineno-36-6" name="__codelineno-36-6"></a>    <span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
</span><span id="__span-36-7"><a href="#__codelineno-36-7" id="__codelineno-36-7" name="__codelineno-36-7"></a><span class="w">        </span><span class="nx">canvasElem</span><span class="p">.</span><span class="nx">onmousemove</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-36-8"><a href="#__codelineno-36-8" id="__codelineno-36-8" name="__codelineno-36-8"></a><span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="nx">ctx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">canvasElem</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s1">'2d'</span><span class="p">);</span>
</span><span id="__span-36-9"><a href="#__codelineno-36-9" id="__codelineno-36-9" name="__codelineno-36-9"></a><span class="w">            </span><span class="nx">ctx</span><span class="p">.</span><span class="nx">lineTo</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">clientX</span><span class="p">,</span><span class="w"> </span><span class="nx">e</span><span class="p">.</span><span class="nx">clientY</span><span class="p">);</span>
</span><span id="__span-36-10"><a href="#__codelineno-36-10" id="__codelineno-36-10" name="__codelineno-36-10"></a><span class="w">            </span><span class="nx">ctx</span><span class="p">.</span><span class="nx">stroke</span><span class="p">();</span>
</span><span id="__span-36-11"><a href="#__codelineno-36-11" id="__codelineno-36-11" name="__codelineno-36-11"></a><span class="w">        </span><span class="p">};</span>
</span><span id="__span-36-12"><a href="#__codelineno-36-12" id="__codelineno-36-12" name="__codelineno-36-12"></a>
</span><span id="__span-36-13"><a href="#__codelineno-36-13" id="__codelineno-36-13" name="__codelineno-36-13"></a><span class="w">        </span><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">submit</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-36-14"><a href="#__codelineno-36-14" id="__codelineno-36-14" name="__codelineno-36-14"></a><span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="nx">imageBlob</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Promise</span><span class="p">(</span><span class="nx">resolve</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">canvasElem</span><span class="p">.</span><span class="nx">toBlob</span><span class="p">(</span><span class="nx">resolve</span><span class="p">,</span><span class="w"> </span><span class="s1">'image/png'</span><span class="p">));</span>
</span><span id="__span-36-15"><a href="#__codelineno-36-15" id="__codelineno-36-15" name="__codelineno-36-15"></a>
</span><span id="__span-36-16"><a href="#__codelineno-36-16" id="__codelineno-36-16" name="__codelineno-36-16"></a><span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="nx">formData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">FormData</span><span class="p">();</span>
</span><span id="__span-36-17"><a href="#__codelineno-36-17" id="__codelineno-36-17" name="__codelineno-36-17"></a><span class="w">            </span><span class="nx">formData</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">"firstName"</span><span class="p">,</span><span class="w"> </span><span class="s2">"John"</span><span class="p">);</span>
</span><span id="__span-36-18"><a href="#__codelineno-36-18" id="__codelineno-36-18" name="__codelineno-36-18"></a><span class="w">            </span><span class="nx">formData</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">"image"</span><span class="p">,</span><span class="w"> </span><span class="nx">imageBlob</span><span class="p">,</span><span class="w"> </span><span class="s2">"image.png"</span><span class="p">);</span>
</span><span id="__span-36-19"><a href="#__codelineno-36-19" id="__codelineno-36-19" name="__codelineno-36-19"></a>
</span><span id="__span-36-20"><a href="#__codelineno-36-20" id="__codelineno-36-20" name="__codelineno-36-20"></a><span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fetch</span><span class="p">(</span><span class="s1">'/article/formdata/post/image-form'</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-36-21"><a href="#__codelineno-36-21" id="__codelineno-36-21" name="__codelineno-36-21"></a><span class="w">                </span><span class="nx">method</span><span class="o">:</span><span class="w"> </span><span class="s1">'POST'</span><span class="p">,</span>
</span><span id="__span-36-22"><a href="#__codelineno-36-22" id="__codelineno-36-22" name="__codelineno-36-22"></a><span class="w">                </span><span class="nx">body</span><span class="o">:</span><span class="w"> </span><span class="nx">formData</span>
</span><span id="__span-36-23"><a href="#__codelineno-36-23" id="__codelineno-36-23" name="__codelineno-36-23"></a><span class="w">            </span><span class="p">});</span>
</span><span id="__span-36-24"><a href="#__codelineno-36-24" id="__codelineno-36-24" name="__codelineno-36-24"></a><span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span>
</span><span id="__span-36-25"><a href="#__codelineno-36-25" id="__codelineno-36-25" name="__codelineno-36-25"></a><span class="w">            </span><span class="nx">alert</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
</span><span id="__span-36-26"><a href="#__codelineno-36-26" id="__codelineno-36-26" name="__codelineno-36-26"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-36-27"><a href="#__codelineno-36-27" id="__codelineno-36-27" name="__codelineno-36-27"></a>
</span><span id="__span-36-28"><a href="#__codelineno-36-28" id="__codelineno-36-28" name="__codelineno-36-28"></a><span class="w">    </span><span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span><span id="__span-36-29"><a href="#__codelineno-36-29" id="__codelineno-36-29" name="__codelineno-36-29"></a><span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
</span></code></pre></div>
</details>
</li>
<li>
<p>跟踪下载进度：使用 <code>response.body</code> 属性，它是一个 <code>ReadableStream</code> 对象，逐块<span class="heti-skip"><span class="heti-spacing"> </span>(chunk)<span class="heti-spacing"> </span></span>提供响应体
    </p><div class="language-js highlight"><pre><span></span><code><span id="__span-37-1"><a href="#__codelineno-37-1" id="__codelineno-37-1" name="__codelineno-37-1"></a><span class="c1">// 流读取器(stream reader)</span>
</span><span id="__span-37-2"><a href="#__codelineno-37-2" id="__codelineno-37-2" name="__codelineno-37-2"></a><span class="kd">const</span><span class="w"> </span><span class="nx">reader</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">getReader</span><span class="p">();</span>
</span><span id="__span-37-3"><a href="#__codelineno-37-3" id="__codelineno-37-3" name="__codelineno-37-3"></a>
</span><span id="__span-37-4"><a href="#__codelineno-37-4" id="__codelineno-37-4" name="__codelineno-37-4"></a><span class="c1">// 在 body 下载时，一直为无限循环</span>
</span><span id="__span-37-5"><a href="#__codelineno-37-5" id="__codelineno-37-5" name="__codelineno-37-5"></a><span class="k">while</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-37-6"><a href="#__codelineno-37-6" id="__codelineno-37-6" name="__codelineno-37-6"></a><span class="w">    </span><span class="c1">// 当最后一块下载完成时，done 值为 true</span>
</span><span id="__span-37-7"><a href="#__codelineno-37-7" id="__codelineno-37-7" name="__codelineno-37-7"></a><span class="w">    </span><span class="c1">// value 是块字节的 Uint8Array</span>
</span><span id="__span-37-8"><a href="#__codelineno-37-8" id="__codelineno-37-8" name="__codelineno-37-8"></a><span class="hll"><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="nx">done</span><span class="p">,</span><span class="w"> </span><span class="nx">value</span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">reader</span><span class="p">.</span><span class="nx">read</span><span class="p">();</span>
</span></span><span id="__span-37-9"><a href="#__codelineno-37-9" id="__codelineno-37-9" name="__codelineno-37-9"></a>
</span><span id="__span-37-10"><a href="#__codelineno-37-10" id="__codelineno-37-10" name="__codelineno-37-10"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">done</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-37-11"><a href="#__codelineno-37-11" id="__codelineno-37-11" name="__codelineno-37-11"></a><span class="w">        </span><span class="k">break</span><span class="p">;</span>
</span><span id="__span-37-12"><a href="#__codelineno-37-12" id="__codelineno-37-12" name="__codelineno-37-12"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-37-13"><a href="#__codelineno-37-13" id="__codelineno-37-13" name="__codelineno-37-13"></a>
</span><span id="__span-37-14"><a href="#__codelineno-37-14" id="__codelineno-37-14" name="__codelineno-37-14"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`Received </span><span class="si">${</span><span class="nx">value</span><span class="p">.</span><span class="nx">length</span><span class="si">}</span><span class="sb"> bytes`</span><span class="p">)</span>
</span><span id="__span-37-15"><a href="#__codelineno-37-15" id="__codelineno-37-15" name="__codelineno-37-15"></a><span class="p">}</span>
</span></code></pre></div>
<ul>
<li>循环接收响应块<span><span class="heti-spacing"> </span>(response chunk)</span>，直到加载完成（<code>done</code> 为 <code>true</code>）</li>
<li>要打印进度，只需将每个接收到的片段 <code>value</code> 长度（<code>.length</code>）加到计数器上即可</li>
</ul>
<details class="example">
<summary>更复杂的例子</summary>
<div class="language-js highlight"><pre><span></span><code><span id="__span-38-1"><a href="#__codelineno-38-1" id="__codelineno-38-1" name="__codelineno-38-1"></a><span class="c1">// Step 1：启动 fetch，并获得一个 reader</span>
</span><span id="__span-38-2"><a href="#__codelineno-38-2" id="__codelineno-38-2" name="__codelineno-38-2"></a><span class="kd">let</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fetch</span><span class="p">(</span><span class="s1">'https://api.github.com/repos/javascript-tutorial/en.javascript.info/commits?per_page=100'</span><span class="p">);</span>
</span><span id="__span-38-3"><a href="#__codelineno-38-3" id="__codelineno-38-3" name="__codelineno-38-3"></a>
</span><span id="__span-38-4"><a href="#__codelineno-38-4" id="__codelineno-38-4" name="__codelineno-38-4"></a><span class="kd">const</span><span class="w"> </span><span class="nx">reader</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">getReader</span><span class="p">();</span>
</span><span id="__span-38-5"><a href="#__codelineno-38-5" id="__codelineno-38-5" name="__codelineno-38-5"></a>
</span><span id="__span-38-6"><a href="#__codelineno-38-6" id="__codelineno-38-6" name="__codelineno-38-6"></a><span class="c1">// Step 2：获得总长度（length）</span>
</span><span id="__span-38-7"><a href="#__codelineno-38-7" id="__codelineno-38-7" name="__codelineno-38-7"></a><span class="kd">const</span><span class="w"> </span><span class="nx">contentLength</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">+</span><span class="nx">response</span><span class="p">.</span><span class="nx">headers</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'Content-Length'</span><span class="p">);</span>
</span><span id="__span-38-8"><a href="#__codelineno-38-8" id="__codelineno-38-8" name="__codelineno-38-8"></a>
</span><span id="__span-38-9"><a href="#__codelineno-38-9" id="__codelineno-38-9" name="__codelineno-38-9"></a><span class="c1">// Step 3：读取数据</span>
</span><span id="__span-38-10"><a href="#__codelineno-38-10" id="__codelineno-38-10" name="__codelineno-38-10"></a><span class="kd">let</span><span class="w"> </span><span class="nx">receivedLength</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w"> </span><span class="c1">// 当前接收到了这么多字节</span>
</span><span id="__span-38-11"><a href="#__codelineno-38-11" id="__codelineno-38-11" name="__codelineno-38-11"></a><span class="kd">let</span><span class="w"> </span><span class="nx">chunks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[];</span><span class="w"> </span><span class="c1">// 接收到的二进制块的数组（包括 body）</span>
</span><span id="__span-38-12"><a href="#__codelineno-38-12" id="__codelineno-38-12" name="__codelineno-38-12"></a><span class="k">while</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-38-13"><a href="#__codelineno-38-13" id="__codelineno-38-13" name="__codelineno-38-13"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="nx">done</span><span class="p">,</span><span class="w"> </span><span class="nx">value</span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">reader</span><span class="p">.</span><span class="nx">read</span><span class="p">();</span>
</span><span id="__span-38-14"><a href="#__codelineno-38-14" id="__codelineno-38-14" name="__codelineno-38-14"></a>
</span><span id="__span-38-15"><a href="#__codelineno-38-15" id="__codelineno-38-15" name="__codelineno-38-15"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">done</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-38-16"><a href="#__codelineno-38-16" id="__codelineno-38-16" name="__codelineno-38-16"></a><span class="w">        </span><span class="k">break</span><span class="p">;</span>
</span><span id="__span-38-17"><a href="#__codelineno-38-17" id="__codelineno-38-17" name="__codelineno-38-17"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-38-18"><a href="#__codelineno-38-18" id="__codelineno-38-18" name="__codelineno-38-18"></a>
</span><span id="__span-38-19"><a href="#__codelineno-38-19" id="__codelineno-38-19" name="__codelineno-38-19"></a><span class="w">    </span><span class="nx">chunks</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span>
</span><span id="__span-38-20"><a href="#__codelineno-38-20" id="__codelineno-38-20" name="__codelineno-38-20"></a><span class="w">    </span><span class="nx">receivedLength</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">value</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
</span><span id="__span-38-21"><a href="#__codelineno-38-21" id="__codelineno-38-21" name="__codelineno-38-21"></a>
</span><span id="__span-38-22"><a href="#__codelineno-38-22" id="__codelineno-38-22" name="__codelineno-38-22"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`Received </span><span class="si">${</span><span class="nx">receivedLength</span><span class="si">}</span><span class="sb"> of </span><span class="si">${</span><span class="nx">contentLength</span><span class="si">}</span><span class="sb">`</span><span class="p">)</span>
</span><span id="__span-38-23"><a href="#__codelineno-38-23" id="__codelineno-38-23" name="__codelineno-38-23"></a><span class="p">}</span>
</span><span id="__span-38-24"><a href="#__codelineno-38-24" id="__codelineno-38-24" name="__codelineno-38-24"></a>
</span><span id="__span-38-25"><a href="#__codelineno-38-25" id="__codelineno-38-25" name="__codelineno-38-25"></a><span class="c1">// Step 4：将块连接到单个 Uint8Array</span>
</span><span id="__span-38-26"><a href="#__codelineno-38-26" id="__codelineno-38-26" name="__codelineno-38-26"></a><span class="kd">let</span><span class="w"> </span><span class="nx">chunksAll</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Uint8Array</span><span class="p">(</span><span class="nx">receivedLength</span><span class="p">);</span><span class="w"> </span><span class="c1">// (4.1)</span>
</span><span id="__span-38-27"><a href="#__codelineno-38-27" id="__codelineno-38-27" name="__codelineno-38-27"></a><span class="kd">let</span><span class="w"> </span><span class="nx">position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
</span><span id="__span-38-28"><a href="#__codelineno-38-28" id="__codelineno-38-28" name="__codelineno-38-28"></a><span class="k">for</span><span class="p">(</span><span class="kd">let</span><span class="w"> </span><span class="nx">chunk</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nx">chunks</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-38-29"><a href="#__codelineno-38-29" id="__codelineno-38-29" name="__codelineno-38-29"></a><span class="w">    </span><span class="nx">chunksAll</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">chunk</span><span class="p">,</span><span class="w"> </span><span class="nx">position</span><span class="p">);</span><span class="w"> </span><span class="c1">// (4.2)</span>
</span><span id="__span-38-30"><a href="#__codelineno-38-30" id="__codelineno-38-30" name="__codelineno-38-30"></a><span class="w">    </span><span class="nx">position</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">chunk</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
</span><span id="__span-38-31"><a href="#__codelineno-38-31" id="__codelineno-38-31" name="__codelineno-38-31"></a><span class="p">}</span>
</span><span id="__span-38-32"><a href="#__codelineno-38-32" id="__codelineno-38-32" name="__codelineno-38-32"></a>
</span><span id="__span-38-33"><a href="#__codelineno-38-33" id="__codelineno-38-33" name="__codelineno-38-33"></a><span class="c1">// Step 5：解码成字符串</span>
</span><span id="__span-38-34"><a href="#__codelineno-38-34" id="__codelineno-38-34" name="__codelineno-38-34"></a><span class="kd">let</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">TextDecoder</span><span class="p">(</span><span class="s2">"utf-8"</span><span class="p">).</span><span class="nx">decode</span><span class="p">(</span><span class="nx">chunksAll</span><span class="p">);</span>
</span><span id="__span-38-35"><a href="#__codelineno-38-35" id="__codelineno-38-35" name="__codelineno-38-35"></a>
</span><span id="__span-38-36"><a href="#__codelineno-38-36" id="__codelineno-38-36" name="__codelineno-38-36"></a><span class="c1">// 我们完成啦！</span>
</span><span id="__span-38-37"><a href="#__codelineno-38-37" id="__codelineno-38-37" name="__codelineno-38-37"></a><span class="kd">let</span><span class="w"> </span><span class="nx">commits</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">result</span><span class="p">);</span>
</span><span id="__span-38-38"><a href="#__codelineno-38-38" id="__codelineno-38-38" name="__codelineno-38-38"></a><span class="nx">alert</span><span class="p">(</span><span class="nx">commits</span><span class="p">[</span><span class="mf">0</span><span class="p">].</span><span class="nx">author</span><span class="p">.</span><span class="nx">login</span><span class="p">);</span>
</span></code></pre></div>
</details>
</li>
<li>
<p>中止<span><span class="heti-spacing"> </span>(abort)</span>：<code>AbortController</code> 内建对象可用于中止 <code>fetch</code>（也可以中止其他异步任务）</p>
<ul>
<li>
<p>创建控制器<span><span class="heti-spacing"> </span>(controller)</span>，它有单个方法 <code>abort()</code>，和单个属性 <code>signal</code>
</p><div class="language-js highlight"><pre><span></span><code><span id="__span-39-1"><a href="#__codelineno-39-1" id="__codelineno-39-1" name="__codelineno-39-1"></a><span class="kd">let</span><span class="w"> </span><span class="nx">controller</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">AbortController</span><span class="p">();</span>
</span></code></pre></div>
<ul>
<li>
<p>调用 <code>abort()</code> 时，<code>controller.signal</code> 就会触发 <code>abort</code> 事件，<code>controller.signal.aborted</code> 属性变为 <code>true</code></p>
<ul>
<li>与 <code>fetch</code> 一起使用：使用 <code>fetch</code> 的可选参数 <code>signal</code>，它的值为 <code>AbortController</code> 的 <code>signal</code> 属性
<div class="language-js highlight"><pre><span></span><code><span id="__span-40-1"><a href="#__codelineno-40-1" id="__codelineno-40-1" name="__codelineno-40-1"></a><span class="kd">let</span><span class="w"> </span><span class="nx">controller</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">AbortController</span><span class="p">();</span>
</span><span id="__span-40-2"><a href="#__codelineno-40-2" id="__codelineno-40-2" name="__codelineno-40-2"></a><span class="nx">fetch</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-3"><a href="#__codelineno-40-3" id="__codelineno-40-3" name="__codelineno-40-3"></a><span class="w">    </span><span class="nx">signal</span><span class="o">:</span><span class="w"> </span><span class="nx">controller</span><span class="p">.</span><span class="nx">signal</span>
</span><span id="__span-40-4"><a href="#__codelineno-40-4" id="__codelineno-40-4" name="__codelineno-40-4"></a><span class="p">});</span>
</span><span id="__span-40-5"><a href="#__codelineno-40-5" id="__codelineno-40-5" name="__codelineno-40-5"></a>
</span><span id="__span-40-6"><a href="#__codelineno-40-6" id="__codelineno-40-6" name="__codelineno-40-6"></a><span class="c1">// 中止 fetch</span>
</span><span id="__span-40-7"><a href="#__codelineno-40-7" id="__codelineno-40-7" name="__codelineno-40-7"></a><span class="nx">controller</span><span class="p">.</span><span class="nx">abort</span><span class="p">();</span>
</span></code></pre></div></li>
</ul>
</li>
<li>
<p>当 <code>fetch</code> 被中止时，它的<span class="heti-skip"><span class="heti-spacing"> </span>promise<span class="heti-spacing"> </span></span>就被<span class="heti-skip"><span class="heti-spacing"> </span>reject<span class="heti-spacing"> </span></span>了，并返回 <code>AbortError</code> 错误，需要用 <code>try...catch</code> 来处理</p>
</li>
</ul>
<details class="example">
<summary>例子</summary>
<p></p><div class="language-js highlight"><pre><span></span><code><span id="__span-41-1"><a href="#__codelineno-41-1" id="__codelineno-41-1" name="__codelineno-41-1"></a><span class="c1">// 1 秒后中止</span>
</span><span id="__span-41-2"><a href="#__codelineno-41-2" id="__codelineno-41-2" name="__codelineno-41-2"></a><span class="kd">let</span><span class="w"> </span><span class="nx">controller</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">AbortController</span><span class="p">();</span>
</span><span id="__span-41-3"><a href="#__codelineno-41-3" id="__codelineno-41-3" name="__codelineno-41-3"></a><span class="nx">setTimeout</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">controller</span><span class="p">.</span><span class="nx">abort</span><span class="p">(),</span><span class="w"> </span><span class="mf">1000</span><span class="p">);</span>
</span><span id="__span-41-4"><a href="#__codelineno-41-4" id="__codelineno-41-4" name="__codelineno-41-4"></a>
</span><span id="__span-41-5"><a href="#__codelineno-41-5" id="__codelineno-41-5" name="__codelineno-41-5"></a><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-41-6"><a href="#__codelineno-41-6" id="__codelineno-41-6" name="__codelineno-41-6"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fetch</span><span class="p">(</span><span class="s1">'/article/fetch-abort/demo/hang'</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-41-7"><a href="#__codelineno-41-7" id="__codelineno-41-7" name="__codelineno-41-7"></a><span class="w">        </span><span class="nx">signal</span><span class="o">:</span><span class="w"> </span><span class="nx">controller</span><span class="p">.</span><span class="nx">signal</span>
</span><span id="__span-41-8"><a href="#__codelineno-41-8" id="__codelineno-41-8" name="__codelineno-41-8"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-41-9"><a href="#__codelineno-41-9" id="__codelineno-41-9" name="__codelineno-41-9"></a><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-41-10"><a href="#__codelineno-41-10" id="__codelineno-41-10" name="__codelineno-41-10"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nx">name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">'AbortError'</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// handle abort()</span>
</span><span id="__span-41-11"><a href="#__codelineno-41-11" id="__codelineno-41-11" name="__codelineno-41-11"></a><span class="w">        </span><span class="nx">alert</span><span class="p">(</span><span class="s2">"Aborted!"</span><span class="p">);</span>
</span><span id="__span-41-12"><a href="#__codelineno-41-12" id="__codelineno-41-12" name="__codelineno-41-12"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-41-13"><a href="#__codelineno-41-13" id="__codelineno-41-13" name="__codelineno-41-13"></a><span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="nx">err</span><span class="p">;</span>
</span><span id="__span-41-14"><a href="#__codelineno-41-14" id="__codelineno-41-14" name="__codelineno-41-14"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-41-15"><a href="#__codelineno-41-15" id="__codelineno-41-15" name="__codelineno-41-15"></a><span class="p">}</span>
</span></code></pre></div>
- <code>AbortController</code> 的可伸缩(scalable)性：单个 <code>AbortController</code> 可以一次性取消多个 <code>fetch</code>，也可以同时取消我们自己设置的异步任务
<details class="example">
<summary>例子</summary>
</details>
</details>
<div class="language-js highlight"><pre><span></span><code><span id="__span-42-1"><a href="#__codelineno-42-1" id="__codelineno-42-1" name="__codelineno-42-1"></a><span class="kd">let</span><span class="w"> </span><span class="nx">urls</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[...];</span>
</span><span id="__span-42-2"><a href="#__codelineno-42-2" id="__codelineno-42-2" name="__codelineno-42-2"></a><span class="kd">let</span><span class="w"> </span><span class="nx">controller</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">AbortController</span><span class="p">();</span>
</span><span id="__span-42-3"><a href="#__codelineno-42-3" id="__codelineno-42-3" name="__codelineno-42-3"></a>
</span><span id="__span-42-4"><a href="#__codelineno-42-4" id="__codelineno-42-4" name="__codelineno-42-4"></a><span class="kd">let</span><span class="w"> </span><span class="nx">ourJob</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Promise</span><span class="p">((</span><span class="nx">resolve</span><span class="p">,</span><span class="w"> </span><span class="nx">reject</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// 我们的任务</span>
</span><span id="__span-42-5"><a href="#__codelineno-42-5" id="__codelineno-42-5" name="__codelineno-42-5"></a><span class="w">    </span><span class="c1">// ...</span>
</span><span id="__span-42-6"><a href="#__codelineno-42-6" id="__codelineno-42-6" name="__codelineno-42-6"></a><span class="w">    </span><span class="nx">controller</span><span class="p">.</span><span class="nx">signal</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">'abort'</span><span class="p">,</span><span class="w"> </span><span class="nx">reject</span><span class="p">);</span>
</span><span id="__span-42-7"><a href="#__codelineno-42-7" id="__codelineno-42-7" name="__codelineno-42-7"></a><span class="p">});</span>
</span><span id="__span-42-8"><a href="#__codelineno-42-8" id="__codelineno-42-8" name="__codelineno-42-8"></a>
</span><span id="__span-42-9"><a href="#__codelineno-42-9" id="__codelineno-42-9" name="__codelineno-42-9"></a><span class="kd">let</span><span class="w"> </span><span class="nx">fetchJobs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">urls</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">url</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">fetch</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// fetches</span>
</span><span id="__span-42-10"><a href="#__codelineno-42-10" id="__codelineno-42-10" name="__codelineno-42-10"></a><span class="w">    </span><span class="nx">signal</span><span class="o">:</span><span class="w"> </span><span class="nx">controller</span><span class="p">.</span><span class="nx">signal</span>
</span><span id="__span-42-11"><a href="#__codelineno-42-11" id="__codelineno-42-11" name="__codelineno-42-11"></a><span class="p">}));</span>
</span><span id="__span-42-12"><a href="#__codelineno-42-12" id="__codelineno-42-12" name="__codelineno-42-12"></a>
</span><span id="__span-42-13"><a href="#__codelineno-42-13" id="__codelineno-42-13" name="__codelineno-42-13"></a><span class="c1">// 等待完成我们的任务和所有 fetch</span>
</span><span id="__span-42-14"><a href="#__codelineno-42-14" id="__codelineno-42-14" name="__codelineno-42-14"></a><span class="kd">let</span><span class="w"> </span><span class="nx">results</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nb">Promise</span><span class="p">.</span><span class="nx">all</span><span class="p">([...</span><span class="nx">fetchJobs</span><span class="p">,</span><span class="w"> </span><span class="nx">ourJob</span><span class="p">]);</span>
</span><span id="__span-42-15"><a href="#__codelineno-42-15" id="__codelineno-42-15" name="__codelineno-42-15"></a>
</span><span id="__span-42-16"><a href="#__codelineno-42-16" id="__codelineno-42-16" name="__codelineno-42-16"></a><span class="c1">// controller.abort() 被从任何地方调用，</span>
</span><span id="__span-42-17"><a href="#__codelineno-42-17" id="__codelineno-42-17" name="__codelineno-42-17"></a><span class="c1">// 它都将中止所有 fetch 和 ourJob</span>
</span></code></pre></div>
</li>
</ul>
</li>
<li>
<p>跨源请求</p>
<ul>
<li>回顾知识：<a href="../../security.html#cors">CORS（跨源资源共享）</a></li>
<li>简单请求</li>
</ul>
<details class="example">
<summary>例子</summary>
<ul>
<li>
<p>请求头
</p><div class="language-http highlight"><pre><span></span><code><span id="__span-43-1"><a href="#__codelineno-43-1" id="__codelineno-43-1" name="__codelineno-43-1"></a><span class="err">GET /request</span>
</span><span id="__span-43-2"><a href="#__codelineno-43-2" id="__codelineno-43-2" name="__codelineno-43-2"></a><span class="err">Host: anywhere.com</span>
</span><span id="__span-43-3"><a href="#__codelineno-43-3" id="__codelineno-43-3" name="__codelineno-43-3"></a><span class="err">Origin: https://javascript.info</span>
</span><span id="__span-43-4"><a href="#__codelineno-43-4" id="__codelineno-43-4" name="__codelineno-43-4"></a><span class="err">...</span>
</span></code></pre></div>
</li>
<li>
<p>响应头
</p><div class="language-http highlight"><pre><span></span><code><span id="__span-44-1"><a href="#__codelineno-44-1" id="__codelineno-44-1" name="__codelineno-44-1"></a><span class="err">200 OK</span>
</span><span id="__span-44-2"><a href="#__codelineno-44-2" id="__codelineno-44-2" name="__codelineno-44-2"></a><span class="err">Content-Type:text/html; charset=UTF-8</span>
</span><span id="__span-44-3"><a href="#__codelineno-44-3" id="__codelineno-44-3" name="__codelineno-44-3"></a><span class="err">Access-Control-Allow-Origin: https://javascript.info</span>
</span></code></pre></div>
</li>
</ul>
<p><figure markdown="span" style=" width: 60%">
<img alt="" src="../images/js/33_dark.png#only-dark"/>
<img alt="" src="../images/js/33_light.png#only-light"/>
<figcaption></figcaption>
</figure></p>
</details>
<ul>
<li>非简单请求</li>
</ul>
<p><figure markdown="span" style=" width: 60%">
<img alt="" src="../images/js/34_dark.png#only-dark"/>
<img alt="" src="../images/js/34_light.png#only-light"/>
<figcaption></figcaption>
</figure></p>
</li>
</ul>
<h3 id="url-对象"><span>URL<span class="heti-spacing"> </span></span>对象<a class="headerlink" href="#url-对象" title="Permanent link">⚓︎</a></h3>
<p><span>URL<span class="heti-spacing"> </span></span>对象可以用来替代 <code>fetch</code> 或 <code>XMLHttpRequest</code> 中的<span class="heti-skip"><span class="heti-spacing"> </span>URL<span class="heti-spacing"> </span></span>字符串。虽然稍微麻烦些，但是有时它比字符串形式更加有用。</p>
<ul>
<li>
<p>创建<span class="heti-skip"><span class="heti-spacing"> </span>URL<span class="heti-spacing"> </span></span>对象
    </p><div class="language-js highlight"><pre><span></span><code><span id="__span-45-1"><a href="#__codelineno-45-1" id="__codelineno-45-1" name="__codelineno-45-1"></a><span class="kd">let</span><span class="w"> </span><span class="nx">url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">URL</span><span class="p">(</span><span class="nx">url</span><span class="p">[,</span><span class="w"> </span><span class="nx">base</span><span class="p">]);</span>
</span></code></pre></div>
<ul>
<li>如果只有一个参数，那么 <code>url</code> 应为完整的<span class="heti-skip"><span class="heti-spacing"> </span>URL<span class="heti-spacing"> </span></span>字符串</li>
<li>如果有两个参数，那么 <code>base</code> 为基础<span><span class="heti-spacing"> </span>URL</span>（字符串或<span class="heti-skip"><span class="heti-spacing"> </span>URL<span class="heti-spacing"> </span></span>对象<heti-adjacent class="heti-adjacent-half">）</heti-adjacent>，<code>url</code> 为该<span class="heti-skip"><span class="heti-spacing"> </span>URL<span class="heti-spacing"> </span></span>的路径（字符串）
<div class="language-js highlight"><pre><span></span><code><span id="__span-46-1"><a href="#__codelineno-46-1" id="__codelineno-46-1" name="__codelineno-46-1"></a><span class="c1">// 这两个 URL 是一样的</span>
</span><span id="__span-46-2"><a href="#__codelineno-46-2" id="__codelineno-46-2" name="__codelineno-46-2"></a><span class="kd">let</span><span class="w"> </span><span class="nx">url1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">URL</span><span class="p">(</span><span class="s1">'https://javascript.info/profile/admin'</span><span class="p">);</span>
</span><span id="__span-46-3"><a href="#__codelineno-46-3" id="__codelineno-46-3" name="__codelineno-46-3"></a><span class="kd">let</span><span class="w"> </span><span class="nx">url2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">URL</span><span class="p">(</span><span class="s1">'/profile/admin'</span><span class="p">,</span><span class="w"> </span><span class="s1">'https://javascript.info'</span><span class="p">);</span>
</span></code></pre></div></li>
</ul>
</li>
<li>
<p><span>URL<span class="heti-spacing"> </span></span>对象的一些属性：</p>
<p><figure markdown="span" style=" width: 70%">
<img alt="" src="../images/js/35_dark.png#only-dark"/>
<img alt="" src="../images/js/35_light.png#only-light"/>
<figcaption></figcaption>
</figure></p>
<ul>
<li><code>.href</code>：完整的<span><span class="heti-spacing"> </span>URL</span>，同 <code>url.toString()</code></li>
<li><code>.protocol</code>：协议，以冒号结尾</li>
<li><code>.search</code>：以问号 <code>?</code> 开头的一系列参数</li>
<li><code>.hash</code>：以 <code>#</code> 开头的字符串</li>
<li>若有<span class="heti-skip"><span class="heti-spacing"> </span>HTTP<span class="heti-spacing"> </span></span>身份验证，则可能还有 <code>.user</code> 和 <code>.password</code> 属性（很少用）</li>
<li><code>url.searchParams</code>：一种<span class="heti-skip"><span class="heti-spacing"> </span>URLSearchParams<span class="heti-spacing"> </span></span>类型的对象，与搜索参数相关，有以下几种方法：<ul>
<li><code>append(name, value)</code>：添加</li>
<li><code>delete(name)</code>：移除</li>
<li><code>get(name)</code>：获取</li>
<li><code>getAll(name)</code>：获取相同名称的所有参数</li>
<li><code>has(name)</code>：检查是否存在</li>
<li><code>set(name, value)</code>：添加<span class="heti-skip"><span class="heti-spacing"> </span>/<span class="heti-spacing"> </span></span>移除原参数后再添加</li>
<li><code>sort()</code>：按名称对参数排序（很少使用）</li>
<li>可迭代，类似映射</li>
<li>参数中的特殊字符（<code>!</code>、<code>:</code> 等）会被转换为<span class="heti-skip"><span class="heti-spacing"> </span>UTF-8<span class="heti-spacing"> </span></span>编码，以百分号开头</li>
</ul>
</li>
<li>编<span class="heti-skip"><span class="heti-spacing"> </span>/<span class="heti-spacing"> </span></span>解码<span class="heti-skip"><span class="heti-spacing"> </span>URL<span class="heti-spacing"> </span></span>的内建函数</li>
<li><code>encodeURI</code>：仅编码<span class="heti-skip"><span class="heti-spacing"> </span>URL<span class="heti-spacing"> </span></span>中完全禁止的字符</li>
<li><code>decodeURI</code>：解码，回到之前的状态</li>
<li><code>encodeURIComponent</code>：在 <code>encodeURI</code> 的基础上，还编码 <code>#</code>、<code>$</code>、<code>&amp;</code>、<code>+</code>、<code>,</code>、<code>/</code>、<code>:</code>、<code>;</code>、<code>=</code>、<code>?</code>、<code>@</code> 字符，更适用于带搜索参数的<span><span class="heti-spacing"> </span>URL</span></li>
<li><code>decodeURIComponent</code>：解码，回到之前的状态</li>
</ul>
</li>
</ul>
<h3 id="xmlhttprequest">XMLHttpRequest<a class="headerlink" href="#xmlhttprequest" title="Permanent link">⚓︎</a></h3>
<p><code>XMLHttpRequest</code> 是一个内建的浏览器对象，允许使用<span class="heti-skip"><span class="heti-spacing"> </span>JS<span class="heti-spacing"> </span></span>发送<span class="heti-skip"><span class="heti-spacing"> </span>HTTP<span class="heti-spacing"> </span></span>请求。</p>
<ul>
<li>
<p>发送请求的流程：</p>
<ul>
<li>
<p>创建对象
</p><div class="language-js highlight"><pre><span></span><code><span id="__span-47-1"><a href="#__codelineno-47-1" id="__codelineno-47-1" name="__codelineno-47-1"></a><span class="c1">// 该构造函数没有参数</span>
</span><span id="__span-47-2"><a href="#__codelineno-47-2" id="__codelineno-47-2" name="__codelineno-47-2"></a><span class="kd">let</span><span class="w"> </span><span class="nx">xhr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">XMLHttpRequest</span><span class="p">();</span>
</span></code></pre></div>
</li>
<li>
<p>初始化（紧跟构造函数之后）
    </p><div class="language-js highlight"><pre><span></span><code><span id="__span-48-1"><a href="#__codelineno-48-1" id="__codelineno-48-1" name="__codelineno-48-1"></a><span class="nx">xhr</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="nx">method</span><span class="p">,</span><span class="w"> </span><span class="nx">URL</span><span class="p">[,</span><span class="w"> </span><span class="k">async</span><span class="p">,</span><span class="w"> </span><span class="nx">user</span><span class="p">,</span><span class="w"> </span><span class="nx">password</span><span class="p">]);</span>
</span></code></pre></div>
<ul>
<li><code>method</code>：<span>HTTP<span class="heti-spacing"> </span></span>方法，通常是 <code>"GET"</code> 或 <code>"POST"</code></li>
<li><code>URL</code>：要请求的<span><span class="heti-spacing"> </span>URL</span>（字符串<span class="heti-skip"><span class="heti-spacing"> </span>/URL<span class="heti-spacing"> </span></span>对象）</li>
<li><code>async</code><heti-adjacent class="heti-adjacent-half">：</heti-adjacent>（可选）如果值为 <code>false</code>，则变成同步请求（此时<span class="heti-skip"><span class="heti-spacing"> </span>JS<span class="heti-spacing"> </span></span>执行到 <code>send()</code> 处时会暂停，接收到响应后恢复执行，很少使用<heti-adjacent class="heti-adjacent-half">）</heti-adjacent>，否则是异步请求（默认）</li>
<li><code>user</code>，<code>password</code>：<span>HTTP<span class="heti-spacing"> </span></span>身份验证的登录名和密码<ul>
<li>发送请求
<div class="language-js highlight"><pre><span></span><code><span id="__span-49-1"><a href="#__codelineno-49-1" id="__codelineno-49-1" name="__codelineno-49-1"></a><span class="nx">xhr</span><span class="p">.</span><span class="nx">send</span><span class="p">([</span><span class="nx">body</span><span class="p">])</span>
</span><span id="__span-49-2"><a href="#__codelineno-49-2" id="__codelineno-49-2" name="__codelineno-49-2"></a><span class="c1">// 可选参数 body 包含了请求体</span>
</span></code></pre></div></li>
</ul>
</li>
</ul>
</li>
<li>
<p>监听 <code>xhr</code> 事件并获取响应，有以下常用事件：</p>
<ul>
<li><code>load</code>：请求完成（即使状态码为<span><span class="heti-spacing"> </span>400</span>、<span>500<span class="heti-spacing"> </span></span>之类的）且响应已完全下载</li>
<li><code>error</code>：无法发出请求（比如网络中断或访问无效的<span><span class="heti-spacing"> </span>URL</span>）</li>
<li><code>progress</code>：在下载响应期间定期触发，报告下载进度
<div class="language-js highlight"><pre><span></span><code><span id="__span-50-1"><a href="#__codelineno-50-1" id="__codelineno-50-1" name="__codelineno-50-1"></a><span class="nx">xhr</span><span class="p">.</span><span class="nx">onload</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-50-2"><a href="#__codelineno-50-2" id="__codelineno-50-2" name="__codelineno-50-2"></a><span class="w">    </span><span class="nx">alert</span><span class="p">(</span><span class="sb">`Loaded: </span><span class="si">${</span><span class="nx">xhr</span><span class="p">.</span><span class="nx">status</span><span class="si">}</span><span class="sb"> </span><span class="si">${</span><span class="nx">xhr</span><span class="p">.</span><span class="nx">response</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span><span id="__span-50-3"><a href="#__codelineno-50-3" id="__codelineno-50-3" name="__codelineno-50-3"></a><span class="p">};</span>
</span><span id="__span-50-4"><a href="#__codelineno-50-4" id="__codelineno-50-4" name="__codelineno-50-4"></a>
</span><span id="__span-50-5"><a href="#__codelineno-50-5" id="__codelineno-50-5" name="__codelineno-50-5"></a><span class="nx">xhr</span><span class="p">.</span><span class="nx">onerror</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// 仅在根本无法发出请求时触发</span>
</span><span id="__span-50-6"><a href="#__codelineno-50-6" id="__codelineno-50-6" name="__codelineno-50-6"></a><span class="w">    </span><span class="nx">alert</span><span class="p">(</span><span class="sb">`Network Error`</span><span class="p">);</span>
</span><span id="__span-50-7"><a href="#__codelineno-50-7" id="__codelineno-50-7" name="__codelineno-50-7"></a><span class="p">};</span>
</span><span id="__span-50-8"><a href="#__codelineno-50-8" id="__codelineno-50-8" name="__codelineno-50-8"></a>
</span><span id="__span-50-9"><a href="#__codelineno-50-9" id="__codelineno-50-9" name="__codelineno-50-9"></a><span class="nx">xhr</span><span class="p">.</span><span class="nx">onprogress</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// 定期触发</span>
</span><span id="__span-50-10"><a href="#__codelineno-50-10" id="__codelineno-50-10" name="__codelineno-50-10"></a><span class="w">    </span><span class="c1">// event.loaded —— 已经下载了多少字节</span>
</span><span id="__span-50-11"><a href="#__codelineno-50-11" id="__codelineno-50-11" name="__codelineno-50-11"></a><span class="w">    </span><span class="c1">// event.lengthComputable = true，当服务器发送了 Content-Length header 时</span>
</span><span id="__span-50-12"><a href="#__codelineno-50-12" id="__codelineno-50-12" name="__codelineno-50-12"></a><span class="w">    </span><span class="c1">// event.total —— 总字节数（如果 lengthComputable 为 true）</span>
</span><span id="__span-50-13"><a href="#__codelineno-50-13" id="__codelineno-50-13" name="__codelineno-50-13"></a><span class="w">    </span><span class="nx">alert</span><span class="p">(</span><span class="sb">`Received </span><span class="si">${</span><span class="nx">event</span><span class="p">.</span><span class="nx">loaded</span><span class="si">}</span><span class="sb"> of </span><span class="si">${</span><span class="nx">event</span><span class="p">.</span><span class="nx">total</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span><span id="__span-50-14"><a href="#__codelineno-50-14" id="__codelineno-50-14" name="__codelineno-50-14"></a><span class="p">};</span>
</span></code></pre></div></li>
</ul>
</li>
</ul>
<details class="example">
<summary>例子</summary>
<p>从服务器加载某个<span class="heti-skip"><span class="heti-spacing"> </span>URL<span class="heti-spacing"> </span></span>并打印加载进度</p>
<div class="language-js highlight"><pre><span></span><code><span id="__span-51-1"><a href="#__codelineno-51-1" id="__codelineno-51-1" name="__codelineno-51-1"></a><span class="c1">// 1. 创建一个 new XMLHttpRequest 对象</span>
</span><span id="__span-51-2"><a href="#__codelineno-51-2" id="__codelineno-51-2" name="__codelineno-51-2"></a><span class="kd">let</span><span class="w"> </span><span class="nx">xhr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">XMLHttpRequest</span><span class="p">();</span>
</span><span id="__span-51-3"><a href="#__codelineno-51-3" id="__codelineno-51-3" name="__codelineno-51-3"></a>
</span><span id="__span-51-4"><a href="#__codelineno-51-4" id="__codelineno-51-4" name="__codelineno-51-4"></a><span class="c1">// 2. 配置它：从 URL /article/.../load GET-request</span>
</span><span id="__span-51-5"><a href="#__codelineno-51-5" id="__codelineno-51-5" name="__codelineno-51-5"></a><span class="nx">xhr</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">'GET'</span><span class="p">,</span><span class="w"> </span><span class="s1">'/article/xmlhttprequest/example/load'</span><span class="p">);</span>
</span><span id="__span-51-6"><a href="#__codelineno-51-6" id="__codelineno-51-6" name="__codelineno-51-6"></a>
</span><span id="__span-51-7"><a href="#__codelineno-51-7" id="__codelineno-51-7" name="__codelineno-51-7"></a><span class="c1">// 3. 通过网络发送请求</span>
</span><span id="__span-51-8"><a href="#__codelineno-51-8" id="__codelineno-51-8" name="__codelineno-51-8"></a><span class="nx">xhr</span><span class="p">.</span><span class="nx">send</span><span class="p">();</span>
</span><span id="__span-51-9"><a href="#__codelineno-51-9" id="__codelineno-51-9" name="__codelineno-51-9"></a>
</span><span id="__span-51-10"><a href="#__codelineno-51-10" id="__codelineno-51-10" name="__codelineno-51-10"></a><span class="c1">// 4. 当接收到响应后，将调用此函数</span>
</span><span id="__span-51-11"><a href="#__codelineno-51-11" id="__codelineno-51-11" name="__codelineno-51-11"></a><span class="nx">xhr</span><span class="p">.</span><span class="nx">onload</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-51-12"><a href="#__codelineno-51-12" id="__codelineno-51-12" name="__codelineno-51-12"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">xhr</span><span class="p">.</span><span class="nx">status</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mf">200</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// 分析响应的 HTTP 状态</span>
</span><span id="__span-51-13"><a href="#__codelineno-51-13" id="__codelineno-51-13" name="__codelineno-51-13"></a><span class="w">        </span><span class="nx">alert</span><span class="p">(</span><span class="sb">`Error </span><span class="si">${</span><span class="nx">xhr</span><span class="p">.</span><span class="nx">status</span><span class="si">}</span><span class="sb">: </span><span class="si">${</span><span class="nx">xhr</span><span class="p">.</span><span class="nx">statusText</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span><span class="w"> </span><span class="c1">// 例如 404: Not Found</span>
</span><span id="__span-51-14"><a href="#__codelineno-51-14" id="__codelineno-51-14" name="__codelineno-51-14"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// 显示结果</span>
</span><span id="__span-51-15"><a href="#__codelineno-51-15" id="__codelineno-51-15" name="__codelineno-51-15"></a><span class="w">        </span><span class="nx">alert</span><span class="p">(</span><span class="sb">`Done, got </span><span class="si">${</span><span class="nx">xhr</span><span class="p">.</span><span class="nx">response</span><span class="p">.</span><span class="nx">length</span><span class="si">}</span><span class="sb"> bytes`</span><span class="p">);</span><span class="w"> </span><span class="c1">// response 是服务器响应</span>
</span><span id="__span-51-16"><a href="#__codelineno-51-16" id="__codelineno-51-16" name="__codelineno-51-16"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-51-17"><a href="#__codelineno-51-17" id="__codelineno-51-17" name="__codelineno-51-17"></a><span class="p">};</span>
</span><span id="__span-51-18"><a href="#__codelineno-51-18" id="__codelineno-51-18" name="__codelineno-51-18"></a>
</span><span id="__span-51-19"><a href="#__codelineno-51-19" id="__codelineno-51-19" name="__codelineno-51-19"></a><span class="nx">xhr</span><span class="p">.</span><span class="nx">onprogress</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-51-20"><a href="#__codelineno-51-20" id="__codelineno-51-20" name="__codelineno-51-20"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">lengthComputable</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-51-21"><a href="#__codelineno-51-21" id="__codelineno-51-21" name="__codelineno-51-21"></a><span class="w">    </span><span class="nx">alert</span><span class="p">(</span><span class="sb">`Received </span><span class="si">${</span><span class="nx">event</span><span class="p">.</span><span class="nx">loaded</span><span class="si">}</span><span class="sb"> of </span><span class="si">${</span><span class="nx">event</span><span class="p">.</span><span class="nx">total</span><span class="si">}</span><span class="sb"> bytes`</span><span class="p">);</span>
</span><span id="__span-51-22"><a href="#__codelineno-51-22" id="__codelineno-51-22" name="__codelineno-51-22"></a><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-51-23"><a href="#__codelineno-51-23" id="__codelineno-51-23" name="__codelineno-51-23"></a><span class="w">    </span><span class="nx">alert</span><span class="p">(</span><span class="sb">`Received </span><span class="si">${</span><span class="nx">event</span><span class="p">.</span><span class="nx">loaded</span><span class="si">}</span><span class="sb"> bytes`</span><span class="p">);</span><span class="w"> </span><span class="c1">// 没有 Content-Length</span>
</span><span id="__span-51-24"><a href="#__codelineno-51-24" id="__codelineno-51-24" name="__codelineno-51-24"></a><span class="p">}</span>
</span><span id="__span-51-25"><a href="#__codelineno-51-25" id="__codelineno-51-25" name="__codelineno-51-25"></a>
</span><span id="__span-51-26"><a href="#__codelineno-51-26" id="__codelineno-51-26" name="__codelineno-51-26"></a><span class="p">};</span>
</span><span id="__span-51-27"><a href="#__codelineno-51-27" id="__codelineno-51-27" name="__codelineno-51-27"></a>
</span><span id="__span-51-28"><a href="#__codelineno-51-28" id="__codelineno-51-28" name="__codelineno-51-28"></a><span class="nx">xhr</span><span class="p">.</span><span class="nx">onerror</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-51-29"><a href="#__codelineno-51-29" id="__codelineno-51-29" name="__codelineno-51-29"></a><span class="w">    </span><span class="nx">alert</span><span class="p">(</span><span class="s2">"Request failed"</span><span class="p">);</span>
</span><span id="__span-51-30"><a href="#__codelineno-51-30" id="__codelineno-51-30" name="__codelineno-51-30"></a><span class="p">};</span>
</span></code></pre></div>
</details>
<ul>
<li>相关属性</li>
<li><code>status</code>：<span>HTTP<span class="heti-spacing"> </span></span>状态码（数字<heti-adjacent class="heti-adjacent-half">）</heti-adjacent>，若出现非<span class="heti-skip"><span class="heti-spacing"> </span>HTTP<span class="heti-spacing"> </span></span>错误则为 <code>0</code></li>
<li><code>statusText</code>：<span>HTTP<span class="heti-spacing"> </span></span>状态消息（字符串<heti-adjacent class="heti-adjacent-half">）</heti-adjacent>（比如 <code>200</code> 对应为 <code>OK</code>，<code>404</code> 对应 <code>Not Found</code>、<code>403</code> 对应 <code>Forbidden</code>）</li>
<li><code>response</code>：服务器响应体</li>
<li><code>timeout</code>：指定最大超时时间，如果在给定时间内未执行成功，则取消请求并触发 <code>timeout</code> 事件</li>
<li>
<p><code>responseType</code>：设置响应格式</p>
<ul>
<li><code>""</code>（默认<heti-adjacent class="heti-adjacent-half">）</heti-adjacent>、<code>"text"</code>：字符串</li>
<li><code>"arraybuffer"</code>：<code>ArrayBuffer</code></li>
<li><code>"blob"</code>：<code>Blob</code></li>
<li><code>"document"</code>：<span>XML document<span class="heti-spacing"> </span></span>或<span><span class="heti-spacing"> </span>HTML document</span></li>
<li><code>"json"</code>：JSON</li>
</ul>
<details class="example">
<summary>例子</summary>
<div class="language-js highlight"><pre><span></span><code><span id="__span-52-1"><a href="#__codelineno-52-1" id="__codelineno-52-1" name="__codelineno-52-1"></a><span class="kd">let</span><span class="w"> </span><span class="nx">xhr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">XMLHttpRequest</span><span class="p">();</span>
</span><span id="__span-52-2"><a href="#__codelineno-52-2" id="__codelineno-52-2" name="__codelineno-52-2"></a>
</span><span id="__span-52-3"><a href="#__codelineno-52-3" id="__codelineno-52-3" name="__codelineno-52-3"></a><span class="nx">xhr</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">'GET'</span><span class="p">,</span><span class="w"> </span><span class="s1">'/article/xmlhttprequest/example/json'</span><span class="p">);</span>
</span><span id="__span-52-4"><a href="#__codelineno-52-4" id="__codelineno-52-4" name="__codelineno-52-4"></a>
</span><span id="__span-52-5"><a href="#__codelineno-52-5" id="__codelineno-52-5" name="__codelineno-52-5"></a><span class="nx">xhr</span><span class="p">.</span><span class="nx">responseType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'json'</span><span class="p">;</span>
</span><span id="__span-52-6"><a href="#__codelineno-52-6" id="__codelineno-52-6" name="__codelineno-52-6"></a>
</span><span id="__span-52-7"><a href="#__codelineno-52-7" id="__codelineno-52-7" name="__codelineno-52-7"></a><span class="nx">xhr</span><span class="p">.</span><span class="nx">send</span><span class="p">();</span>
</span><span id="__span-52-8"><a href="#__codelineno-52-8" id="__codelineno-52-8" name="__codelineno-52-8"></a>
</span><span id="__span-52-9"><a href="#__codelineno-52-9" id="__codelineno-52-9" name="__codelineno-52-9"></a><span class="c1">// 响应为 {"message": "Hello, world!"}</span>
</span><span id="__span-52-10"><a href="#__codelineno-52-10" id="__codelineno-52-10" name="__codelineno-52-10"></a><span class="nx">xhr</span><span class="p">.</span><span class="nx">onload</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-52-11"><a href="#__codelineno-52-11" id="__codelineno-52-11" name="__codelineno-52-11"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">responseObj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">xhr</span><span class="p">.</span><span class="nx">response</span><span class="p">;</span>
</span><span id="__span-52-12"><a href="#__codelineno-52-12" id="__codelineno-52-12" name="__codelineno-52-12"></a><span class="w">    </span><span class="nx">alert</span><span class="p">(</span><span class="nx">responseObj</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span><span class="w"> </span><span class="c1">// Hello, world!</span>
</span><span id="__span-52-13"><a href="#__codelineno-52-13" id="__codelineno-52-13" name="__codelineno-52-13"></a><span class="p">};</span>
</span></code></pre></div>
</details>
</li>
<li>
<p><code>readyState</code>：获取 <code>XMLHttpRequest</code> 的当前状态，有以下几种状态：
    </p><div class="language-js highlight"><pre><span></span><code><span id="__span-53-1"><a href="#__codelineno-53-1" id="__codelineno-53-1" name="__codelineno-53-1"></a><span class="nx">UNSENT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w">            </span><span class="c1">// 初始状态</span>
</span><span id="__span-53-2"><a href="#__codelineno-53-2" id="__codelineno-53-2" name="__codelineno-53-2"></a><span class="nx">OPENED</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1</span><span class="p">;</span><span class="w">            </span><span class="c1">// 调用 open()</span>
</span><span id="__span-53-3"><a href="#__codelineno-53-3" id="__codelineno-53-3" name="__codelineno-53-3"></a><span class="nx">HEADERS_RECEIVED</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">2</span><span class="p">;</span><span class="w">  </span><span class="c1">// 接收到响应头</span>
</span><span id="__span-53-4"><a href="#__codelineno-53-4" id="__codelineno-53-4" name="__codelineno-53-4"></a><span class="nx">LOADING</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">3</span><span class="p">;</span><span class="w">           </span><span class="c1">// 加载响应（接收数据包）</span>
</span><span id="__span-53-5"><a href="#__codelineno-53-5" id="__codelineno-53-5" name="__codelineno-53-5"></a><span class="nx">DONE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">4</span><span class="p">;</span><span class="w">              </span><span class="c1">// 请求完成</span>
</span><span id="__span-53-6"><a href="#__codelineno-53-6" id="__codelineno-53-6" name="__codelineno-53-6"></a><span class="c1">// 0 -&gt; 1 -&gt; 2 -&gt; 3 -&gt; ... -&gt; 3 -&gt; 4</span>
</span></code></pre></div>
<ul>
<li>可以使用 <code>readystatechange</code> 事件来跟踪状态：
<div class="language-js highlight"><pre><span></span><code><span id="__span-54-1"><a href="#__codelineno-54-1" id="__codelineno-54-1" name="__codelineno-54-1"></a><span class="nx">xhr</span><span class="p">.</span><span class="nx">onreadystatechange</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-54-2"><a href="#__codelineno-54-2" id="__codelineno-54-2" name="__codelineno-54-2"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">xhr</span><span class="p">.</span><span class="nx">readyState</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mf">3</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-54-3"><a href="#__codelineno-54-3" id="__codelineno-54-3" name="__codelineno-54-3"></a><span class="w">        </span><span class="c1">// 加载中</span>
</span><span id="__span-54-4"><a href="#__codelineno-54-4" id="__codelineno-54-4" name="__codelineno-54-4"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-54-5"><a href="#__codelineno-54-5" id="__codelineno-54-5" name="__codelineno-54-5"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">xhr</span><span class="p">.</span><span class="nx">readyState</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mf">4</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-54-6"><a href="#__codelineno-54-6" id="__codelineno-54-6" name="__codelineno-54-6"></a><span class="w">        </span><span class="c1">// 请求完成</span>
</span><span id="__span-54-7"><a href="#__codelineno-54-7" id="__codelineno-54-7" name="__codelineno-54-7"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-54-8"><a href="#__codelineno-54-8" id="__codelineno-54-8" name="__codelineno-54-8"></a><span class="p">};</span>
</span></code></pre></div></li>
</ul>
</li>
<li>
<p><code>upload</code>：跟踪数据上传进度，它会在上传时生成以下事件：</p>
<ul>
<li><code>loadstart</code>：上传开始</li>
<li><code>progress</code>：上传期间定期触发</li>
<li><code>abort</code>：上传中止</li>
<li><code>error</code>：非<span class="heti-skip"><span class="heti-spacing"> </span>HTTP<span class="heti-spacing"> </span></span>错误</li>
<li><code>load</code>：上传成功完成</li>
<li><code>timeout</code>：上传超时（若设置了 <code>timeout</code> 属性）</li>
<li><code>loadend</code>：上传完成（无论成功与否）</li>
</ul>
</li>
</ul>
<details class="example">
<summary>例子</summary>
</details>
<div class="language-html highlight"><pre><span></span><code><span id="__span-55-1"><a href="#__codelineno-55-1" id="__codelineno-55-1" name="__codelineno-55-1"></a><span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">"file"</span> <span class="na">onchange</span><span class="o">=</span><span class="s">"upload(this.files[0])"</span><span class="p">&gt;</span>
</span><span id="__span-55-2"><a href="#__codelineno-55-2" id="__codelineno-55-2" name="__codelineno-55-2"></a>
</span><span id="__span-55-3"><a href="#__codelineno-55-3" id="__codelineno-55-3" name="__codelineno-55-3"></a><span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
</span><span id="__span-55-4"><a href="#__codelineno-55-4" id="__codelineno-55-4" name="__codelineno-55-4"></a><span class="w">    </span><span class="kd">function</span><span class="w"> </span><span class="nx">upload</span><span class="p">(</span><span class="nx">file</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-55-5"><a href="#__codelineno-55-5" id="__codelineno-55-5" name="__codelineno-55-5"></a><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="nx">xhr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">XMLHttpRequest</span><span class="p">();</span>
</span><span id="__span-55-6"><a href="#__codelineno-55-6" id="__codelineno-55-6" name="__codelineno-55-6"></a>
</span><span id="__span-55-7"><a href="#__codelineno-55-7" id="__codelineno-55-7" name="__codelineno-55-7"></a><span class="w">        </span><span class="c1">// 跟踪上传进度</span>
</span><span id="__span-55-8"><a href="#__codelineno-55-8" id="__codelineno-55-8" name="__codelineno-55-8"></a><span class="w">        </span><span class="nx">xhr</span><span class="p">.</span><span class="nx">upload</span><span class="p">.</span><span class="nx">onprogress</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-55-9"><a href="#__codelineno-55-9" id="__codelineno-55-9" name="__codelineno-55-9"></a><span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`Uploaded </span><span class="si">${</span><span class="nx">event</span><span class="p">.</span><span class="nx">loaded</span><span class="si">}</span><span class="sb"> of </span><span class="si">${</span><span class="nx">event</span><span class="p">.</span><span class="nx">total</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span><span id="__span-55-10"><a href="#__codelineno-55-10" id="__codelineno-55-10" name="__codelineno-55-10"></a><span class="w">        </span><span class="p">};</span>
</span><span id="__span-55-11"><a href="#__codelineno-55-11" id="__codelineno-55-11" name="__codelineno-55-11"></a>
</span><span id="__span-55-12"><a href="#__codelineno-55-12" id="__codelineno-55-12" name="__codelineno-55-12"></a><span class="w">        </span><span class="c1">// 跟踪完成：无论成功与否</span>
</span><span id="__span-55-13"><a href="#__codelineno-55-13" id="__codelineno-55-13" name="__codelineno-55-13"></a><span class="w">        </span><span class="nx">xhr</span><span class="p">.</span><span class="nx">onloadend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-55-14"><a href="#__codelineno-55-14" id="__codelineno-55-14" name="__codelineno-55-14"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">xhr</span><span class="p">.</span><span class="nx">status</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mf">200</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-55-15"><a href="#__codelineno-55-15" id="__codelineno-55-15" name="__codelineno-55-15"></a><span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"success"</span><span class="p">);</span>
</span><span id="__span-55-16"><a href="#__codelineno-55-16" id="__codelineno-55-16" name="__codelineno-55-16"></a><span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-55-17"><a href="#__codelineno-55-17" id="__codelineno-55-17" name="__codelineno-55-17"></a><span class="w">            </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"error "</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">status</span><span class="p">);</span>
</span><span id="__span-55-18"><a href="#__codelineno-55-18" id="__codelineno-55-18" name="__codelineno-55-18"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-55-19"><a href="#__codelineno-55-19" id="__codelineno-55-19" name="__codelineno-55-19"></a><span class="w">        </span><span class="p">};</span>
</span><span id="__span-55-20"><a href="#__codelineno-55-20" id="__codelineno-55-20" name="__codelineno-55-20"></a>
</span><span id="__span-55-21"><a href="#__codelineno-55-21" id="__codelineno-55-21" name="__codelineno-55-21"></a><span class="w">        </span><span class="nx">xhr</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s2">"POST"</span><span class="p">,</span><span class="w"> </span><span class="s2">"/article/xmlhttprequest/post/upload"</span><span class="p">);</span>
</span><span id="__span-55-22"><a href="#__codelineno-55-22" id="__codelineno-55-22" name="__codelineno-55-22"></a><span class="w">        </span><span class="nx">xhr</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">file</span><span class="p">);</span>
</span><span id="__span-55-23"><a href="#__codelineno-55-23" id="__codelineno-55-23" name="__codelineno-55-23"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-55-24"><a href="#__codelineno-55-24" id="__codelineno-55-24" name="__codelineno-55-24"></a><span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span></code></pre></div>
<ul>
<li><code>withCredentials</code>：若值为 <code>true</code>，则将<span class="heti-skip"><span class="heti-spacing"> </span>cookie<span class="heti-spacing"> </span></span>和<span class="heti-skip"><span class="heti-spacing"> </span>HTTP<span class="heti-spacing"> </span></span>授权发送到其他域（默认禁止<heti-adjacent class="heti-adjacent-half">）</heti-adjacent>，实现跨源请求</li>
</ul>
</li>
<li>
<p>中止请求：<code>xhr.abort()</code>，触发 <code>abort</code> 事件，使 <code>xhr.status</code> 变为 <code>0</code></p>
</li>
<li>
<p>关于<span class="heti-skip"><span class="heti-spacing"> </span>HTTP<span class="heti-spacing"> </span></span>头的方法</p>
<ul>
<li>
<p><code>setRequestHeader(name, value)</code>：设置请求头的某个字段，比如：
    </p><div class="language-js highlight"><pre><span></span><code><span id="__span-56-1"><a href="#__codelineno-56-1" id="__codelineno-56-1" name="__codelineno-56-1"></a><span class="nx">xhr</span><span class="p">.</span><span class="nx">setRequestHeader</span><span class="p">(</span><span class="s1">'Content-Type'</span><span class="p">,</span><span class="w"> </span><span class="s1">'application/json'</span><span class="p">);</span>
</span></code></pre></div>
<ul>
<li>一旦用该方法设置字段，该字段便无法被撤销，也不能被覆写<ul>
<li><code>getResponseHeader(name)</code>：获取指定的头字段</li>
<li><code>getAllResponseHeaders</code>：获取所有响应头字段，返回形式如下，每行以 <code>"\r\n"</code> 结尾（不依赖于操作系统）
<div class="language-http highlight"><pre><span></span><code><span id="__span-57-1"><a href="#__codelineno-57-1" id="__codelineno-57-1" name="__codelineno-57-1"></a><span class="err">Cache-Control: max-age=31536000</span>
</span><span id="__span-57-2"><a href="#__codelineno-57-2" id="__codelineno-57-2" name="__codelineno-57-2"></a><span class="err">Content-Length: 4260</span>
</span><span id="__span-57-3"><a href="#__codelineno-57-3" id="__codelineno-57-3" name="__codelineno-57-3"></a><span class="err">Content-Type: image/png</span>
</span><span id="__span-57-4"><a href="#__codelineno-57-4" id="__codelineno-57-4" name="__codelineno-57-4"></a><span class="err">Date: Sat, 08 Sep 2012 16:53:16 GMT</span>
</span></code></pre></div></li>
</ul>
</li>
</ul>
</li>
</ul>
<blockquote>
<p>注：不包括 <code>Set-Cookie</code> 和 <code>Set-Cookie2</code> 头字段</p>
</blockquote>
</li>
<li>
<p>关于<span class="heti-skip"><span class="heti-spacing"> </span>POST<span class="heti-spacing"> </span></span>请求：创建<span class="heti-skip"><span class="heti-spacing"> </span>FormData<span class="heti-spacing"> </span></span>对象（前面介绍过<heti-adjacent class="heti-adjacent-half">）</heti-adjacent>，在 <code>xhr.open()</code> 中使用 <code>'POST'</code> 参数，并用 <code>xhr.send(formData)</code> 发送表单到服务器</p>
</li>
</ul>
<details class="example">
<summary>例子</summary>
<div class="language-html highlight"><pre><span></span><code><span id="__span-58-1"><a href="#__codelineno-58-1" id="__codelineno-58-1" name="__codelineno-58-1"></a><span class="p">&lt;</span><span class="nt">form</span> <span class="na">name</span><span class="o">=</span><span class="s">"person"</span><span class="p">&gt;</span>
</span><span id="__span-58-2"><a href="#__codelineno-58-2" id="__codelineno-58-2" name="__codelineno-58-2"></a>    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">name</span><span class="o">=</span><span class="s">"name"</span> <span class="na">value</span><span class="o">=</span><span class="s">"John"</span><span class="p">&gt;</span>
</span><span id="__span-58-3"><a href="#__codelineno-58-3" id="__codelineno-58-3" name="__codelineno-58-3"></a>    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">name</span><span class="o">=</span><span class="s">"surname"</span> <span class="na">value</span><span class="o">=</span><span class="s">"Smith"</span><span class="p">&gt;</span>
</span><span id="__span-58-4"><a href="#__codelineno-58-4" id="__codelineno-58-4" name="__codelineno-58-4"></a><span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
</span><span id="__span-58-5"><a href="#__codelineno-58-5" id="__codelineno-58-5" name="__codelineno-58-5"></a>
</span><span id="__span-58-6"><a href="#__codelineno-58-6" id="__codelineno-58-6" name="__codelineno-58-6"></a><span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
</span><span id="__span-58-7"><a href="#__codelineno-58-7" id="__codelineno-58-7" name="__codelineno-58-7"></a><span class="w">    </span><span class="c1">// 从表单预填充 FormData</span>
</span><span id="__span-58-8"><a href="#__codelineno-58-8" id="__codelineno-58-8" name="__codelineno-58-8"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">formData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">FormData</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">forms</span><span class="p">.</span><span class="nx">person</span><span class="p">);</span>
</span><span id="__span-58-9"><a href="#__codelineno-58-9" id="__codelineno-58-9" name="__codelineno-58-9"></a>
</span><span id="__span-58-10"><a href="#__codelineno-58-10" id="__codelineno-58-10" name="__codelineno-58-10"></a><span class="w">    </span><span class="c1">// 附加一个字段</span>
</span><span id="__span-58-11"><a href="#__codelineno-58-11" id="__codelineno-58-11" name="__codelineno-58-11"></a><span class="w">    </span><span class="nx">formData</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">"middle"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Lee"</span><span class="p">);</span>
</span><span id="__span-58-12"><a href="#__codelineno-58-12" id="__codelineno-58-12" name="__codelineno-58-12"></a>
</span><span id="__span-58-13"><a href="#__codelineno-58-13" id="__codelineno-58-13" name="__codelineno-58-13"></a><span class="w">    </span><span class="c1">// 将其发送出去</span>
</span><span id="__span-58-14"><a href="#__codelineno-58-14" id="__codelineno-58-14" name="__codelineno-58-14"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">xhr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">XMLHttpRequest</span><span class="p">();</span>
</span><span id="__span-58-15"><a href="#__codelineno-58-15" id="__codelineno-58-15" name="__codelineno-58-15"></a><span class="w">    </span><span class="nx">xhr</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s2">"POST"</span><span class="p">,</span><span class="w"> </span><span class="s2">"/article/xmlhttprequest/post/user"</span><span class="p">);</span>
</span><span id="__span-58-16"><a href="#__codelineno-58-16" id="__codelineno-58-16" name="__codelineno-58-16"></a><span class="w">    </span><span class="nx">xhr</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">formData</span><span class="p">);</span>
</span><span id="__span-58-17"><a href="#__codelineno-58-17" id="__codelineno-58-17" name="__codelineno-58-17"></a>
</span><span id="__span-58-18"><a href="#__codelineno-58-18" id="__codelineno-58-18" name="__codelineno-58-18"></a><span class="w">    </span><span class="nx">xhr</span><span class="p">.</span><span class="nx">onload</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">alert</span><span class="p">(</span><span class="nx">xhr</span><span class="p">.</span><span class="nx">response</span><span class="p">);</span>
</span><span id="__span-58-19"><a href="#__codelineno-58-19" id="__codelineno-58-19" name="__codelineno-58-19"></a><span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span></code></pre></div>
</details>
<aside class="md-source-file">
<span class="md-source-file__fact">
<span class="md-icon" title="最后更新">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"></path></svg>
</span>
<span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-datetime">2024年10月7日 21:20:16</span>
</span>
<span class="md-source-file__fact">
<span class="md-icon" title="创建日期">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M14.47 15.08 11 13V7h1.5v5.25l3.08 1.83c-.41.28-.79.62-1.11 1m-1.39 4.84c-.36.05-.71.08-1.08.08-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8c0 .37-.03.72-.08 1.08.69.1 1.33.32 1.92.64.1-.56.16-1.13.16-1.72 0-5.5-4.5-10-10-10S2 6.5 2 12s4.47 10 10 10c.59 0 1.16-.06 1.72-.16-.32-.59-.54-1.23-.64-1.92M18 15v3h-3v2h3v3h2v-3h3v-2h-3v-3z"></path></svg>
</span>
<span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-datetime">2024年9月4日 20:57:05</span>
</span>
</aside>
<p style="font-size: 30px; font-weight: 600">评论区</p>
<div>
    如果大家有什么问题或想法，欢迎在下方留言~
  </div>
<!-- Insert generated snippet here -->
<script async="" crossorigin="anonymous" data-category="Announcements" data-category-id="DIC_kwDOMAb9Zs4CfmpP" data-emit-metadata="0" data-input-position="bottom" data-lang="zh-CN" data-mapping="pathname" data-reactions-enabled="1" data-repo="noughtq/notebook" data-repo-id="R_kgDOMAb9Zg" data-strict="0" data-theme="preferred_color_scheme" src="https://giscus.app/client.js">
</script>
<!-- Synchronize Giscus theme with palette -->
<script>
    var giscus = document.querySelector("script[src*=giscus]")

    // Set palette on initial load
    var palette = __md_get("__palette")
    if (palette && typeof palette.color === "object") {
      var theme = palette.color.scheme === "slate"
        ? "transparent_dark"
        : "light"

      // Instruct Giscus to set theme
      giscus.setAttribute("data-theme", theme) 
    }

    // Register event handlers after documented loaded
    document.addEventListener("DOMContentLoaded", function() {
      var ref = document.querySelector("[data-md-component=palette]")
      ref.addEventListener("change", function() {
        var palette = __md_get("__palette")
        if (palette && typeof palette.color === "object") {
          var theme = palette.color.scheme === "slate"
            ? "dark"
            : "light"

          // Instruct Giscus to change theme
          var frame = document.querySelector(".giscus-frame")
          frame.contentWindow.postMessage(
            { giscus: { setConfig: { theme } } },
            "https://giscus.app"
          )
        }
      })
    })
  </script>
<link href="/stylesheet/counter.css" rel="stylesheet"/>
</article>
</div>
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
</div>
<button class="md-top md-icon" data-md-component="top" hidden="" type="button">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"></path></svg>
  回到页面顶部
</button>
</main>
<footer class="md-footer">
<nav aria-label="页脚" class="md-footer__inner md-grid">
<a aria-label="上一页: JavaScript 基础部分" class="md-footer__link md-footer__link--prev" href="basic.html">
<div class="md-footer__button md-icon">
<svg viewbox="0 0 320 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256l137.3-137.4c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"></path></svg>
</div>
<div class="md-footer__title">
<span class="md-footer__direction">
                上一页
              </span>
<div class="md-ellipsis">
                JavaScript 基础部分
              </div>
</div>
</a>
<a aria-label="下一页: Vue.js" class="md-footer__link md-footer__link--next" href="../vue/index.html">
<div class="md-footer__title">
<span class="md-footer__direction">
                下一页
              </span>
<div class="md-ellipsis">
                Vue.js
              </div>
</div>
<div class="md-footer__button md-icon">
<svg viewbox="0 0 320 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M278.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L210.7 256 73.4 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z"></path></svg>
</div>
</a>
</nav>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
<div class="md-copyright__highlight">
      Copyright © 2024 <a href="https://github.com/NoughtQ">NoughtQ</a>
</div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
<div class="md-social">
<a class="md-social__link" href="https://github.com/noughtq" rel="noopener" target="_blank" title="github.com">
<svg viewbox="0 0 496 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"></path></svg>
</a>
<a class="md-social__link" href="https://blog.noughtq.top" rel="noopener" target="_blank" title="blog.noughtq.top">
<svg viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M192 32c0 17.7 14.3 32 32 32 123.7 0 224 100.3 224 224 0 17.7 14.3 32 32 32s32-14.3 32-32C512 128.9 383.1 0 224 0c-17.7 0-32 14.3-32 32m0 96c0 17.7 14.3 32 32 32 70.7 0 128 57.3 128 128 0 17.7 14.3 32 32 32s32-14.3 32-32c0-106-86-192-192-192-17.7 0-32 14.3-32 32m-96 16c0-26.5-21.5-48-48-48S0 117.5 0 144v224c0 79.5 64.5 144 144 144s144-64.5 144-144-64.5-144-144-144h-16v96h16c26.5 0 48 21.5 48 48s-21.5 48-48 48-48-21.5-48-48z"></path></svg>
</a>
<a class="md-social__link" href="mailto:noughtq666@gmail.com" rel="noopener" target="_blank" title="">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="m20 8-8 5-8-5V6l8 5 8-5m0-2H4c-1.11 0-2 .89-2 2v12a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2"></path></svg>
</a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "../../..", "features": ["content.code.copy", "content.code.annotate", "header.autohide", "navigation.tabs", "navigation.top", "navigation.footer", "navigation.indexes", "navigation.tracking", "navigation.prune", "search.share"], "search": "../../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}}</script>
<script src="../../../assets/javascripts/bundle.83f73b43.min.js"></script>
<script src="../../../js/katex.js"></script>
<script src="../../../js/toc.js"></script>
<script src="../../../js/anchor.js"></script>
<script src="https://unpkg.com/katex@0/dist/katex.min.js"></script>
<script src="https://unpkg.com/katex@0/dist/contrib/auto-render.min.js"></script>
</body>
</html>