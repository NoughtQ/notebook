---
counter: true
---

# Lec 4: 合作博弈与数据估值

## 从非合作博弈到合作博弈

### 分摊美元博弈

???+ example "例子"

    === "例1"

        有两个参与者，每个人都可以在 0 到 100 美元之间提出他所需要的某个钱数．如果两个人提出的钱数之和不超过 100 美元，那么他们将按照他们提出的钱数来分配这 100 美元．如果他们提出的钱数之和超过 100 美元，那么他们都只能得到 0 美元。

        ??? tip "某个方案"

            (50, 50)

            - 公平(equity)：两个人得到了相同的钱数
            - 效率(efficiency)：两个人将 100 全部分完

    === "例2"

        现在考虑更复杂的情况，一个三人参与的博弈，每个人都提出一个三个参与人的收益配置（而非之前的例子中每个人只提出自己的钱数），并且三个人的收益之和不能超过 300 美元．

        考虑以下两种情况：
        
        - 除非三个人提出相同的配置方案，此时他们将按照他们提出的配置方案来分配，否则他们都得到 0 美元：<span class="heimu">(100, 100, 100)</span>
        - 除非参与人 1 和 2 提出相同的配置方案，此时他们将按照他们提出的配置方案来分配，否则他们都得到 0 美元：<span class="heimu">(150, 150, 0)</span>

    === "例3"

        考虑一个三个人参与的博弈，每个人都提出一个**三个参与人的收益配置**，并且三个人的收益之和不能超过 300 美元．如果有任意两个参与者提出相同的配置方案，就按照他们提出的配置方案来分配，否则全体得到 0 美元。

        - 如果参与人 1 和 2 进行有效谈判，他们应当提出 (150, 150, 0)
        - 这时 3 可能和 2 妥协，提出 (0, 225, 75) 请求 2 的同意以得到更多的收益
        - 然而此时 1 可能和 3 妥协，提出 (113, 0, 187)
        
        **公平、有效率的合作博弈解**


### 合作博弈

!!! definition "定义（合作博弈）"

    一个具有**可转移效用**(transferable utility)的合作博弈（或称为 TU 博弈）是一个满足如下条件的二元组 $(N; v)$：
    
    - $N = \{1, 2, \dots, n\}$ 是一个有限的参与者集合；一个 $N$ 的子集被称为一个**联盟**(coalition)，全体联盟构成的集合记为 $2^N$
    - $v : 2^N \rightarrow R$ 称为该博弈的**特征函数**(characteristic function)，对于任意的 $S \subseteq N$，$v(S)$ 表示联盟 $S$ 的价值(worth)，且满足 $v(\emptyset) = 0$

???+ example "例子"

    考虑一个场景，假设有三个人 A，B，C，他们的特点分别如下：

    - A 擅长于发明专利，依靠这一才能年收入达 17 万美元
    - B 有机敏的商业嗅觉，能准确发掘潜在市场，创建商业咨询公司年收入可达 15 万美元
    - C 擅长市场营销，开办专门的销售公司年收入可达 18 万美元
    
    显然，三个人的才能互补，于是他们考虑合作：B 可以为 A 提供市场资讯，将 A 的发明专利卖给市场上最有需求的人，这样他们合作每年收入可达 35 万美元；C 利用他的才能销售 A 的发明专利，合作年收入可达 38 万美元；当然 B 和 C 也可以合作组建一个提供市场咨询和销售一体化的公司，这样每年合作收入可达 36 万美元；最后 A，B，C 如果共同合作，A 在 B 的建议下发明最符合市场需求的专利，然后由 C 进行销售，这样他们合作每年收入可达 56 万美元。

    现在可以用定义形式化这一博弈，不难得到 $N = \{A, B, C\}$，全体联盟构成的集合

    $$
    2^N = \{\emptyset, \{A\}, \{B\}, \{C\}, \{A, B\}, \{B, C\}, \{A, C\}, \{A, B, C\} \}
    $$

    则该场景可以表示为一个合作博弈 $(N; v)$，其中特征函数 $v$ 定义如下：

    $$
    v(S) = \begin{cases}0 & S = \emptyset \\ 17 & S = \{A\} \\ 15 & S = \{B\} \\ 18 & S = \{C\} \\ 35 & S = \{A, B\} \\ 36 & S = \{B, C\} \\ 38 & S = \{A, C\} \\ 56 & S = \{A, B, C\}\end{cases}
    $$

    通过确定参与者以及特征函数构成的二元组，我们的确可以形式化地完整描述前面例子的所有信息。

!!! definition "定义"

    一个合作博弈 $(N; v)$（其中 $N= {1, 2, \dots, n}$）的解概念是一个函数 $\varphi$，它将每个博弈 $(N; v)$ 与一个 $\mathbb{R}^n$ 的子集 $\varphi(N; v)$ 联系起来．如果对于任意的博弈 $\varphi(N; v)$ 都是一个单点集，则称这一解概念为**单点解**(point solution)。

更通俗地说，合作博弈的解概念就是一个将每个博弈都映射到一个可行的收入分配集合的函数，这个集合中的每个元素是一个分配向量 $(x_1, x_2, \dots, x_n)$，其中 $x_i$ 表示参与者 $i$ 在当前分配下可以获得的收入。

???+ example "例子"

    设 $(N; v)$ 是一个三人参与的合作博弈，其中 $N = \{1, 2, 3\}$，特征函数 $v$ 定义如下：

    $$
    v(\emptyset) = v(\{1\}) = v(\{2\}) = v(\{3\}) = 0, \\
    v(\{1, 2\}) = v(\{1, 3\}) = v(\{2, 3\}) = v(\{1, 2, 3\}) = 1
    $$

    这是三人分 300 元的最后一个例子的形式化版本．现在讨论这一博弈的可行解概念，可以从两个不同的角度来考虑这一问题：

    - 如果你是参与者，你会认为两两组成联盟是最好的，结合对称性，你会认为这一博弈的解概念是 $\varphi(N; v) = \Big\{ \Big(\dfrac{1}{2}, \dfrac{1}{2}, 0\Big), \Big(\dfrac{1}{2}, 0, \dfrac{1}{2}\Big), \Big(0, \dfrac{1}{2}, \dfrac{1}{2} \Big) \Big\}$，即你心中的解概念是一个三个元素的集合
    - 如果你是局外人，你认为三个参与人是“对称的”，因此这一博弈的解概念应当是 $\varphi(N; v) = \Big\{ \Big(\dfrac{1}{3}, \dfrac{1}{3}, \dfrac{1}{3}\Big) \Big\}$，只有一个向量组成


## 核

!!! definition "定义（核）"

    一个合作博弈 $(N; v)$（其中 $N= {1, 2, \dots, n}$）的**核**(core)是一个解概念 $\varphi$，其中 $\varphi(N; v)$ 由满足以下两个条件的分配向量 $x = (x_1, x_2, \dots, x_n)$ 组成：

    - **有效率的**(efficient)：$\sum\limits_{i=1}^n x_i = v(N)$，即所有参与者分完了整个联盟的全部收入
    - **联盟理性**(coalitionally rational)：对于任意的 $S \subseteq N$，有 $x_i \ge v(S)$，即对于任何联盟而言，他们在大联盟中分配到的收入一定不会比离开大联盟组成小联盟获得的收入少

???+ example "例子"

    === "例1"

        === "题目"

            求下列三个参与人的合作博弈的核，其中 $N = \{1, 2, 3\}$，特征函数 $v$ 的定义如下：

            $$
            v(\emptyset) = v(\{1\}) = v(\{2\}) = v(\{3\}) = 0, \\
            v(\{1, 2\}) = v(\{2, 3\}) = 1, v(\{1, 3\}) = 2, v(\{1, 2, 3\}) = 3
            $$

        === "解答"

            直接设出在核中的向量 $x = (x_1, x_2, x_3)$，并根据核的定义，这一向量应当满足有效率的：

            $$
            x_1 + x_2 + x_3 = v(\{1, 2, 3\}) = 3
            $$

            以及联盟理性，即：

            $$
            x_1 + x_2 \ge v(\{1, 2\}) = 1, x_2 + x_3 \ge v(\{2, 3\}) = 1, x_1 + x_3 \ge v(\{1, 3\}) = 2, \\
            x_1 \ge v(\{1\}) = 0, x_2 \ge v(\{2\}) = 0, x_3 \ge v(\{3\}) = 0
            $$      

            接下来的关键问题在于如何求出符合上述等式与不等式的所有向量．事实上，有效率性已经将 $x$ 限制到 $\mathbb{R}^3$ 中的一个平面，然后我们只需将这些不等式约束在这一平面上处理即可。

            <div style="text-align: center">
                <img src="images/lec4/1.png" width="50%">
            </div>

    === "例2"

        考虑三个参与人的合作博弈，$N = \{1, 2, 3\}$，特征函数 $v$ 定义如下：

        $$
        v(\emptyset) = v(\{1\}) = v(\{2\}) = v(\{3\}) = 0, \\
        v(\{1, 2\}) = v(\{1, 3\}) = v(\{2, 3\}) = v(\{1, 2, 3\}) = 1
        $$

        设核中向量为 $x = (x_1, x_2, x_3)$，基于下面这一简单的观察发现核为空集：

        - 根据有效率的，我们有：
            $$
            x_1 + x_2 + x_3 = v(\{1, 2, 3\}) = 1
            $$

        - 但根据联盟理性，由于 $v(\{1, 2\}) = v(\{1, 3\}) = v(\{2, 3\}) = 1$，因此 $x_1 + x_2 \ge 1, x_2 + x_3 \ge 1, x_1 + x_3 \ge 1$，于是我们有：
            $$
            2x_1 + 2x_2 + 2x_3 \ge 3
            $$

        显然这两个不等式是矛盾的，因此这一博弈的核为空集。

    
### 沙普利值的性质

为了定义出沙普利值，我们首先需要写出沙普利值应当满足的效率和公平性质，然后给出定义并证明其唯一性．为了便于形式化地描述下面的沙普利性质，首先给出如下记号上的定义：

!!! definition "定义"

    令 $\varphi$ 为一个单点解，即对于任意的合作博弈 $(N; v)$（其中 $N= {1, 2, \dots, n}$），$\varphi (N; v)$ 都是一个单点集，也就是唯一一个 $\mathbb{R}^n$ 中的向量．我们定义 $\varphi_i(N; v)$ 为向量 $\varphi(N; v)$ 中的第 $i$ 个位置的元素，即 $\varphi_i(N; v)$ 表示参与者 $i$ 在博弈 $(N; v)$ 中的分配到的收入。

!!! definition "定义（有效率的）"

    一个解概念 $\varphi$ 是**有效率的**(fficiency)，若对于任意的合作博弈 $(N; v)$（其中 $N = \{ 1, 2, \dots , n\}$），有 $\sum\limits_{i=1}^n \varphi_i (N; v) = v(N)$。

即所有参与者分完了整个联盟的全部收入，事实上这与核的要求一致，这一条件是理性参与者一定会希望满足的。

第二个性质是对称性，这一性质是公平性的关键．为了定义对称性，需要首先定义两个参与人什么时候是对称的：

!!! definition "定义（参与人的对称性）"

    令 $(N; v)$ 是一个合作博弈，对于 $i, j \in N$，如果对于任意的 $S \subseteq N - {i, j}$，有 $v(S \cup \{i\}) = v(S \cup \{j\})$，则称参与者 $i$ 和 $j$ 是对称的。

用通俗的话说，两个参与人是对称的即对于任何不包含他们的联盟，二者分别加入这一联盟后，联盟增加的效用（或称**边际贡献**(marginal contribution)）是一致的，因为对称性的定义等价于 $v(S \cup \{i\})− v(S) = v(S \cup \{j\})− v(S)$。

!!! definition "定义（解概念的对称性）"

    一个解概念 $\varphi$ 是满足**对称性**(symmetry)的，若对于任意的合作博弈 $(N; v)$，如果 $i, j \in N$ 是对称的，则 $\varphi_i(N; v) = \varphi_j(N; j)$。

!!! definition "定义（零参与者）"

    一个解概念 $\varphi$ 是符合**零参与者**(null player)性质的，若对于任意的合作博弈 $(N; v)$，如果 $i \in N$，且对于任意的 $S \subseteq N - \{i\}$，有

    $$
    v(S \cup \{i\}) = v(S)
    $$
    
    则 $\varphi_i(N; v) = 0$。

零参与者性质表明，如果一个参与人对于任何联盟的加入都不会增加联盟的效用，即他的边际贡献永远为0，那么他获得的收入应当为0。


### 沙普利值的定义

???+ info "沙普利值定义尝试"

    考虑合作博弈 $(N; v)$，其中 $N= {1, 2, \dots, n}$，我们定义解概念 $\varphi$ 为

    $$
    \varphi_i(N; v) = v(\{1, 2, \dots, i\})− v(\{1, 2, \dots, i− 1\}), \forall i \in N
    $$

    习题中要求读者证明这一解概念满足有效率性、零参与者和加性．然而这一解概念不满足对称性，例如考虑 $N = \{1, 2, 3\}$，特征函数 $v$ 定义如下：
    
    $$
    v(\emptyset) = v(\{1\}) = v(\{2\}) = v(\{3\}) = v(\{1, 2\}) = v(\{1, 3\}) = 0, \\
    v(\{2, 3\}) = v(\{1, 2, 3\}) = 1
    $$

    不难解得这一解概念下的分配向量为 $\{(0, 0, 1)\}$，但是我们很容易发现参与人 2 和 3 在这一博弈中是对称的，但是 $\varphi_2(N; v) = 0 \ne 1 = \varphi_3(N; v)$。

上面的定义能满足除了对称性以外的所有性质，这时我们心里应当有一个强烈的声音告诉我们，这里的不对称性来源于强制给定了这 $n$ 个参与人的排序，而不同的排序可能会带来不同的分配结果，因此自然的想法是：为什么不尝试把所有的排序对应的结果取平均呢？记这 $n$ 个参与人的全体排序构成的集合为 $S_n$，根据简单的组合知识可知这一集合中含有 $|S_n|= n!$ 个元素．对于任意排序 $\sigma \in S_n$，定义：

$$
P_i(\sigma) := \{j \in N | \sigma(j) < \sigma(i)\}
$$

即在排序 $\sigma$ 下位于参与人 $i$ 前面的所有参与人的集合．例如若在排序 $\sigma$ 下参与人 $i$ 排在了第一位，那么 $P_i(sigma) = \emptyset$。

!!! definition "定义"

    令 $(N; v)$ 是一个合作博弈，其中 $N = \{1, 2, \dots, n}$，参与人 $i$ 的沙普利值定义为：

    $$
    SV_i(N; v) = \dfrac{1}{n!} \sum\limits_{\sigma \in S_n} v(P_i(\sigma) \cup \{i\}) - v(P_i(\sigma))
    $$

即我们将所有排序下前面失败的定义取了平均。

前面的定义基于对不同排列的边际贡献加权平均，我们可以重新整理这一定义，得到基于对不同联盟的边际贡献的加权平均定义的沙普利值等价定义。假设 $i \in N$ 是一个参与者，$S$ 是某个不包含 $i$ 的联盟，考虑有多少种排序 $\sigma$ 恰好可以使得排在 $i$ 的前面就是 $S$，即 $P_i(\sigma) = S$。相当于将 $n$ 个参与者分成了三个部分，最前面是 $S$，中间是 $i$，最后是 $N - (S \cup \{i\})$。这三个部分的参与者的相对顺序是确定的，而这三个部分内的参与者的相对顺序又是可以任意排列的，因此这一情况下的排序数目为 $|S|!(n − |S| − 1)!$。因此这 $|S|!(n − |S| − 1)!$ 个排列下 $P_i(\sigma) = S$，基于此我们可以将上面式子中所有排列按 $P_i(\sigma)$ 对应的联盟组合起来，得到沙普利值的等价定义：

!!! definition "定义"

    合作博弈 $(N; v), N = \{1, 2, \dots, n}$，则参与人 $i$ 的沙普利值定义为：

    $$
    SV_i(N; v) = \dfrac{1}{n!} \sum\limits_{S \subseteq N - \{i\}} |S|!(n − |S| − 1)! (v(S \cup \{i\}) - v(S))
    $$

??? example "例子"




## 数据估值

## 沙普利值计算

### 沙普利值近似的高效采样方法

### 动态沙普利值计算

### P-Shapley：沙普利值在概率分类器上的应用