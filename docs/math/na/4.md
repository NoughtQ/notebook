---
counter: true
---

# Chap 4: Numerical Differentiation and Integration

## Numerical Differentiation

ç›®æ ‡ï¼šå¯¹äºç»™å®šçš„ $x_0$ï¼Œè¿‘ä¼¼è®¡ç®— $f'(x_0)$ï¼ˆå³**æ•°å€¼å¾®åˆ†**(numerical differentiation)ï¼‰

å¾®åˆ†è®¡ç®—å…¬å¼ï¼š$f'(x_0) = \lim\limits_{h \rightarrow 0} \dfrac{f(x_0 + h) - f(x_0)}{h}$


![](images/C4/1.png){ width=25% align=right }
![](images/C4/2.png){ width=25% align=right }

- åå‘ï¼š$f'(x_0) \approx \dfrac{f(x_0 + h) - f(x_0)}{h}$
- å‰å‘ï¼š$f'(x_0) \approx \dfrac{f(x_0) - f(x_0 - h)}{h}$

<br/>
<br/>
<br/>

ç°åœ¨æˆ‘ä»¬ç”¨ $f(x)$ çš„å¸¦æœ‰æ’å€¼ç‚¹ $x_0, x_0 + h$ çš„æ‹‰æ ¼æœ—æ—¥å¤šé¡¹å¼æ¥è¿‘ä¼¼è¡¨ç¤º $f(x)$ï¼š

$$
\begin{align}
f(x) & = \dfrac{f(x_0)(x - x_0 - h)}{x_0 - x_0 - h} + \dfrac{f(x_0 + h)(x - x_0)}{x_0 + h - x_0} \notag \\
& + \dfrac{(x - x_0)(x - x_0 - h)}{2} f''(\xi_x) \notag \\
f'(x) & = \dfrac{f(x_0 + h) - f(x_0)}{h} + \dfrac{2(x - x_0) - h}{2} f''(\xi_x) \notag \\
& + \dfrac{(x - x_0)(x - x_0 - h)}{2} \cdot \dfrac{d}{dx} [f''(\xi_x)] \notag
\end{align}
$$

å› æ­¤ $f'(x_0) = \dfrac{f(x_0 + h) - f(x_0)}{h} - \dfrac{h}{2}f''(\xi)$

---
æ¥ä¸‹æ¥ç”¨æ’å€¼ç‚¹ä¸º $\{x_0, x_1, \dots, x_n\}$ çš„æ‹‰æ ¼æœ—æ—¥å¤šé¡¹å¼æ¥è¿‘ä¼¼è¡¨ç¤º $f(x)$

$$
\begin{align}
f(x) & = \sum\limits_{k=0}^n f(x_k) L_k(x) + \dfrac{(x - x_0) \dots (x - x_n)}{(n+1)!} f^{(n+1)}(\xi_x) \notag \\
f'(x_j) & = \sum\limits_{k=0}^n f(x_k)L_k'(x_j) + \dfrac{f^{(n+1)}(\xi_j)}{(n+1)!} \prod\limits_{\substack{k = 0 \\ k \ne j}}^n (x_j - x_k) \notag
\end{align}
$$

!!! note "æ³¨"

    - ä¸€èˆ¬æ¥è¯´ï¼Œæ›´å¤šçš„è¯„ä¼°ç‚¹ï¼ˆå³è¿™é‡Œçš„æ’å€¼ç‚¹ï¼‰ä¼šå¸¦æ¥æ›´å¤§çš„è¿‘ä¼¼ç²¾åº¦
    - ä½†å¦ä¸€æ–¹é¢ï¼Œéšç€è¯„ä¼°ç‚¹çš„å¢åŠ ï¼Œèˆå…¥è¯¯å·®ä¹Ÿåœ¨å˜å¤§ï¼Œå› æ­¤æ•°å€¼å¾®åˆ†æ˜¯**ä¸ç¨³å®šçš„**ï¼

??? example "ä¾‹å­"

    === "ä¾‹1"

        === "é¢˜ç›®"

            ç»™å®šä¸‰ä¸ªç‚¹ $x_0, x_0 + h, x_0 + 2h$ï¼Œè¯·æ±‚å¾—å…³äºæ¯ä¸ªç‚¹çš„ä¸‰ç‚¹å…¬å¼ï¼Œç„¶åé€‰å‡ºå¯¹äº $f'(x)$ è€Œè¨€æœ€ä½³çš„ä¸‰ç‚¹å…¬å¼ã€‚

        === "è§£ç­”"

            $$
            \begin{align}
            f'(x_0) & = \dfrac{1}{h}\Big[-\dfrac{3}{2} f(x_0) + 2f(x_0 + h) - \dfrac{1}{2}f(x_0 + 2h) \Big] + \dfrac{h^2}{3} f^{(3)}(\xi_0) \notag \\
            f'(x_0 + h) & = \dfrac{1}{h} \Big[ -\dfrac{1}{2} f(x_0) + \dfrac{1}{2} f(x_0 + 2h) \Big] - \dfrac{h^2}{6} f^{(3)}(\xi_1) \notag \\
            \Rightarrow f'(x_0) & = \dfrac{1}{2h} \Big[f(x_0 + h) - f(x_0 - h) \Big] - \dfrac{h^2}{6} f^{(3)} (\xi_1) \notag 
            \end{align}
            $$

            <div style="text-align: center">
                <img src="images/C4/3.png" width=30%/>
            </div>

    === "ä¾‹2"

        === "é¢˜ç›®"

            å¯»æ‰¾è¿‘ä¼¼è®¡ç®— $f''(x_0)$ çš„æ–¹å¼ã€‚

        === "è§£ç­”"

            è€ƒè™‘åœ¨ $x_0$ å¤„çš„ $f(x_0 + h), f(x_0 - h)$ çš„æ³°å‹’å±•å¼€å¼ï¼š

            $$
            \begin{align}
            f(x_0 + h) & = f(x_0) + f'(x_0) h + \dfrac{1}{2}f''(x_0)h^2 + \dfrac{1}{6} f'''(x_0) h^3 + \dfrac{1}{24} f^{(4)} (\xi_1) h^4 \notag \\
            f(x_0 - h) & = f(x_0) - f'(x_0) h + \dfrac{1}{2}f''(x_0)h^2 - \dfrac{1}{6} f'''(x_0) h^3 + \dfrac{1}{24} f^{(4)} (\xi_{-1}) h^4 \notag
            \end{align}
            $$

            å› æ­¤ï¼š$f''(x_0) = \dfrac{1}{h^2} [f(x_0 - h) - 2f(x_0) + f(x_0 + h)] - \dfrac{h^2}{12} f^{(4)} (\xi)$


## Elements of Numerical Integration

ç›®æ ‡ï¼šè¿‘ä¼¼è®¡ç®— $I = \int_a^b f(x) dx$ï¼ˆå³**æ•°å€¼æ±‚ç§¯**(numerical quadratrue)ï¼‰

æ€è·¯ï¼šä½¿ç”¨ $f(x)$ çš„**æ‹‰æ ¼æœ—æ—¥æ’å€¼å¤šé¡¹å¼**â€”â€”ä»åŒºé—´ $[a, b]$ ä¸Šé€‰æ‹©ä¸€ç»„ä¸åŒçš„ç‚¹ $a \le x_0 < x_1 \dots < x_n \le b$ã€‚æ‹‰æ ¼æœ—æ—¥å¤šé¡¹å¼ä¸º $P_n(x) = \sum\limits_{k=0}^n f(x_k) L_k(x)$ï¼Œå› æ­¤ï¼š

$$
\int_a^b f(x) dx \approx \sum\limits_{k=0}^n f(x_k) \int_a^b L_k(x) dx
$$

ä»¤ $A_k = \int_a^b L_k(x) dx = \int_a^b \prod\limits_{j \ne k} \dfrac{x - x_j}{x_k - x_j} dx$

è¯¯å·® $R[f]$ ä¸ºï¼š

$$
\begin{align}
& R[f] \notag \\
= & \int_a^b f(x) dx - \sum\limits_{k=0}^n A_kf(x_k) \notag \\
= & \int_a^b [f(x) - P_n(x)] dx = \int_a^b R_n(x) dx \notag \\
= & \int_a^b \dfrac{f^{(n+1)}(\xi_x)}{(n+1)!} \prod\limits_{k=0}^n(x - x_k)dx \notag
\end{align}
$$

!!! definition "å®šä¹‰"

    æ±‚ç§¯å…¬å¼çš„**ç²¾åº¦**(degree of accuracy/precision)ä¸ºæœ€å¤§çš„æ­£æ•´æ•° $n$ï¼Œä½¿å¾—å…¬å¼å¯¹äºæ¯ä¸ª $x^k(k = 0, 1, \dots, n)$ éƒ½æ˜¯ç²¾ç¡®çš„ã€‚

??? example "ä¾‹å­"

    === "é¢˜ç›®"

        è€ƒè™‘åœ¨ $[a, b]$ ä¸Šçš„çº¿æ€§æ’å€¼ï¼Œæˆ‘ä»¬æœ‰ $P_1(x) = \dfrac{x - b}{a - b}f(a) + \dfrac{x - a}{b - a}f(b)$ã€‚å¯ä»¥å¾—åˆ°ï¼š

        - $A_1 = A_2 = \dfrac{b - a}{2}$
        - $\int_a^b f(x) dx \approx \dfrac{b - a}{2}[f(a) + f(b)]$

        è¯·è®¡ç®—ä¸Šè¿°å…¬å¼çš„ç²¾åº¦ã€‚

    === "è§£ç­”"

        è€ƒè™‘ $x^k(k = 0, 1, \dots)$ï¼š

        - $x^0$ï¼š$\int_a^b 1dx = b - a = \dfrac{b - a}{2}[1 + 1]$
        - $x^1$ï¼š$\int_a^b xdx = \dfrac{b^2 - a^2}{2} = \dfrac{b - a}{2}[a + b]$
        - $x^2$ï¼š$\int_a^b x^2dx = \dfrac{b^3 - a^3}{3} = \dfrac{b - a}{2}[a^2 + b^2]$

        <div style="text-align: center">
            <img src="images/C4/4.png" width=40%/>
        </div>

        å› æ­¤ç²¾åº¦é˜¶æ•° = 1

---
å¯¹äºç­‰é—´è·çš„èŠ‚ç‚¹ $x_i = a + ih, h = \dfrac{b - a}{n}, i = 0, 1, \dots, n$

$$
\begin{align}
A_i & = \int_{x_0}^{x_n} \prod\limits_{j \ne i} \dfrac{x - x_j}{x_i - x_j} dx \notag \\
& = \int_0^n \prod\limits_{i \ne j} \dfrac{(t - j)h}{(i - j)h} \times h dt = \dfrac{(b - a)(-1)^{n-i}}{ni!(n - i)!} \int_0^n \prod\limits_{i \ne j} (t - j) dt \notag 
\end{align}
$$

!!! note "æ³¨"

    ç§‘èŒ¨ç³»æ•°ä¸å–å†³äº $f(x)$ æˆ– $[a, b]$ï¼Œè€Œä»…ç”± $n, i$ å†³å®šã€‚å› æ­¤æˆ‘ä»¬å¯ä»¥ä»ä¸€å¼ è¡¨ä¸­æ‰¾å‡ºè¿™äº›ç³»æ•°ã€‚ä¸Šè¿°å…¬å¼ç§°ä¸º**ç‰›é¡¿-ç§‘èŒ¨å…¬å¼**(Newton-Cotes formula)

- $n = 1$
    - $C_0^{(1)} = C_1^{(1)} = \dfrac{1}{2}$
    - $\int_a^b f(x) dx \approx \dfrac{b - a}{2}[f(a) + f(b)]$ï¼ˆç§°ä¸º**æ¢¯å½¢æ³•åˆ™**(trapezoidal rule)ï¼‰
    - $R[f] = \int_a^b \dfrac{f''(\xi_x)}{2!}(x-a)(x-b) dx = -\dfrac{1}{12}h^3f''(\xi)$
    - $\xi \in [a, b], h = \dfrac{b - a}{1}$
    - ç²¾åº¦ = 1
- $n = 2$
    - $C_0^{(2)} = \dfrac{1}{6}, C_1^{(2)} = \dfrac{2}{3}, C_2^{(2)} = \dfrac{1}{6}$
    - $\int_a^b f(x) dx \approx \dfrac{b - a}{6}[f(a) + 4f(\dfrac{a+b}{2}) + f(b)]$ï¼ˆç§°ä¸º**è¾›æ™®æ£®æ³•åˆ™**(Simpson's rule)ï¼‰
    - $R[f] = -\dfrac{1}{90} h^5 f^{(4)}(\xi)$
    - $\xi \in (a, b), h = \dfrac{b - a}{2}$
    - ç²¾åº¦ = 3
- $n = 3$ï¼š**è¾›æ™®æ£® 3/8 æ³•åˆ™**ï¼Œç²¾åº¦ = 3ï¼Œ$R[f] = -\dfrac{3}{80}h^5 f^{(5)}(\xi)$
- $n = 4$ï¼š**ç§‘èŒ¨æ³•åˆ™**(Cotes' Rule)ï¼Œç²¾åº¦ = 5ï¼Œ3ï¼Œ$R[f] = -\dfrac{8}{945}h^7 f^{(6)}(\xi)$

!!! theorem "å®šç†"

    å¯¹äºä½¿ç”¨ $n+1$ ä¸ªç‚¹çš„ç‰›é¡¿-ç§‘èŒ¨å…¬å¼ï¼Œ$\exists \xi \in (a, b)$ï¼Œä½¿å¾—ï¼š

    $$
    \int_a^b f(x) dx = \sum\limits_{k=0}^n A_k f(x_k) + \dfrac{h^{n+3}f^{(n+2)}(\xi)}{(n+2)!} \int_0^n t^2(t - 1) \dots (t - n) dt
    $$

    - å¦‚æœ $n$ ä¸ºå¶æ•°ï¼Œé‚£ä¹ˆ $f \in C^{n+2}[a, b]$ ä¸” $\int_a^b f(x) dx = \sum\limits_{k=0}^n A_k f(x_k) + \dfrac{h^{n+2}f^{(n+1)}(\xi)}{(n+1)!} \int_0^n t(t - 1) \dots (t - n) dt$
    - å¦‚æœ $n$ ä¸ºå¥‡æ•°ï¼Œé‚£ä¹ˆ  $f \in C^{n+1}[a, b]$


## Compotsite Numerical Integration

ç”±äºé«˜é˜¶å¤šé¡¹å¼çš„å¯†åˆ‡æ€§è´¨ï¼Œæˆ‘ä»¬ç”¨**åˆ†æ®µ**(piecewise)æ’å€¼çš„æ–¹å¼æ¥è¿‘ä¼¼ $f(x)$ã€‚è€Œè¿™ä¸ªæ–¹å¼ç”¨åˆ°äº†ä½é˜¶çš„ç‰›é¡¿-ç§‘èŒ¨å…¬å¼ã€‚


### Composite Trapezoidal Rule

**å¤åˆæ¢¯å½¢å…¬å¼**(composite trapezoidal rule)æ¶‰åŠåˆ°çš„å˜é‡æœ‰ï¼š$h = \dfrac{b-a}{n}, x_k = a + kh\ (k=0, \dots, n)$ã€‚

æˆ‘ä»¬å°†æ¢¯å½¢å…¬å¼ä½œç”¨åœ¨æ¯ä¸ªåŒºé—´ $[x_{k-1}, x_k]$ ä¸Šï¼Œå³ï¼š

$$
\int_{x_{k-1}}^{x_k} f(x)dx \approx \dfrac{x_k - x_{k-1}}{2} [f(x_{k-1}) + f(x_k)], k = 1, \dots, n \Rightarrow \\
\int_a^b f(x)dx \approx \sum\limits_{k=1}^n \dfrac{h}{2}[f(x_{k-1}) + f(x_k)] = \dfrac{h}{2}\Big[f(a) + 2\sum\limits_{k=1}^{n-1} f(x_k) + f(b) \Big] = \textcolor{cornflowerblue}{T_n} \\
\begin{align}
R[f] & = \sum\limits_{k=1}^n \Big[-\dfrac{h^3}{12} f''(\xi_k)\Big] = -\dfrac{h^2}{12}(b-a) \dfrac{\sum\limits_{k=1}^n f''(\xi_k)}{n} \notag \\
& = -\dfrac{h^2}{12}(b-a) f''(\xi), \xi \in (a, b) \notag
\end{align}
$$

>$R[f]$ çš„å…¬å¼æ¶‰åŠåˆ°**ä¸­å€¼å®šç†**(MVT)ã€‚


### Composite Simpson's Rule

**å¤åˆè¾›æ™®æ£®å…¬å¼**(composite Simpson rule)æ¶‰åŠåˆ°çš„å˜é‡å’Œå¤åˆæ¢¯å½¢å…¬å¼ä¸€è‡´ï¼š$h = \dfrac{b-a}{n}, x_k = a + kh\ (k=0, \dots, n)$ã€‚

æˆ‘ä»¬å°†è¾›æ™®æ£®å…¬å¼ä½œç”¨åœ¨æ¯ä¸ªåŒºé—´ $[x_{k-1}, x_k]$ ä¸Šï¼Œå³ï¼š

$$
\int_{x_{k-1}}^{x_k} f(x)dx \approx \dfrac{h}{6} [f(x_{k}) + 4 f(x_{k+\frac{1}{2}}) + f(x_{k+1})], k = 1, \dots, n \Rightarrow \\
\int_a^b f(x)dx \approx \dfrac{h}{6}\Big[f(x_a) + 4\sum\limits_{k=0}^{n-1}f(x_{k+\frac{1}{2}}) + 2\sum\limits_{k=0}^{n-2}f(x_{k+1}) + f(x_b)\Big] = \textcolor{cornflowerblue}{S_n} \\
R[f] = -\dfrac{b-a}{180} \Big(\dfrac{h}{2}\Big)^4 f^{(4)}(\xi)
$$

!!! note "æ³¨"

    ä¸ºäº†ç®€åŒ–è®°å·ï¼Œæˆ‘ä»¬ä»¤ $n' = 2n$ï¼Œé‚£ä¹ˆ $h' = \dfrac{b-a}{n'} = \dfrac{h}{2}, x_k = a+kh'$ï¼Œæ‰€ä»¥ï¼š

    $$
    S_n = \dfrac{h'}{3}[f(a) + 4 \sum\limits_{odd\ k} f(x_k) + 2 \sum\limits_{even\ k} f(x_k) + f(b)]
    $$

---
ä¸Šè¿°çš„å¤åˆé›†æˆæŠ€æœ¯éƒ½æ˜¯**ç¨³å®šçš„**ã€‚æ¥çœ‹ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼š

???+ example "ä¾‹å­"

    è€ƒè™‘åœ¨ $[a, b]$ ä¸Šæœ‰ $n$ ä¸ªå­åŒºé—´çš„è¾›æ™®æ£®æ³•åˆ™ã€‚å‡è®¾ $f(x_i)$ ç”± $f^*(x_i)$ è¿‘ä¼¼ï¼Œæ»¡è¶³ $f(x_i) = f^*(x_i) + \varepsilon_i\ (i = 0, \dots, n)$ï¼Œé‚£ä¹ˆç´¯ç§¯è¯¯å·®ä¸ºï¼š

    $$
    e(h) = \Big|\dfrac{h}{3}[\varepsilon_0 + 4 \sum\limits_{odd\ k} \varepsilon_k + 2 \sum\limits_{even\ k} \varepsilon_k + \varepsilon_n]\Big|
    $$

    è‹¥ $|\varepsilon_i| < \varepsilon\ (i = 0, \dots, n)$ï¼Œé‚£ä¹ˆï¼š

    $$
    e(h) < \dfrac{h}{3} [\varepsilon + 4(n/2)\varepsilon + 2(n/2-1)\varepsilon + \varepsilon] = nh\varepsilon = (b-a)\varepsilon
    $$

    å¯ä»¥çœ‹åˆ°ï¼Œå½“æˆ‘ä»¬ä¿®æ­£åˆ†åŒºï¼Œä»¥ç¡®ä¿å‡†ç¡®æ€§æ—¶ï¼Œå¢åŠ çš„è®¡ç®—é‡**ä¸ä¼š**å¸¦æ¥æ›´å¤šçš„èˆå…¥è¯¯å·®ã€‚

??? question "è®¨è®º"

    === "é¢˜ç›®"

        ä½¿ç”¨ $n=8$ æ¢¯å½¢æ³•åˆ™å’Œè¾›æ™®æ£®æ³•åˆ™æ¥è¿‘ä¼¼ $\pi = \int_0^1 \dfrac{4}{1+x^2} dx$ã€‚

    === "ç­”æ¡ˆ"

        $$
        \begin{align}
        T_8 & = \dfrac{1}{16}\Big[f(0) + 2\sum\limits_{k=1}^7f(x_k) + f(1)\Big] \quad \text{where } x_k = \dfrac{k}{8} \notag \\
        & = \textcolor{green}{3.1}\textcolor{red}{383988494} \notag
        \end{align} \\
        \begin{align}
        S_4 & = \dfrac{1}{24}\Big[f(0) + 4\sum\limits_{odd}f(x_k)+ 2\sum\limits_{even}f(x_k) + f(1)\Big] \quad \text{where } x_k = \dfrac{k}{8} \notag \\
        & = \textcolor{green}{3.141592}\textcolor{red}{502} \notag
        \end{align}
        $$

        åœ¨ç¼–ç¨‹çš„æ—¶å€™ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šå°†ä¸€ä¸ªå­åŒºé—´åˆ’åˆ†ä¸ºä¸¤ä¸ªå‡ç­‰å®½åº¦çš„æ›´å°çš„å­åŒºé—´ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä»¤ $n = 2^k\ (k = 0, 1, \dots)$

        å½“ $k=9$ æ—¶ï¼Œ$T_{512} = \textcolor{green}{3.141592}\textcolor{red}{02}$

        $\dfrac{4}{3}T_8 - \dfrac{1}{3}T_4 = \textcolor{green}{3.141592}\textcolor{red}{502} = S_4$


## Romberg Integration

å›é¡¾ä¸€ä¸‹æ¢¯å½¢æ³•åˆ™çš„è¯¯å·®å…¬å¼ï¼š$R_n[f] = -\dfrac{h^2}{12}(b-a)f''(\xi)$ã€‚å½“æˆ‘ä»¬å°†æ¯ä¸ªå­åŒºé—´çš„é•¿åº¦ç¼©å‡è‡³åŸæ¥çš„ä¸€åŠæ—¶ï¼Œ

$$
R_{2n}[f] = -\Big(\dfrac{h}{2}\Big)^2 \dfrac{1}{12}(b-a)f''(\xi') \approx \dfrac{1}{4}R_n[f]
$$

ä»è€Œå¾—åˆ°ï¼š$\dfrac{I - T_{2n}}{I - T_n} \approx \dfrac{1}{4}$ï¼Œè§£å¾— $I \approx \dfrac{4T_{2n} - T_n}{4 - 1} = \dfrac{4}{3}T_{2n} - \dfrac{1}{3}T_n = S_n$

ä¸€èˆ¬æƒ…å†µä¸‹ï¼š

- $\dfrac{4T_{2n} - T_n}{4 - 1} = S_n$
- $\dfrac{4^2S_{2n} - S_n}{4^2 - 1} = C_n$
- $\dfrac{4^3C_{2n} - C_n}{4^3 - 1} = R_n$ -> **Romberg åºåˆ—**(Romberg sequence)

**Rombert æ³•**å¦‚ä¸‹æ‰€ç¤ºï¼š

<div style="text-align: center">
    <img src="images/C4/5.png" width=80%/>
</div>

??? code "ç®—æ³•ï¼šRomberg"

    è¿‘ä¼¼ç§¯åˆ† $I = \int_a^b f(x) dx$ï¼Œé€‰æ‹©æ•´æ•° $n > 0$

    - è¾“å…¥ï¼šç«¯ç‚¹ $a, b$ï¼›æ•´æ•° $n$
    - è¾“å‡ºï¼šæ•°ç»„ $R$ï¼ˆæŒ‰è¡Œè®¡ç®— $R$ï¼›åªä¿ç•™æœ€å2è¡Œï¼‰

    ```c
    Step 1  Set h = b - a;
                R[1][1] = h / 2(f(a) + f(b));
    Step 2  Output(R[1][1]);
    Step 3  for i = 2, ..., n do steps 4-8:
        // approximation from Trapezoidal method
        Step 4  Set R[2][1] = 1/2 * [R[1][1] + h * sum(k=1, pow(2, i-2), f(a + (k - 0.5) * h))];
        Step 5  for j = 2, ..., i:
                    // extrapolation
                    set R[2][j] = R[2][j-1] + (R[2][j-1] - R[1][j-1]) / (pow(4, j-1) - 1);
        Step 6  Output(R[2][j] for j = 1, 2, ..., i);
        Step 7  Set h /= 2;
        Step 8  for j = 1, 2, ..., i set R[1][j] = R[2][j];    // update row 1 of R
    Step 9  STOP.
    ```


## Richardson's Extrapolation

ç›®æ ‡ï¼šä½¿ç”¨ä½é˜¶å…¬å¼è·å–é«˜ç²¾åº¦çš„ç»“æœã€‚

å‡è®¾å¯¹äºæŸäº› $h \ne 0$ï¼Œæˆ‘ä»¬æœ‰å…¬å¼ $T_0(h)$ï¼Œç”¨äºè¿‘ä¼¼æœªçŸ¥é‡ $I$ï¼Œå¹¶ä¸”å…¶æˆªæ–­è¯¯å·®çš„å½¢å¼ä¸ºï¼š

$$
T_0(h) - I = \alpha_1 h + \alpha_2 h^2 + \alpha_3 h^3 + \dots
$$

ç”¨ $h$ ä¸€åŠçš„å€¼æ›¿ä»£è‡ªèº«ï¼Œæˆ‘ä»¬æœ‰ï¼š

$$
T_0(h/2) - I = \alpha_1 (h/2) + \alpha_2 (h/2)^2 + \alpha_3 (h/2)^3 + \dots
$$

ç»“åˆä¸Šè¿°ä¸¤ä¸ªå…¬å¼ï¼Œæˆ‘ä»¬å°±å¯ä»¥å°†ç²¾åº¦ä» $O(h)$ æå‡è‡³ $O(h^2)$ï¼š

$$
\dfrac{2T_0(\frac{h}{2}) - T_0(h)}{2 - 1} - I = -\dfrac{1}{2}\alpha_2 h^2 - \dfrac{3}{4} \alpha_3 h^3 - \dots
$$

ä»¤ $T_1 = \dfrac{2T_0(\frac{h}{2}) - T_0(h)}{2 - 1} = I + \beta_1 h^2 + \beta_2 h^3 + \dots$ã€‚ç±»ä¼¼åœ°ï¼Œæˆ‘ä»¬å¯ä»¥å°†ç²¾åº¦æå‡è‡³ $O(h^3)$ï¼š

$$
T_2 = \dfrac{2^2T_1(\frac{h}{2}) - T_1(h)}{2^2 - 1} = I + \gamma_1 h^3 + \gamma_2 h^4 + \dots
$$

å®é™…ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥å°†ç²¾åº¦å¯ä»¥æå‡åˆ°ä»»æ„é˜¶æ•° $m+1$ï¼š

$$
T_m = \dfrac{2^mT_{m-1}(\frac{h}{2}) - T_{m-1}(h)}{2^m - 1} = I + \delta_1 h^{m+1} + \delta_2 h^{m+2} + \dots
$$


## Adapative Quadrature Methods

ç›®æ ‡ï¼šé¢„æµ‹å‡½æ•°å˜åŒ–é‡ï¼Œæ ¹æ®å˜åŒ–çš„éœ€æ±‚è°ƒæ•´æ­¥å¹…ã€‚

å‰é¢ä»‹ç»çš„å¤åˆç§¯åˆ†æ–¹æ³•çš„ç¼ºç‚¹æ˜¯ï¼šå¯¹æ‰€æœ‰åŒºé—´é€’å½’åˆ’åˆ†å­åŒºé—´ï¼Œè¿™æ ·è®¡ç®—é‡å¤ªå¤§ï¼Œè€Œä¸”è¿˜æœ‰äº§ç”Ÿäº†è®¸å¤šä¸å¿…è¦çš„è®¡ç®—ï¼Œè¿™å¾ˆæµªè´¹ã€‚å› æ­¤ï¼Œæˆ‘ä»¬é‡‡ç”¨ä¸€ç§ä»…å¯¹å…·æœ‰**è¾ƒå¤§è¯¯å·®**(large error)çš„åŒºé—´è¿›è¡Œåˆ’åˆ†çš„æ–¹æ³•ï¼Œé¿å…é¢å¤–çš„è®¡ç®—ã€‚æˆ‘ä»¬ç§°è¿™æ ·çš„æ–¹æ³•ä¸º**è‡ªé€‚åº”æ±‚ç§¯æ–¹æ³•**(adapative quadrature mehtods)ã€‚

é‚£ä¹ˆä»€ä¹ˆç®—â€œè¾ƒå¤§è¯¯å·®â€å‘¢ï¼Ÿä¸€ç§ç®€å•çš„ç¡®å®šç­–ç•¥æ˜¯ä½¿ç”¨ $\int_a^b f(x) dx$ çš„æ€»è¯¯å·® $\varepsilon$ æ¥ç¡®å®šè¾¹ç•Œï¼šåœ¨é•¿åº¦ä¸º $h$ çš„åŒºé—´ä¸­ï¼Œè¯¯å·®åº”è¯¥è¦å°äº $h \dfrac{\varepsilon}{b - a}$ã€‚å½“è¯¯å·®è¶…è¿‡è¿™ä¸ªå€¼æ—¶ï¼Œæˆ‘ä»¬å°±è®¤ä¸ºæ˜¯è¾ƒå¤§è¯¯å·®ï¼Œéœ€è¦ç»§ç»­åˆ’åˆ†è¯¥åŒºé—´ã€‚

æ¥ä¸‹æ¥çš„é—®é¢˜å°±æ˜¯å¦‚ä½•ä¼°è®¡ä¸€ä¸ªåŒºé—´çš„è¯¯å·®ã€‚è¿™é‡Œæˆ‘ä»¬æš‚æ—¶ä»…è€ƒè™‘è¾›æ™®æ£®æ³•åˆ™ä¸‹çš„è¯¯å·®ä¼°è®¡â€”â€”å³å¦‚ä½•ä¼°è®¡ï¼š

$$
\varepsilon(f, a, b) \approx \int_a^b f(x)dx - S(a, b) = \dfrac{h^5}{90} f^{(4)}(\xi)
$$

å…¶ä¸­ $h = \dfrac{b-a}{2}, \xi \in [a, b]$ã€‚

è¿™ä¸ªé—®é¢˜çš„ç­”æ¡ˆåœ¨ä¾‹2ä¸­ç»™å‡ºã€‚

??? example "ä¾‹å­"

    === "ä¾‹1"

        !!! play "åŠ¨ç”»æ¼”ç¤º"

            <div style="text-align: center">
                <img src="images/C4/6.gif" width=70%/>
            </div>

    === "ä¾‹2"

        è€ƒè™‘åŸºäºå¤åˆè¾›æ™®æ£®æ³•åˆ™çš„è‡ªé€‚åº”æ–¹æ³•ï¼š

        $$
        \int_a^b f(x)dx = S(a, b) - \dfrac{h^5}{90}f^{(4)}(\xi)
        $$

        å…¶ä¸­ $S(a, b) = \dfrac{h}{3}[f(a) + 4f(a + h) + f(b)], h = \dfrac{b-a}{2}$ã€‚ä»¤ï¼š

        $$
        \begin{align}
        S\Big(a, \dfrac{a+b}{2}\Big) = \dfrac{h}{6}[f(a) + 4f(a + h/2) + f(a + h)] \notag \\
        S\Big(\dfrac{a+b}{2}, b\Big) = \dfrac{h}{6}[f(a + h) + 4f(a + 3h/2) + f(b)] \notag
        \end{align}
        $$

        é‚£ä¹ˆï¼š

        $$
        \int_a^b f(x) dx = S\Big(a, \dfrac{a+b}{2}\Big) + S\Big(\dfrac{a+b}{2}, b\Big) - \dfrac{1}{16} \times \dfrac{h^5}{90}f^{(4)}(\eta) \\
        \begin{align}
        &\ \Big| \int_a^b f(x) dx - S\Big(a, \dfrac{a+b}{2}\Big) - S\Big(\dfrac{a+b}{2}, b\Big) \Big| \notag \\
        \approx &\ \dfrac{1}{15} \Big|S(a, b) - S\Big(a, \dfrac{a+b}{2}\Big) - S\Big(\dfrac{a+b}{2}, b\Big) \Big| \notag \\
        < &\ \varepsilon \notag
        \end{align}
        $$

        å¯ä»¥çœ‹åˆ°ï¼Œç›¸æ¯”ä¸€èˆ¬çš„è¾›æ™®æ£®æ³•åˆ™ï¼Œç»“åˆè‡ªé€‚åº”æ–¹æ³•åè¯¯å·®åªæœ‰åŸæ¥çš„ $\dfrac{1}{15}$ ğŸ‰


## Gaussian Quadrature

ç›®æ ‡ï¼šæ„é€ ä¸€ä¸ªå…¬å¼ $\int_a^b w(x) f(x) dx \approx \sum\limits_{k=0}^n A_k f(x_k)$ï¼Œå¯¹äº $n+1$ ä¸ªç‚¹è€Œè¨€ç²¾åº¦ä¸º $2n+1$ã€‚

æ€è·¯ï¼šç¡®å®š $2n+2$ ä¸ªæœªçŸ¥é‡ $x_0, \dots, x_n;\ A_0, \dots, A_n$ï¼Œä½¿å¾—å…¬å¼åœ¨ $f(x) = 1, x, x^2, \dots, x^{2n+1}$ ä¸Šéƒ½æ˜¯ç²¾ç¡®çš„ã€‚ç‚¹ $x_0, \dots, x_n$ è¢«ç§°ä¸º**é«˜æ–¯ç‚¹**(Gaussian points)ï¼Œè¿™ä¸ªæ–¹æ³•è¢«ç§°ä¸º**é«˜æ–¯æ±‚ç§¯**(Gaussian quadrature)

??? question "è®¨è®º"

    === "é¢˜ç›®"

        ä½¿ç”¨ $n = 1$ çš„é«˜æ–¯æ±‚ç§¯è¿‘ä¼¼è¡¨ç¤º $\int_0^1 \sqrt{x} f(x) dx$ã€‚

    === "è§£ç­”"

        å‡è®¾ $\int_0^1 \sqrt{x} f(x) dx \approx A_0 f(x_0) + A_1 f(x_1)$ã€‚

        å…¬å¼å¿…é¡»åœ¨ $f(x) = 1, x, x^2, x^3$ ä¸Šç²¾ç¡®è¡¨ç¤ºã€‚è®¡ç®— $\begin{cases}\frac{2}{3} = A_0 + A_1 \\ \frac{2}{5} = A_0 x_0 + A_1 x_1 \\ \frac{2}{7} = A_0 x_0^2 + A_1 x_1^2 \\ \frac{2}{9} = A_0x_0^3 + A_1 x_1^3\end{cases}$ï¼Œè§£å¾—ï¼š$\begin{cases}x_0 \approx 0.8212 \\ x_1 \approx 0.2899 \\ A_0 \approx 0.3891 \\ A_1 \approx 0.2776\end{cases}$

!!! theorem "å®šç†"

    å½“ä¸”ä»…å½“ $W(x) = \prod\limits_{k=0}^n(x - x_k)$ ä¸æ‰€æœ‰é˜¶æ•°ä¸è¶…è¿‡ $n$ çš„å¤šé¡¹å¼æ­£äº¤æ—¶ï¼Œ$x_0, \dots, x_n$ æ˜¯**é«˜æ–¯ç‚¹**ã€‚

    ??? proof "è¯æ˜"

        - è‹¥ $x_0, \dots, x_n$ æ˜¯é«˜æ–¯ç‚¹ï¼Œåˆ™å…¬å¼ $\int_a^b w(x) f(x) dx \approx \sum\limits_{k=0}^nA_kf(x_k)$ çš„ç²¾åº¦è‡³å°‘ä¸º $2n+1$ã€‚é‚£ä¹ˆå¯¹äºä»»æ„å¤šé¡¹å¼ $P_m(x)\ (m \le n)$ï¼Œ$P_m(x) W(x)$ çš„é˜¶æ•°ä¸è¶…è¿‡ $2n+1$ã€‚å› æ­¤ä¸Šè¿°å…¬å¼å¯¹äº $P_m(x) W(x)$ è€Œè¨€æ˜¯ç²¾ç¡®çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼š

            $$
            \int_a^b w(x) P_m(x) W(x) dx = \sum\limits_{k=0}^n A_k P_m(x_k) W(x_k) = 0
            $$

        - è¦è¯æ˜ $x_0, \dots, x_n$ æ˜¯é«˜æ–¯ç‚¹ï¼Œæˆ‘ä»¬éœ€è¦è¯æ˜å…¬å¼å¯¹ä»»æ„å¤šé¡¹å¼ $P_m(x)\ (m \le 2n + 1)$ æ˜¯ç²¾ç¡®çš„ã€‚ä»¤ $P_m(x) = W(x) q(x) + r(x)$ï¼Œé‚£ä¹ˆ 
        
            $$
            \begin{align}
            \int_a^n w(x) P_m(x) dx & = \int_a^n w(x) W(x) q(x) dx + \int_a^n w(x) r(x) dx = \sum\limits_{k=0}^n A_k r(x_k) \notag \\
            & = \sum\limits_{k=0}^n A_k P_m(x_k) \notag
            \end{align}
            $$

æ­£äº¤å¤šé¡¹å¼çš„é›†åˆ $\{\varphi_0, \varphi_1, \dots, \varphi_n, \dots\}$ æ˜¯çº¿æ€§ç‹¬ç«‹çš„ï¼Œä¸” $\varphi_{n+1}$ å’Œä»»ä½•å¤šé¡¹å¼ $P_m(x)\ (m \le n)$ æ­£äº¤ã€‚æ‰€ä»¥ï¼Œå¦‚æœæˆ‘ä»¬æ‹¿ $\varphi_{n+1}$ ä½œä¸º $W(x)$ï¼Œé‚£ä¹ˆ **$\varphi_{n+1}$ çš„æ ¹**å°±æ˜¯é«˜æ–¯ç‚¹äº†ã€‚

??? example "ä¾‹å­"

    === "é¢˜ç›®"

        ä½¿ç”¨é«˜æ–¯æ±‚ç§¯æ¥è¿‘ä¼¼è®¡ç®— $\int_0^1 \sqrt{x} f(x) dx$ï¼Œå…¶ä¸­ $n = 1$

    === "è§£ç­”"

        å‡è®¾ $\int_0^1 \sqrt{x} f(x) dx \approx A_0 f(x_0) + A_1 f(x_1)$ã€‚

        1. æ„é€ æ­£äº¤å¤šé¡¹å¼ $\varphi_2$ã€‚ä»¤ $\varphi_0(x) = 1, \varphi_1(x) = x + a, \varphi_2(x) = x^2 + bx + c$
            - $(\varphi_0, \varphi_1) = 0 \Rightarrow \int_0^1 \sqrt{x} (x + a) dx = 0 \Rightarrow a = - \dfrac{3}{5}$
            - $(\varphi_0, \varphi_2) = 0 \Rightarrow \int_0^1 \sqrt{x} (x^2 + bx + c) dx = 0 \Rightarrow a = - \dfrac{10}{9}$
            - $(\varphi_1, \varphi_2) = 0 \Rightarrow \int_0^1 \sqrt{x} (x - \dfrac{3}{5})(x + bx + c) dx = 0 \Rightarrow a = \dfrac{5}{21}$
            - $\therefore \varphi_2(x) = x^2 - \dfrac{10}{9}x + \dfrac{5}{21}$

        2. æ‰¾åˆ° $\varphi_2$ çš„ä¸¤ä¸ªæ ¹ï¼Œä½œä¸ºé«˜æ–¯ç‚¹ $x_0, x_1$ï¼š$x_{0;1} = \dfrac{\frac{10}{9} \pm \sqrt{(\frac{10}{9})^2 - \frac{20}{21}}}{2}$

        3. å› ä¸ºè¿™ä¸ªå…¬å¼å¿…é¡»åœ¨ $f(x) = 1, x$ ä¸Šæ˜¯ç²¾ç¡®çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬èƒ½æ¯”è¾ƒå®¹æ˜“åœ°æ±‚è§£ $A_0, A_1$ çš„çº¿æ€§æ–¹ç¨‹ç»„

        æœ€ç»ˆç»“æœä¸ºï¼š$x_0 \approx 0.8212, x_1 \approx 0.2899, A_0 \approx 0.3891, A_1 \approx 0.2776$

        ç°åœ¨ä½¿ç”¨ä¸Šè¿°ç»“æœæ¥è¿‘ä¼¼è®¡ç®—$\int_0^1 \sqrt{x} e^x dx$

        $$
        \int_0^1 \sqrt{x} f(x) dx \approx A_0 e^{x_0} + A_1 e^{x_1} = 0.3891 \times e^{0.8212} + 0.2776 \times e^{0.2899} \approx 1.2555
        $$

        è€Œ $\int_0^1 \sqrt{x} (2x-1) dx = \dfrac{2}{15}$ æ˜¯ç²¾ç¡®çš„ã€‚

ä¸€äº›ç‰¹æ®Šçš„æ­£äº¤å¤šé¡¹å¼ï¼š

- **å‹’è®©å¾·å¤šé¡¹å¼**(Legendre polynomials)ï¼šå®šä¹‰åœ¨ $[-1, 1]$ ä¸Šä¸” $w(x) \equiv 1$

    $$
    P_k(x) = \dfrac{1}{2^k k!} \dfrac{d^k}{dx^k}(x^2 - 1)^k \quad \quad (P_k, P_l) = \begin{cases}0 & k \ne l \\ \dfrac{2}{2k+1} & k = l\end{cases}
    $$

    $P_0 = 1, P_1 = x, (k + 1)P_{k+1} = (2k + 1)xP_k - kP_{k-1}$

    ä½¿ç”¨ $P_{n+1}$ çš„æ ¹çš„å…¬å¼ç§°ä¸º**é«˜æ–¯-å‹’è®©å¾·æ±‚ç§¯å…¬å¼**ã€‚

- **åˆ‡æ¯”é›ªå¤«å¤šé¡¹å¼**(Chebyshev polynomials)ï¼šå®šä¹‰åœ¨ $[-1, 1]$ ä¸Šä¸” $w(x) = \dfrac{1}{\sqrt{1 - x^2}}$

    $$
    T_k(x) = \cos (k \times \arccos x)
    $$

    $T_{n+1}$ çš„æ ¹ä¸º $x_k = \cos \Big(\dfrac{2k + 1}{2n + 2} \pi \Big) \quad (k = 0, \dots, n)$

    å…¬å¼ $\int_{-1}^1 \dfrac{1}{\sqrt{1 - x^2}} f(x) dx = \sum\limits_{k=0}^n A_k f(x_k)$ ç§°ä¸º**é«˜æ–¯-åˆ‡æ¯”é›ªå¤«æ±‚ç§¯å…¬å¼**ã€‚

    - æ³¨æ„åˆ°ç§¯åˆ†ç«¯ç‚¹ $\pm 1$ æ˜¯ç§¯åˆ†ä¸Šçš„**å¥‡ç‚¹**(singular points)ï¼Œæ­¤æ—¶åœ¨ç­‰é—´è·çš„ç‚¹ä¸Šä½¿ç”¨ç‰›é¡¿-ç§‘èŒ¨å…¬å¼ä¼šå‡ºç°é—®é¢˜ï¼›è€Œé«˜æ–¯ç§¯åˆ†èƒ½å¤Ÿé¿å…è¿™ä¸ªé—®é¢˜ã€‚

>å¯¹åº”çš„[ä½œä¸šç»ƒä¹ ](hw.md#chap-4-numerical-differentiation-and-integration)ğŸ“